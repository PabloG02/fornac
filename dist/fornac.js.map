{"version":3,"file":"fornac.js","sources":["../node_modules/uuid/dist/esm-browser/rng.js","../node_modules/uuid/dist/esm-browser/regex.js","../node_modules/uuid/dist/esm-browser/validate.js","../node_modules/uuid/dist/esm-browser/stringify.js","../node_modules/uuid/dist/esm-browser/v1.js","../node_modules/uuid/dist/esm-browser/parse.js","../node_modules/uuid/dist/esm-browser/v35.js","../node_modules/uuid/dist/esm-browser/md5.js","../node_modules/uuid/dist/esm-browser/v3.js","../node_modules/uuid/dist/esm-browser/v4.js","../node_modules/uuid/dist/esm-browser/sha1.js","../node_modules/uuid/dist/esm-browser/v5.js","../node_modules/uuid/dist/esm-browser/nil.js","../node_modules/uuid/dist/esm-browser/version.js","../node_modules/slugid/slugid.js","../node_modules/slugid/index.js","../src/img/play.svg","../src/d3-context-menu.js","../src/rnautils.js","../src/rnagraph.js","../src/simplernaplot.js","../src/naview/radloop.js","../src/naview/loop.js","../src/naview/region.js","../src/naview/connection.js","../src/naview/base.js","../src/naview/naview.js","../src/fornac.js","../src/rnaplot.js","../src/rnatreemap.js"],"sourcesContent":["// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import rng from './rng.js';\nimport stringify from './stringify.js'; // **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\n\nvar _clockseq; // Previous uuid creation time\n\n\nvar _lastMSecs = 0;\nvar _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details\n\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || new Array(16);\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n\n  if (node == null || clockseq == null) {\n    var seedBytes = options.random || (options.rng || rng)();\n\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n\n\n  var msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)\n\n  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression\n\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n\n\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  } // Per 4.2.1.2 Throw error if too many uuids are requested\n\n\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n\n  msecs += 12219292800000; // `time_low`\n\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff; // `time_mid`\n\n  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff; // `time_high_and_version`\n\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n\n  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n\n  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`\n\n  b[i++] = clockseq & 0xff; // `node`\n\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf || stringify(b);\n}\n\nexport default v1;","import validate from './validate.js';\n\nfunction parse(uuid) {\n  if (!validate(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  var v;\n  var arr = new Uint8Array(16); // Parse ########-....-....-....-............\n\n  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;\n  arr[1] = v >>> 16 & 0xff;\n  arr[2] = v >>> 8 & 0xff;\n  arr[3] = v & 0xff; // Parse ........-####-....-....-............\n\n  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;\n  arr[5] = v & 0xff; // Parse ........-....-####-....-............\n\n  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;\n  arr[7] = v & 0xff; // Parse ........-....-....-####-............\n\n  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;\n  arr[9] = v & 0xff; // Parse ........-....-....-....-############\n  // (Use \"/\" to avoid 32-bit truncation when bit-shifting high-order bytes)\n\n  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;\n  arr[11] = v / 0x100000000 & 0xff;\n  arr[12] = v >>> 24 & 0xff;\n  arr[13] = v >>> 16 & 0xff;\n  arr[14] = v >>> 8 & 0xff;\n  arr[15] = v & 0xff;\n  return arr;\n}\n\nexport default parse;","import stringify from './stringify.js';\nimport parse from './parse.js';\n\nfunction stringToBytes(str) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n\n  var bytes = [];\n\n  for (var i = 0; i < str.length; ++i) {\n    bytes.push(str.charCodeAt(i));\n  }\n\n  return bytes;\n}\n\nexport var DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nexport var URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\nexport default function (name, version, hashfunc) {\n  function generateUUID(value, namespace, buf, offset) {\n    if (typeof value === 'string') {\n      value = stringToBytes(value);\n    }\n\n    if (typeof namespace === 'string') {\n      namespace = parse(namespace);\n    }\n\n    if (namespace.length !== 16) {\n      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');\n    } // Compute hash of namespace and value, Per 4.3\n    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =\n    // hashfunc([...namespace, ... value])`\n\n\n    var bytes = new Uint8Array(16 + value.length);\n    bytes.set(namespace);\n    bytes.set(value, namespace.length);\n    bytes = hashfunc(bytes);\n    bytes[6] = bytes[6] & 0x0f | version;\n    bytes[8] = bytes[8] & 0x3f | 0x80;\n\n    if (buf) {\n      offset = offset || 0;\n\n      for (var i = 0; i < 16; ++i) {\n        buf[offset + i] = bytes[i];\n      }\n\n      return buf;\n    }\n\n    return stringify(bytes);\n  } // Function#name is not settable on some platforms (#270)\n\n\n  try {\n    generateUUID.name = name; // eslint-disable-next-line no-empty\n  } catch (err) {} // For CommonJS default export support\n\n\n  generateUUID.DNS = DNS;\n  generateUUID.URL = URL;\n  return generateUUID;\n}","/*\n * Browser-compatible JavaScript MD5\n *\n * Modification of JavaScript MD5\n * https://github.com/blueimp/JavaScript-MD5\n *\n * Copyright 2011, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n *\n * Based on\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\nfunction md5(bytes) {\n  if (typeof bytes === 'string') {\n    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = new Uint8Array(msg.length);\n\n    for (var i = 0; i < msg.length; ++i) {\n      bytes[i] = msg.charCodeAt(i);\n    }\n  }\n\n  return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes), bytes.length * 8));\n}\n/*\n * Convert an array of little-endian words to an array of bytes\n */\n\n\nfunction md5ToHexEncodedArray(input) {\n  var output = [];\n  var length32 = input.length * 32;\n  var hexTab = '0123456789abcdef';\n\n  for (var i = 0; i < length32; i += 8) {\n    var x = input[i >> 5] >>> i % 32 & 0xff;\n    var hex = parseInt(hexTab.charAt(x >>> 4 & 0x0f) + hexTab.charAt(x & 0x0f), 16);\n    output.push(hex);\n  }\n\n  return output;\n}\n/**\n * Calculate output length with padding and bit length\n */\n\n\nfunction getOutputLength(inputLength8) {\n  return (inputLength8 + 64 >>> 9 << 4) + 14 + 1;\n}\n/*\n * Calculate the MD5 of an array of little-endian words, and a bit length.\n */\n\n\nfunction wordsToMd5(x, len) {\n  /* append padding */\n  x[len >> 5] |= 0x80 << len % 32;\n  x[getOutputLength(len) - 1] = len;\n  var a = 1732584193;\n  var b = -271733879;\n  var c = -1732584194;\n  var d = 271733878;\n\n  for (var i = 0; i < x.length; i += 16) {\n    var olda = a;\n    var oldb = b;\n    var oldc = c;\n    var oldd = d;\n    a = md5ff(a, b, c, d, x[i], 7, -680876936);\n    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);\n    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);\n    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);\n    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);\n    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);\n    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);\n    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);\n    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);\n    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);\n    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);\n    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);\n    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);\n    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);\n    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);\n    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);\n    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);\n    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);\n    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);\n    b = md5gg(b, c, d, a, x[i], 20, -373897302);\n    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);\n    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);\n    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);\n    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);\n    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);\n    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);\n    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);\n    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);\n    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);\n    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);\n    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);\n    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);\n    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);\n    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);\n    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);\n    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);\n    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);\n    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);\n    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);\n    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);\n    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);\n    d = md5hh(d, a, b, c, x[i], 11, -358537222);\n    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);\n    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);\n    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);\n    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);\n    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);\n    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);\n    a = md5ii(a, b, c, d, x[i], 6, -198630844);\n    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);\n    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);\n    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);\n    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);\n    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);\n    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);\n    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);\n    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);\n    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);\n    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);\n    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);\n    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);\n    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);\n    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);\n    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);\n    a = safeAdd(a, olda);\n    b = safeAdd(b, oldb);\n    c = safeAdd(c, oldc);\n    d = safeAdd(d, oldd);\n  }\n\n  return [a, b, c, d];\n}\n/*\n * Convert an array bytes to an array of little-endian words\n * Characters >255 have their high-byte silently ignored.\n */\n\n\nfunction bytesToWords(input) {\n  if (input.length === 0) {\n    return [];\n  }\n\n  var length8 = input.length * 8;\n  var output = new Uint32Array(getOutputLength(length8));\n\n  for (var i = 0; i < length8; i += 8) {\n    output[i >> 5] |= (input[i / 8] & 0xff) << i % 32;\n  }\n\n  return output;\n}\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\n\n\nfunction safeAdd(x, y) {\n  var lsw = (x & 0xffff) + (y & 0xffff);\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return msw << 16 | lsw & 0xffff;\n}\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\n\n\nfunction bitRotateLeft(num, cnt) {\n  return num << cnt | num >>> 32 - cnt;\n}\n/*\n * These functions implement the four basic operations the algorithm uses.\n */\n\n\nfunction md5cmn(q, a, b, x, s, t) {\n  return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);\n}\n\nfunction md5ff(a, b, c, d, x, s, t) {\n  return md5cmn(b & c | ~b & d, a, b, x, s, t);\n}\n\nfunction md5gg(a, b, c, d, x, s, t) {\n  return md5cmn(b & d | c & ~d, a, b, x, s, t);\n}\n\nfunction md5hh(a, b, c, d, x, s, t) {\n  return md5cmn(b ^ c ^ d, a, b, x, s, t);\n}\n\nfunction md5ii(a, b, c, d, x, s, t) {\n  return md5cmn(c ^ (b | ~d), a, b, x, s, t);\n}\n\nexport default md5;","import v35 from './v35.js';\nimport md5 from './md5.js';\nvar v3 = v35('v3', 0x30, md5);\nexport default v3;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","// Adapted from Chris Veness' SHA1 code at\n// http://www.movable-type.co.uk/scripts/sha1.html\nfunction f(s, x, y, z) {\n  switch (s) {\n    case 0:\n      return x & y ^ ~x & z;\n\n    case 1:\n      return x ^ y ^ z;\n\n    case 2:\n      return x & y ^ x & z ^ y & z;\n\n    case 3:\n      return x ^ y ^ z;\n  }\n}\n\nfunction ROTL(x, n) {\n  return x << n | x >>> 32 - n;\n}\n\nfunction sha1(bytes) {\n  var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];\n  var H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n\n  if (typeof bytes === 'string') {\n    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = [];\n\n    for (var i = 0; i < msg.length; ++i) {\n      bytes.push(msg.charCodeAt(i));\n    }\n  } else if (!Array.isArray(bytes)) {\n    // Convert Array-like to Array\n    bytes = Array.prototype.slice.call(bytes);\n  }\n\n  bytes.push(0x80);\n  var l = bytes.length / 4 + 2;\n  var N = Math.ceil(l / 16);\n  var M = new Array(N);\n\n  for (var _i = 0; _i < N; ++_i) {\n    var arr = new Uint32Array(16);\n\n    for (var j = 0; j < 16; ++j) {\n      arr[j] = bytes[_i * 64 + j * 4] << 24 | bytes[_i * 64 + j * 4 + 1] << 16 | bytes[_i * 64 + j * 4 + 2] << 8 | bytes[_i * 64 + j * 4 + 3];\n    }\n\n    M[_i] = arr;\n  }\n\n  M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);\n  M[N - 1][14] = Math.floor(M[N - 1][14]);\n  M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;\n\n  for (var _i2 = 0; _i2 < N; ++_i2) {\n    var W = new Uint32Array(80);\n\n    for (var t = 0; t < 16; ++t) {\n      W[t] = M[_i2][t];\n    }\n\n    for (var _t = 16; _t < 80; ++_t) {\n      W[_t] = ROTL(W[_t - 3] ^ W[_t - 8] ^ W[_t - 14] ^ W[_t - 16], 1);\n    }\n\n    var a = H[0];\n    var b = H[1];\n    var c = H[2];\n    var d = H[3];\n    var e = H[4];\n\n    for (var _t2 = 0; _t2 < 80; ++_t2) {\n      var s = Math.floor(_t2 / 20);\n      var T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[_t2] >>> 0;\n      e = d;\n      d = c;\n      c = ROTL(b, 30) >>> 0;\n      b = a;\n      a = T;\n    }\n\n    H[0] = H[0] + a >>> 0;\n    H[1] = H[1] + b >>> 0;\n    H[2] = H[2] + c >>> 0;\n    H[3] = H[3] + d >>> 0;\n    H[4] = H[4] + e >>> 0;\n  }\n\n  return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];\n}\n\nexport default sha1;","import v35 from './v35.js';\nimport sha1 from './sha1.js';\nvar v5 = v35('v5', 0x50, sha1);\nexport default v5;","export default '00000000-0000-0000-0000-000000000000';","import validate from './validate.js';\n\nfunction version(uuid) {\n  if (!validate(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  return parseInt(uuid.substr(14, 1), 16);\n}\n\nexport default version;","// The MIT License (MIT)\n//\n// Copyright (c) 2014 Jonas Finnemann Jensen\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nvar uuid = require('uuid');\n\n/** @type {(bytes: Uint8Array) => string} */\nvar toBase64 = (() => {\n  if (typeof Buffer !== 'undefined') {\n    return (bytes) => Buffer.from(bytes).toString('base64');\n  }\n  return (bytes) => btoa(String.fromCharCode(...bytes));\n})();\n\n/** @type {(base64: string) => Uint8Array | Buffer} */\nvar fromBase64 = (() => {\n  if (typeof Buffer !== 'undefined') {\n    return (base64) => Buffer.from(base64, 'base64');\n  }\n  return (base64) => Uint8Array.from(atob(base64), c => c.charCodeAt(0));\n})();\n\n/**\n * Returns the given uuid as a 22 character slug. This can be a regular v4\n * slug or a \"nice\" slug.\n */\nexports.encode = function(uuid_) {\n  var bytes   = uuid.parse(uuid_);\n  var base64 = toBase64(bytes);\n  var slug = base64\n              .replace(/\\+/g, '-')  // Replace + with - (see RFC 4648, sec. 5)\n              .replace(/\\//g, '_')  // Replace / with _ (see RFC 4648, sec. 5)\n              .substring(0, 22);    // Drop '==' padding\n  return slug;\n};\n\n/**\n * Returns the uuid represented by the given v4 or \"nice\" slug\n */\nexports.decode = function(slug) {\n  var base64 = slug\n                  .replace(/-/g, '+')\n                  .replace(/_/g, '/')\n                  + '==';\n  return uuid.stringify(fromBase64(base64));\n};\n\n/**\n * Returns a randomly generated uuid v4 compliant slug\n */\nexports.v4 = function() {\n  var bytes   = uuid.v4(null, new Uint8Array(16));\n  var base64 = toBase64(bytes);\n  var slug = base64\n              .replace(/\\+/g, '-')  // Replace + with - (see RFC 4648, sec. 5)\n              .replace(/\\//g, '_')  // Replace / with _ (see RFC 4648, sec. 5)\n              .substring(0, 22);    // Drop '==' padding\n  return slug;\n};\n\n/**\n * Returns a randomly generated uuid v4 compliant slug which conforms to a set\n * of \"nice\" properties, at the cost of some entropy. Currently this means one\n * extra fixed bit (the first bit of the uuid is set to 0) which guarantees the\n * slug will begin with [A-Za-f]. For example such slugs don't require special\n * handling when used as command line parameters (whereas non-nice slugs may\n * start with `-` which can confuse command line tools).\n *\n * Potentially other \"nice\" properties may be added in future to further\n * restrict the range of potential uuids that may be generated.\n */\nexports.nice = function() {\n  var bytes   = uuid.v4(null, new Uint8Array(16));\n  bytes[0] = bytes[0] & 0x7f;  // unset first bit to ensure [A-Za-f] first char\n  var base64 = toBase64(bytes);\n  var slug = base64\n              .replace(/\\+/g, '-')  // Replace + with - (see RFC 4648, sec. 5)\n              .replace(/\\//g, '_')  // Replace / with _ (see RFC 4648, sec. 5)\n              .substring(0, 22);    // Drop '==' padding\n  return slug;\n};\n","// The MIT License (MIT)\n//\n// Copyright (c) 2014 Jonas Finnemann Jensen\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nmodule.exports = require('./slugid');\n","export default \"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generated%20by%20IcoMoon.io%20--%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='512'%20height='512'%20viewBox='0%200%20512%20512'%3e%3cg%20id='icomoon-ignore'%3e%3c/g%3e%3cpath%20d='M96%2064l320%20192-320%20192z'%3e%3c/path%3e%3c/svg%3e\"","import './d3-context-menu.css';\r\nimport ArrowIcon from './img/play.svg';\r\n\r\nimport d3 from 'd3';\r\nimport slugid from 'slugid';\r\n\r\nexport function contextMenu(menu, opts) {\r\n    let previouslyMouseUp = false;\r\n    let clickAway = () => {};\r\n    let uid = slugid.nice();\r\n    let rootElement = null;\r\n    let orientation = 'right';   // display the menu to the right of the mouse click\r\n                                 // or parent elemement\r\n    let initialPos = null;\r\n    let parentStart = null;\r\n\r\n    var openCallback,\r\n        closeCallback;\r\n\r\n    if (typeof opts === 'function') {\r\n        openCallback = opts;\r\n    } else {\r\n        opts = opts || {};\r\n        openCallback = opts.onOpen;\r\n        closeCallback = opts.onClose;\r\n    }\r\n\r\n    if ('rootElement' in opts)\r\n        rootElement = opts['rootElement']\r\n\r\n    if ('pos' in opts) {\r\n        // do we want to place this menu somewhere specific?\r\n        initialPos = opts.pos;\r\n    }\r\n\r\n    if ('orientation' in opts) {\r\n        orientation = opts.orientation;\r\n    }\r\n\r\n    if ('parentStart' in opts) {\r\n        parentStart = opts.parentStart;\r\n    }\r\n\r\n    // create the div element that will hold the context menu\r\n    d3.selectAll('.d3-context-menu-' + uid).data([1])\r\n        .enter()\r\n        .append('div')\r\n        .classed('d3-context-menu', true)\r\n        .classed('d3-context-menu-' + uid, true)\r\n\r\n    // close menu\r\n    d3.select('body').on('click.d3-context-menu-' + uid, function() {\r\n        if (previouslyMouseUp) {\r\n            previouslyMouseUp = false;\r\n            return;\r\n        }\r\n       console.log('body click close');\r\n\r\n        d3.select('.d3-context-menu-' + uid).style('display', 'none');\r\n       orientation = 'right';\r\n\r\n        if (closeCallback) {\r\n            closeCallback();\r\n        }\r\n    });\r\n\r\n    // this gets executed when a contextmenu event occurs\r\n    return function(data, index, pMouseUp=false,\r\n                    clickAwayFunc = function() { } ) {\r\n        var elm = this;\r\n        var contextMenuPos = null;\r\n        let mousePos = null;\r\n        let currentThis = this;\r\n\r\n        if (rootElement == null)\r\n            mousePos = d3.mouse(this);\r\n        else\r\n            mousePos = d3.mouse(rootElement); // for recursive menus, we need the mouse\r\n                                              // position relative to another element\r\n\r\n        clickAway = clickAwayFunc;\r\n        let openChildMenuUid = null;\r\n\r\n        previouslyMouseUp = pMouseUp;\r\n\r\n        d3.selectAll('.d3-context-menu-' + uid).html('');\r\n        var list = d3.selectAll('.d3-context-menu-' + uid)\r\n            .on('contextmenu', function(d) {\r\n                console.log('context-menu close');\r\n                d3.select('.d3-context-menu-' + uid).style('display', 'none'); \r\n                orientation = 'right';\r\n\r\n                d3.event.preventDefault();\r\n                d3.event.stopPropagation();\r\n            })\r\n            .append('ul');\r\n\r\n        list.selectAll('li').data(typeof menu === 'function' ? menu(data) : menu).enter()\r\n            .append('li')\r\n            .attr('class', function(d) {\r\n                console.log('d:', d);\r\n                var ret = '';\r\n                if (d.divider) {\r\n                    ret += ' is-divider';\r\n                }\r\n                if (d.disabled) {\r\n                    ret += ' is-disabled';\r\n                }\r\n                if (!d.action) {\r\n                    ret += ' is-header';\r\n                }\r\n                if ('children' in d) {\r\n                    ret += ' d3-context-menu-recursive';\r\n                }\r\n                return ret;\r\n            })\r\n            .html(function(d) {\r\n                if (d.divider) {\r\n                    return '<hr>';\r\n                }\r\n                if (!d.title) {\r\n                    console.error('No title attribute set. Check the spelling of your options.');\r\n                }\r\n                return (typeof d.title === 'string') ? d.title : d.title(data);\r\n            })\r\n            .on('click', function(d, i) {\r\n                if (d.disabled) return; // do nothing if disabled\r\n                if (!d.action) return; // headers have no \"action\"\r\n                d.action(elm, data, index, mousePos);\r\n                console.log('click close');\r\n\r\n                // close all context menus\r\n                d3.selectAll('.d3-context-menu').style('display', 'none');\r\n                orientation = 'right';\r\n\r\n                if (closeCallback) {\r\n                    closeCallback();\r\n                }\r\n            })\r\n            .on('mouseenter', function(d, i) {\r\n                d3.select(this)\r\n                    .classed('d3-context-menu-selected', true)\r\n\r\n                if (openChildMenuUid != null) {\r\n                    // there's a child menu open\r\n\r\n                    // unselect all items\r\n                    d3.select('.d3-context-menu-' + uid)\r\n                        .selectAll('li')\r\n                        .classed('d3-context-menu-selected', false);\r\n\r\n                    if (typeof d.children == 'undefined') {\r\n                        console.log(\"no children close\");\r\n                        // no children, so hide any open child menus\r\n                        d3.select('.d3-context-menu-' + openChildMenuUid)\r\n                        .style('display', 'none');\r\n\r\n                        openChildMenuUid = null;\r\n                        return;\r\n                    }\r\n\r\n                    if (d.childUid == openChildMenuUid) {\r\n                        // the correct child menu is already open\r\n                        return;\r\n\r\n                    } else {\r\n                        // need to open a different child menu\r\n                        console.log('open different child menu close');\r\n                        \r\n                        // close the already open one\r\n                        d3.select('.d3-context-menu-' + openChildMenuUid)\r\n                        .style('display', 'none');\r\n\r\n                        openChildMenuUid = null;\r\n\r\n                    }\r\n                }             \r\n\r\n                // there should be no menu open right now\r\n                if (typeof d.children != 'undefined') {\r\n                    let boundingRect = this.getBoundingClientRect();\r\n\r\n                    let childrenContextMenu = null\r\n                    if (orientation == 'left') {\r\n                        childrenContextMenu = contextMenu(d.children, {'rootElement': currentThis,\r\n                              'pos': [ boundingRect.left + window.pageXOffset,\r\n                                    boundingRect.top - 2 + window.pageYOffset],\r\n                        'orientation': 'left'});\r\n                    } else {\r\n                        childrenContextMenu = contextMenu(d.children, \r\n                                      {\r\n                                          'pos': [ boundingRect.left + boundingRect.width + window.pageXOffset,\r\n                                                boundingRect.top - 2 + window.pageYOffset],\r\n                                       'rootElement': currentThis,\r\n                                    'parentStart': [boundingRect.left + window.pageXOffset,\r\n                                      boundingRect.top - 2 + window.pageYOffset]});\r\n                    }\r\n\r\n                    d.childUid = childrenContextMenu.apply(this, [data,i,true,\r\n                                                           function() { }]);\r\n                    openChildMenuUid = d.childUid;\r\n                }\r\n\r\n\r\n                d3.select(this)\r\n                    .classed('d3-context-menu-selected', true)\r\n            \r\n            })\r\n            .on('mouseleave', function(d, i) {\r\n\r\n                if (openChildMenuUid == null) {\r\n                    d3.select(this)\r\n                        .classed('d3-context-menu-selected', false);\r\n                }\r\n            });\r\n\r\n            list.selectAll('.d3-context-menu-recursive')\r\n            .append('img')\r\n            .attr('src', ArrowIcon)\r\n            .attr('width', '14px')\r\n            .attr('height', '14px')\r\n            .style('position', 'absolute')\r\n            .style('right', '5px')\r\n            ;\r\n\r\n        // the openCallback allows an action to fire before the menu is displayed\r\n        // an example usage would be closing a tooltip\r\n        if (openCallback) {\r\n            if (openCallback(data, index) === false) {\r\n                return uid;\r\n            }\r\n        }\r\n\r\n        let contextMenuSelection = d3.select('.d3-context-menu-' + uid)\r\n            .style('display', 'block');\r\n\r\n        if (initialPos == null) {\r\n            d3.select('.d3-context-menu-' + uid)\r\n            .style('left', (d3.event.pageX - 2) + 'px')\r\n            .style('top', (d3.event.pageY - 2) + 'px')\r\n        } else {\r\n            d3.select('.d3-context-menu-' + uid)\r\n            .style('left', initialPos[0] + 'px')\r\n            .style('top', initialPos[1] + 'px')\r\n        }\r\n\r\n        // check if the menu disappears off the side of the window\r\n        let boundingRect = contextMenuSelection.node().getBoundingClientRect();\r\n\r\n        if (boundingRect.left + boundingRect.width > window.innerWidth || orientation == 'left') {\r\n            orientation = 'left';\r\n\r\n            // menu goes of the end of the window, position it the other way\r\n            if (initialPos == null) {\r\n                // place the menu where the user clicked\r\n                d3.select('.d3-context-menu-' + uid)\r\n                .style('left', (d3.event.pageX - 2 - boundingRect.width) + 'px')\r\n                .style('top', (d3.event.pageY - 2) + 'px')\r\n            } else {\r\n                if (parentStart != null) {\r\n                    d3.select('.d3-context-menu-' + uid)\r\n                    .style('left', (parentStart[0] - boundingRect.width) + 'px')\r\n                    .style('top', parentStart[1] + 'px')\r\n                } else {\r\n                    d3.select('.d3-context-menu-' + uid)\r\n                    .style('left', (initialPos[0] - boundingRect.width) + 'px')\r\n                    .style('top', initialPos[1] + 'px')\r\n                }\r\n            }\r\n            \r\n        }\r\n\r\n        // display context menu\r\n\r\n        if (previouslyMouseUp)\r\n            return uid;\r\n\r\n        d3.event.preventDefault();\r\n        d3.event.stopPropagation();\r\n        //d3.event.stopImmediatePropagation();\r\n        //\r\n        return uid;\r\n    };\r\n};\r\n","var numberSort = function(a,b) { return a - b; };\r\n\r\nexport function arraysEqual(a, b) {\r\n    // courtesy of \r\n    // http://stackoverflow.com/questions/3115982/how-to-check-if-two-arrays-are-equal-with-javascript\r\n  if (a === b) return true;\r\n  if (a === null || b === null) return false;\r\n  if (a.length != b.length) return false;\r\n\r\n  // If you don't care about the order of the elements inside\r\n  // the array, you should sort both arrays here.\r\n\r\n  for (var i = 0; i < a.length; ++i) {\r\n    if (a[i] !== b[i]) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function RNAUtilities() {\r\n    var self = this;\r\n\r\n    // the brackets to use when constructing dotbracket strings\r\n    // with pseudoknots\r\n    self.bracketLeft =  \"([{<ABCDEFGHIJKLMNOPQRSTUVWXYZ\".split(\"\");\r\n    self.bracketRight = \")]}>abcdefghijklmnopqrstuvwxyz\".split(\"\");\r\n\r\n    self.inverseBrackets = function(bracket) {\r\n        var res = {};\r\n        for (var i = 0; i < bracket.length; i++) {\r\n            res[bracket[i]] = i;\r\n        }\r\n        return res;\r\n    };\r\n\r\n    self.maximumMatching = function maximumMatching(pt){\r\n        // Courtesy of the great Ronny Lorenz\r\n\r\n        var n = pt[0];\r\n        var TURN = 0;    //minimal number of nucleotides in the hairpin\r\n\r\n        /* array init */\r\n        var mm = new Array(n + 1);\r\n        for(var i = 0; i <= n; i++){\r\n            mm[i] = new Array(n + 1);\r\n            for(var j = i; j <= n; j++)\r\n            mm[i][j] = 0;\r\n        }\r\n        var maximum = 0;\r\n\r\n        /* actual computation */\r\n        for(var i = n - TURN - 1; i > 0; i--)\r\n\r\n        for(var j = i + TURN + 1; j <= n; j++){\r\n            maximum = mm[i][j-1];\r\n\r\n            for(var l = j - TURN - 1; l >= i; l--) {\r\n                if(pt[l] === j) {\r\n\r\n                    // we have a base pair here\r\n                    maximum = Math.max(maximum, ((l > i) ? mm[i][l-1] : 0) + 1 + ((j - l - 1 > 0) ? mm[l+1][j-1] : 0));\r\n                }\r\n            }\r\n\r\n            mm[i][j] = maximum;\r\n        }\r\n\r\n        maximum = mm[1][n];\r\n\r\n        return mm;\r\n    };\r\n\r\n    self.backtrackMaximumMatching = function(mm, oldPt) {\r\n      var pt = Array.apply(null, \r\n                           Array(mm.length)).map(function() { return 0 }); \r\n                           //create an array containing zeros\r\n\r\n      self.mmBt(mm, pt, oldPt, 1, mm.length-1);\r\n      return pt;\r\n    }\r\n\r\n    self.mmBt = function(mm, pt, oldPt, i, j){\r\n        // Create a pairtable from the backtracking\r\n      var maximum = mm[i][j];\r\n      var TURN = 0;\r\n\r\n      if(j - i - 1 < TURN) return;    /* no more pairs */\r\n\r\n      if(mm[i][j-1] == maximum){      /* j is unpaired */\r\n        self.mmBt(mm, pt, oldPt, i, j-1);\r\n        return;\r\n      }\r\n\r\n      for(var q = j - TURN - 1; q >= i; q--){  /* j is paired with some q */\r\n        if (oldPt[j] !== q)\r\n            continue;\r\n\r\n        var leftPart     = (q > i) ? mm[i][q-1] : 0;\r\n        var enclosedPart = (j - q - 1 > 0) ? mm[q+1][j-1] : 0;\r\n\r\n        if(leftPart + enclosedPart + 1 == maximum) {\r\n            // there's a base pair between j and q\r\n            pt[q] = j;\r\n            pt[j] = q;\r\n\r\n            if(i < q) \r\n                self.mmBt(mm, pt, oldPt, i, q - 1);\r\n\r\n            self.mmBt(mm, pt, oldPt, q + 1, j - 1);\r\n            return;\r\n        }\r\n      }\r\n\r\n      //alert(i + \",\" + j + \": backtracking failed!\");\r\n      console.log('FAILED!!!' + i + ',' + j + ': backtracking failed!');\r\n\r\n    };\r\n\r\n    self.dotbracketToPairtable = function(dotbracket) {\r\n        // create an array and initialize it to 0\r\n        var pt = Array.apply(null, new Array(dotbracket.length + 1)).map(Number.prototype.valueOf,0);\r\n        \r\n        //  the first element is always the length of the RNA molecule\r\n        pt[0] = dotbracket.length;\r\n\r\n        // store the pairing partners for each symbol\r\n        var stack = {};\r\n        for (var i = 0; i < self.bracketLeft.length; i++) {\r\n            stack[i] = [];\r\n        }\r\n\r\n        // lookup the index of each symbol in the bracket array\r\n        var inverseBracketLeft = self.inverseBrackets(self.bracketLeft);\r\n        var inverseBracketRight = self.inverseBrackets(self.bracketRight);\r\n\r\n        for (var i = 0; i < dotbracket.length; i++) {\r\n            var a = dotbracket[i];\r\n            var ni = i + 1;\r\n\r\n            if (a == '.' || a == 'o') {\r\n                // unpaired\r\n                pt[ni] = 0;\r\n            } else {\r\n                if (a in inverseBracketLeft) {\r\n                    // open pair?\r\n                    stack[inverseBracketLeft[a]].push(ni);\r\n                } else if (a in inverseBracketRight){\r\n                    // close pair?\r\n                    var j = stack[inverseBracketRight[a]].pop();\r\n\r\n                    pt[ni] = j;\r\n                    pt[j] = ni;\r\n                } else {\r\n                    throw \"Unknown symbol in dotbracket string\";\r\n                }\r\n            }\r\n        }\r\n\r\n        for (var key in stack) {\r\n            if (stack[key].length > 0) {\r\n                throw \"Unmatched base at position \" + stack[key][0];\r\n            }\r\n        }\r\n\r\n        return pt;\r\n    };\r\n\r\n    self.insertIntoStack = function(stack, i, j) {\r\n        var k = 0;\r\n        while (stack[k].length > 0 && stack[k][stack[k].length - 1] < j) {\r\n            k += 1;\r\n        }\r\n\r\n        stack[k].push(j);\r\n        return k;\r\n    };\r\n\r\n    self.deleteFromStack = function(stack, j) {\r\n        var k = 0;\r\n        while (stack[k].length === 0 || stack[k][stack[k].length-1] != j) {\r\n            k += 1;\r\n        }\r\n        stack[k].pop();\r\n        return k;\r\n    };\r\n\r\n    self.pairtableToDotbracket = function(pt) {\r\n        // store the pairing partners for each symbol\r\n        var stack = {};\r\n        for (var i = 0; i < pt[0]; i++) {\r\n            stack[i] = [];\r\n        }\r\n\r\n        var seen = {};\r\n        var res = \"\";\r\n        var i;\r\n        for (var i = 1; i < pt[0] + 1; i++) {\r\n            if (pt[i] !== 0 && pt[i] in seen) {\r\n                throw \"Invalid pairtable contains duplicate entries\";\r\n            }\r\n            seen[pt[i]] = true;\r\n\r\n            if (pt[i] === 0) {\r\n                res += '.';\r\n            } else {\r\n                if (pt[i] > i) {\r\n                    res += self.bracketLeft[self.insertIntoStack(stack, i, pt[i])];\r\n                } else {\r\n                    res += self.bracketRight[self.deleteFromStack(stack, i)];\r\n                }\r\n            }\r\n        }\r\n\r\n        return res;\r\n    };\r\n\r\n    self.findUnmatched = function(pt, from, to) {\r\n        /*\r\n         * Find unmatched nucleotides in this molecule.\r\n         */\r\n        var toRemove = [];\r\n        var unmatched = [];\r\n\r\n        var origFrom = from;\r\n        var origTo = to;\r\n        var i;\r\n\r\n        for (var i = from; i <= to; i++)\r\n            if (pt[i] !== 0 && (pt[i] < from || pt[i] > to))\r\n                unmatched.push([i,pt[i]]);\r\n\r\n        for (var i = origFrom; i <= origTo; i++) {\r\n            while (pt[i] === 0 && i <= origTo) i++;\r\n\r\n            to = pt[i];\r\n\r\n            while (pt[i] === to) {\r\n                i++;\r\n                to--;\r\n            }\r\n            \r\n            toRemove = toRemove.concat(self.findUnmatched(pt, i, to));\r\n        }\r\n\r\n        if (unmatched.length > 0)\r\n            toRemove.push(unmatched);\r\n\r\n        return toRemove;\r\n    };\r\n\r\n    self.removePseudoknotsFromPairtable = function(pt) {\r\n        /* Remove the pseudoknots from this structure in such a fashion\r\n         * that the least amount of base-pairs need to be broken\r\n         *\r\n         * The pairtable is manipulated in place and a list of tuples\r\n         * indicating the broken base pairs is returned.\r\n         */\r\n\r\n        var mm = self.maximumMatching(pt);\r\n        var newPt = self.backtrackMaximumMatching(mm, pt);\r\n        var removed = [];\r\n\r\n        for (var i = 1; i < pt.length; i++) {\r\n            if (pt[i] < i)\r\n                continue;\r\n\r\n            if (newPt[i] != pt[i])  {\r\n                removed.push([i, pt[i]]);\r\n                pt[pt[i]] = 0;\r\n                pt[i] = 0;\r\n            }\r\n        }\r\n\r\n        return removed;\r\n    };\r\n\r\n    self.ptToElements = function(pt, level, i, j, dotBracketBreaks) {\r\n        /* Convert a pair table to a list of secondary structure \r\n         * elements:\r\n         *\r\n         * [['s',1,[2,3]]\r\n         *\r\n         * The 's' indicates that an element can be a stem. It can also be\r\n         * an interior loop ('i'), a hairpin loop ('h') or a multiloop ('m')\r\n         *\r\n         * The second number (1 in this case) indicates the depth or\r\n         * how many base pairs have to be broken to get to this element.\r\n         *\r\n         * Finally, there is the list of nucleotides which are part of\r\n         * of this element.\r\n         */\r\n        var elements = [];\r\n        var u5 = [i-1];\r\n        var u3 = [j+1];\r\n\r\n        if (arguments.length < 5)\r\n            dotBracketBreaks = [];\r\n\r\n        if (i > j)\r\n            return [];\r\n            \r\n            //iterate over the unpaired regions on either side\r\n            //this is either 5' and 3' unpaired if level == 0\r\n            //or an interior loop or a multiloop\r\n            for (; pt[i] === 0; i++) { u5.push(i); }\r\n            for (; pt[j] === 0; j--) { u3.push(j); }\r\n\r\n            if (i > j) {\r\n                //hairpin loop or one large unpaired molecule\r\n                u5.push(i);\r\n                if (level === 0)\r\n                    return [['e',level, u5.sort(numberSort)]];\r\n                else {\r\n                    // check to see if we have chain breaks due\r\n                    // to multiple strands in the input\r\n                    var external = false;\r\n                    var left = [];\r\n                    var right = [];\r\n                    for (var k = 0; k < u5.length; k++) {\r\n                        if (external)\r\n                            right.push(u5[k]);\r\n                        else\r\n                            left.push(u5[k]);\r\n\r\n                        if (dotBracketBreaks.indexOf(u5[k]) >= 0)\r\n                            external = true;\r\n                    }\r\n\r\n                    if (external) {\r\n                        return [['h',level, u5.sort(numberSort)]];\r\n                    }\r\n                    else\r\n                        // if not, this is a simple hairpin loop\r\n                        return [['h',level, u5.sort(numberSort)]];\r\n                }\r\n            }\r\n\r\n            if (pt[i] != j) {\r\n                //multiloop\r\n                var m = u5;\r\n                var k = i;\r\n\r\n                // the nucleotide before and the starting nucleotide\r\n                m.push(k);\r\n                while (k <= j) {\r\n                    // recurse into a stem\r\n                    elements = elements.concat(self.ptToElements(pt, level, k, pt[k], dotBracketBreaks));\r\n\r\n                    // add the nucleotides between stems\r\n                    m.push(pt[k]);\r\n                    k = pt[k] + 1;\r\n                    for (; pt[k] === 0 && k <= j; k++) { m.push(k);}\r\n                    m.push(k);\r\n                }\r\n                m.pop();\r\n                m = m.concat(u3);\r\n                \r\n                if (m.length > 0) {\r\n                    if (level === 0)\r\n                        elements.push(['e', level, m.sort(numberSort)]);\r\n                    else\r\n                        elements.push(['m', level, m.sort(numberSort)]);\r\n                }\r\n                \r\n                return elements;\r\n            }\r\n\r\n            if (pt[i] === j) {\r\n                //interior loop\r\n                u5.push(i);\r\n                u3.push(j);\r\n\r\n                var combined = u5.concat(u3);\r\n                if (combined.length > 4) {\r\n                    if (level === 0)\r\n                        elements.push(['e',level, u5.concat(u3).sort(numberSort)]);\r\n                    else\r\n                        elements.push(['i',level, u5.concat(u3).sort(numberSort)]);\r\n                }\r\n            } \r\n\r\n            var s = [];\r\n            //go through the stem\r\n            while (pt[i] === j && i < j) {\r\n                //one stem\r\n                s.push(i);\r\n                s.push(j);\r\n\r\n                i += 1;\r\n                j -= 1;\r\n\r\n                level += 1;\r\n            }\r\n\r\n            u5 = [i-1];\r\n            u3 = [j+1];\r\n            elements.push(['s', level, s.sort(numberSort)]);\r\n\r\n        return elements.concat(self.ptToElements(pt, level, i, j, dotBracketBreaks));\r\n    };\r\n\r\n}\r\n\r\nexport var rnaUtilities = new RNAUtilities();\r\n\r\nexport function ColorScheme(colorsText) {\r\n    var self = this;\r\n    self.colorsText = colorsText;\r\n\r\n    self.parseRange = function(rangeText) {\r\n        //parse a number range such as 1-10 or 3,7,9 or just 7\r\n        var parts = rangeText.split(',')\r\n        var nums = [];\r\n\r\n        for (var i = 0; i < parts.length; i++) {\r\n            //could be 1 or 10-11  or something like that\r\n            var parts1 = parts[i].split('-');\r\n\r\n            if (parts1.length == 1)\r\n                nums.push(parseInt(parts1[0]));\r\n            else if (parts1.length == 2) {\r\n                var from = parseInt(parts1[0]);\r\n                var to = parseInt(parts1[1]);\r\n\r\n                // add each number in this range\r\n                for (var j = from; j <= to; j++) \r\n                    nums.push(j)\r\n            } else {\r\n                console.log('Malformed range (too many dashes):', rangeText);\r\n            }\r\n        }\r\n\r\n        return nums;\r\n    }\r\n\r\n    self.parseColorText = function(colorText) {\r\n        /* Parse the text of an RNA color string. Instructions and description\r\n         * of the format are given below.\r\n         *\r\n         * The return is a json double dictionary indexed first by the \r\n         * molecule name, then by the nucleotide. This is then applied\r\n         * by force.js to the RNAs it is displaying. When no molecule\r\n         * name is specified, the color is applied to all molecules*/\r\n        var lines = colorText.split('\\n');\r\n        var currMolecule = '';\r\n        var counter = 1;\r\n        var colorsJson = {colorValues: {'':{}}, range:['white', 'steelblue']};\r\n        var domainValues = [];\r\n\r\n\r\n        for (var i = 0; i < lines.length; i++) {\r\n\r\n            if (lines[i][0] == '>') {\r\n                // new molecule\r\n                currMolecule = lines[i].trim().slice(1);\r\n                counter = 1;\r\n\r\n                colorsJson.colorValues[currMolecule] = {};\r\n                continue;\r\n            }\r\n\r\n            let words = lines[i].trim().split(/[\\s]+/);\r\n\r\n            for (var j = 0; j < words.length; j++) {\r\n                if (isNaN(words[j])) {\r\n                    if (words[j].search('range') === 0) {\r\n                        //there's a color scale in this entry\r\n                        let parts = words[j].split('=');\r\n                        let partsRight = parts[1].split(':')\r\n                        colorsJson.range = [partsRight[0], partsRight[1]];\r\n                        continue;\r\n                    }\r\n\r\n                    if (words[j].search('domain') == 0) {\r\n                        //there's a color scale in this entry\r\n                        let parts = words[j].split('=');\r\n                        let partsRight = parts[1].split(':')\r\n                        colorsJson.domain = [partsRight[0], partsRight[1]];\r\n                        continue;\r\n                    }\r\n\r\n                    // it's not a number, should be a combination \r\n                    // of a number (nucleotide #) and a color\r\n                    let parts = words[j].split(':');\r\n                    let nums = self.parseRange(parts[0]);\r\n                    let color = parts[1]\r\n\r\n                    for (var k = 0; k < nums.length; k++) {\r\n                        if (isNaN(color)) {\r\n                            colorsJson.colorValues[currMolecule][nums[k]] = color;\r\n                        } else {\r\n                            colorsJson.colorValues[currMolecule][nums[k]] = +color;\r\n                            domainValues.push(Number(color));\r\n                        }\r\n                    }\r\n                } else {\r\n                    //it's a number, so we add it to the list of values\r\n                    //seen for this molecule\r\n                    colorsJson.colorValues[currMolecule][counter] = Number(words[j]);\r\n                    counter += 1;\r\n\r\n                    domainValues.push(Number(words[j]));\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!('domain' in colorsJson))\r\n            colorsJson.domain = [Math.min.apply(null, domainValues), Math.max.apply(null, domainValues)];\r\n\r\n        self.colorsJson = colorsJson;\r\n\r\n        return self;\r\n    };\r\n\r\n    self.normalizeColors = function() {\r\n        /* \r\n         * Normalize the passed in values so that they range from\r\n         * 0 to 1\r\n         */\r\n        var value;\r\n\r\n        for (var moleculeName in self.colorsJson) {\r\n            var minNum = Number.MAX_VALUE;\r\n            var maxNum = Number.MIN_VALUE;\r\n\r\n            // iterate once to find the min and max values;\r\n            for (var resnum in self.colorsJson.colorValues[moleculeName]) {\r\n                value = self.colorsJson.colorValues[moleculeName][resnum];\r\n                if (typeof value == 'number') {\r\n                    if (value < minNum)\r\n                        minNum = value;\r\n                    if (value > maxNum)\r\n                        maxNum = value;\r\n                }\r\n            }\r\n\r\n            // iterate again to normalize\r\n            for (resnum in self.colorsJson.colorValues[moleculeName]) {\r\n                value = self.colorsJson.colorValues[moleculeName][resnum];\r\n                if (typeof value == 'number') {\r\n                    self.colorsJson.colorValues[moleculeName][resnum] = (value - minNum ) / (maxNum - minNum);\r\n                }\r\n            }\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.parseColorText(self.colorsText);\r\n    return self;\r\n}\r\n","import {arraysEqual,RNAUtilities,rnaUtilities} from './rnautils.js';\r\nimport slugid from 'slugid';\r\n\r\nvar numberSort = function(a,b) { return a - b; };\r\n\r\nif (typeof(String.prototype.trim) === 'undefined') {\r\n    String.prototype.trim = function() {\r\n        return String(this).replace(/^\\s+|\\s+$/g, '');\r\n    };\r\n}\r\n\r\nexport function ProteinGraph(structName, size, uid) {\r\n    var self = this;\r\n\r\n    self.type = 'protein';\r\n    self.size = size;\r\n    self.nodes = [{'name': 'P',\r\n                   'num': 1,\r\n                   'radius': 3 *  Math.sqrt(size),\r\n                   'rna': self,\r\n                   'nodeType': 'protein',\r\n                   'structName': structName,\r\n                   'elemType': 'p',\r\n                   'size': size,\r\n                   'uid': slugid.nice()}];\r\n\r\n    self.links = [];\r\n    self.uid = slugid.nice();\r\n\r\n    self.addUids = function(uids) {\r\n        for (let i = 0; i < uids.length; i++)\r\n            self.nodes[i].uid = uids[i];\r\n\r\n        return self;\r\n    };\r\n\r\n    self.getUids = function() {\r\n        /* Get the positions of each node so that they\r\n         * can be passed to elementsToJson later\r\n         */\r\n        uids = [];\r\n        for (let i = 0; i < self.dotbracket.length; i++)\r\n            uids.push(self.nodes[i].uid);\r\n\r\n        return uids;\r\n    };\r\n\r\n}\r\n\r\nexport function RNAGraph(seq = '', dotbracket = '', structName = '', startNumber = 1) {\r\n    var self = this;\r\n\r\n    self.type = 'rna';\r\n    self.circularizeExternal = false;\r\n    self.seq = seq;\r\n    self.dotbracket = dotbracket;  //i.e. ..((..))..\r\n    self.structName = structName;\r\n    self.circular = false;\r\n\r\n    if (self.dotbracket.slice(-1) == '*') {\r\n        //circular RNA\r\n        self.dotbracket = self.dotbracket.slice(0, -1);\r\n        self.circular = true;\r\n    }\r\n\r\n    self.uid = slugid.nice();\r\n\r\n    self.elements = [];            //store the elements and the\r\n                                   //nucleotides they contain\r\n    self.pseudoknotPairs = [];\r\n    self.nucsToNodes = {};\r\n\r\n    self.addUids = function(uids) {\r\n        let nucleotideNodes = self.nodes.filter(function(d) { return d.nodeType == 'nucleotide'; });\r\n\r\n        for (let i = 0; i < uids.length && i < nucleotideNodes.length; i++) {\r\n            nucleotideNodes[i].uid = uids[i];\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.computePairtable = function() {\r\n        self.pairtable = rnaUtilities.dotbracketToPairtable(self.dotbracket);\r\n    };\r\n\r\n    self.removeBreaks = function(targetString) {\r\n        // Remove all chain breaks (denoted with a '&', which indicate\r\n        // that the input represents more than one strand)\r\n        var breaks = [];\r\n        var breakIndex = -1;\r\n\r\n        while ((breakIndex = targetString.indexOf('&')) >= 0) {\r\n            breaks.push(breakIndex);\r\n            targetString = targetString.substring(0, breakIndex) + targetString.substring(breakIndex+1, targetString.length);\r\n\r\n        }\r\n\r\n        return {targetString: targetString,  breaks: breaks};\r\n    };\r\n\r\n    var ret = self.removeBreaks(self.dotbracket);\r\n    self.dotbracket = ret.targetString;\r\n    self.dotBracketBreaks = ret.breaks;\r\n\r\n    ret = self.removeBreaks(self.seq);\r\n    self.seq = ret.targetString;\r\n    self.seqBreaks = ret.breaks;\r\n\r\n    self.rnaLength = self.dotbracket.length;\r\n\r\n    if (!arraysEqual(self.dotBracketBreaks, self.seqBreaks)) {\r\n        console.log('WARNING: Sequence and structure breaks not equal');\r\n        console.log('WARNING: Using the breaks in the structure');\r\n    }\r\n\r\n    self.computePairtable();\r\n\r\n    self.addPositions = function(nodeType, positions) {\r\n        let labelNodes = self.nodes.filter(function(d) { return d.nodeType == nodeType; });\r\n\r\n        for  (let i = 0; i < labelNodes.length; i++) {\r\n            labelNodes[i].x = positions[i][0];\r\n            labelNodes[i].y = positions[i][1];\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.breakNodesToFakeNodes = function() {\r\n        // convert all the nodes following breaks to fake nodes\r\n        let labelNodes = self.nodes.filter(function(d) { return d.nodeType == 'nucleotide'; });\r\n\r\n        // if a node was an artifical break node, convert it to a middle\r\n        for (let i = 0; i < labelNodes.length; i++) {\r\n            if (self.dotBracketBreaks.indexOf(i) >= 0) {\r\n                labelNodes[i].nodeType = 'middle';\r\n                labelNodes[i+1].nodeType = 'middle';\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < self.elements.length; i++) {\r\n            var broken = false;\r\n\r\n            // change the elemType of the other nodes in the element containing\r\n            // the break\r\n            for (let j = 0; j < self.elements[i][2].length; j++) {\r\n                if (self.dotBracketBreaks.indexOf(self.elements[i][2][j]) >= 0)\r\n                    broken = true;\r\n            }\r\n\r\n            if (broken) {\r\n                self.elements[i][2].map(function(x) {\r\n                    if (x == 0)\r\n                        return;\r\n                    self.nodes[x-1].elemType = 'e';\r\n                });\r\n            } else {\r\n                self.elements[i][2].map(function(x) {\r\n                    if (x == 0)\r\n                        return;\r\n                    self.nodes[x-1].elemType = self.elements[i][0];\r\n                });\r\n            }\r\n        }\r\n        return self;\r\n    };\r\n\r\n    self.getPositions = function(nodeType) {\r\n        var positions = [];\r\n        let nucleotideNodes = self.nodes.filter(function(d) { return d.nodeType == nodeType; });\r\n\r\n        for (let i = 0; i < nucleotideNodes.length; i++)\r\n            positions.push([nucleotideNodes[i].x, nucleotideNodes[i].y]);\r\n\r\n        return positions;\r\n    };\r\n\r\n    self.getUids = function() {\r\n        /* Get the positions of each node so that they\r\n         * can be passed to elementsToJson later\r\n         */\r\n        var uids = [];\r\n        for (let i = 0; i < self.dotbracket.length; i++)\r\n            uids.push(self.nodes[i].uid);\r\n\r\n        return uids;\r\n    };\r\n\r\n    self.reinforceStems = function() {\r\n        var pt = self.pairtable;\r\n        let relevantElements = self.elements.filter( function(d) {\r\n            return d[0] == 's' && d[2].length >= 4;\r\n        });\r\n\r\n        for (let i = 0; i < relevantElements.length; i++) {\r\n            let allNucs = relevantElements[i][2];\r\n            let nucs = allNucs.slice(0, allNucs.length / 2);\r\n\r\n            for (let j = 0; j < nucs.length-1; j++) {\r\n                self.addFakeNode([nucs[j], nucs[j+1], pt[nucs[j+1]], pt[nucs[j]]]);\r\n            }\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.reinforceLoops = function() {\r\n        /*\r\n         * Add a set of fake nodes to enforce the structure\r\n         */\r\n        var filterNucs = function(d) {\r\n            return d !== 0 && d <= self.dotbracket.length;\r\n        };\r\n\r\n        for (let i = 0; i < self.elements.length; i++) {\r\n            if (self.elements[i][0] == 's' || (!self.circularizeExternal && self.elements[i][0] == 'e'))\r\n                continue;\r\n\r\n            var nucs = self.elements[i][2].filter(filterNucs);\r\n\r\n            if (self.elements[i][0] == 'e') {\r\n                var newNode1 = {'name': '',\r\n                    'num': -3,\r\n                    //'radius': 18 * radius -6,\r\n                    'radius': 0,\r\n                    'rna': self,\r\n                    'nodeType': 'middle',\r\n                    'elemType': 'f',\r\n                    'nucs': [],\r\n                    'x': self.nodes[self.rnaLength-1].x,\r\n                    'y': self.nodes[self.rnaLength-1].y,\r\n                    'px': self.nodes[self.rnaLength-1].px,\r\n                    'py': self.nodes[self.rnaLength-1].py,\r\n                    'uid': slugid.nice() };\r\n                var newNode2 = {'name': '',\r\n                    'num': -2,\r\n                    //'radius': 18 * radius -6,\r\n                    'radius': 0,\r\n                    'rna': self,\r\n                    'nodeType': 'middle',\r\n                    'elemType': 'f',\r\n                    'nucs': [],\r\n                    'x': self.nodes[0].x,\r\n                    'y': self.nodes[0].y,\r\n                    'px': self.nodes[0].px,\r\n                    'py': self.nodes[0].py,\r\n                    'uid': slugid.nice() };\r\n\r\n                    nucs.push(self.nodes.length+1);\r\n                    nucs.push(self.nodes.length+2);\r\n                    self.nodes.push(newNode1);\r\n                    self.nodes.push(newNode2);\r\n            }\r\n\r\n\r\n            self.addFakeNode(nucs);\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.updateLinkUids = function() {\r\n        for (let i = 0; i < self.links.length; i++) {\r\n            self.links[i].uid = self.links[i].source.uid + self.links[i].target.uid;\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.addFakeNode = function(nucs) {\r\n        var linkLength = 18; //make sure this is consistent with the value in force.js\r\n        var nodeWidth = 6;\r\n        var angle = (3.1415 * 2) / (2 * nucs.length);\r\n        var radius =  linkLength / (2 * Math.tan(angle));\r\n\r\n        var fakeNodeUid = '';\r\n\r\n        for (let i = 0; i < nucs.length; i++)\r\n            fakeNodeUid += self.nodes[nucs[i]-1].uid;\r\n\r\n        var newNode = {'name': '',\r\n                         'num': -1,\r\n                         //'radius': 18 * radius -6,\r\n                         'radius': radius,\r\n                         'rna': self,\r\n                         'nodeType': 'middle',\r\n                         'elemType': 'f',\r\n                         'nucs': nucs,\r\n                         'uid': fakeNodeUid };\r\n        self.nodes.push(newNode);\r\n\r\n        var newX = 0;\r\n        var newY = 0;\r\n        var coordsCounted = 0;\r\n\r\n        angle = (nucs.length - 2) * 3.14159 / (2 * nucs.length);\r\n        radius = 0.5 / Math.cos(angle);\r\n\r\n        for (let j = 0; j < nucs.length; j++) {\r\n            if (nucs[j] === 0 || nucs[j] > self.dotbracket.length)\r\n                continue;\r\n\r\n            //link to the center node\r\n            self.links.push({'source': self.nodes[nucs[j] - 1],\r\n                             'target': self.nodes[self.nodes.length-1],\r\n                             'linkType': 'fake',\r\n                             'value': radius,\r\n                             'uid': slugid.nice() });\r\n\r\n            if (nucs.length > 4) {\r\n                //link across the loop\r\n                self.links.push({'source': self.nodes[nucs[j] - 1],\r\n                                 'target': self.nodes[nucs[(j + Math.floor(nucs.length / 2)) % nucs.length] - 1],\r\n                                 'linkType': 'fake',\r\n                                 'value': radius * 2,\r\n                                 'uid': slugid.nice() });\r\n            }\r\n\r\n            var ia = ((nucs.length - 2) * 3.14159) / nucs.length;\r\n            var c = 2 * Math.cos(3.14159 / 2 - ia / 2);\r\n            //link to over-neighbor\r\n            self.links.push({'source': self.nodes[nucs[j] - 1],\r\n                             'target': self.nodes[nucs[(j + 2) % nucs.length] - 1],\r\n                             'linkType': 'fake',\r\n                             'value': c});\r\n\r\n            // calculate the mean of the coordinats in this loop\r\n            // and place the fake node there\r\n            var fromNode = self.nodes[nucs[j]-1];\r\n            if ('x' in fromNode) {\r\n                newX += fromNode.x;\r\n                newY += fromNode.y;\r\n\r\n                coordsCounted += 1;\r\n            }\r\n        }\r\n\r\n        if (coordsCounted > 0) {\r\n            // the nucleotides had set positions so we can calculate the position\r\n            // of the fake node\r\n            newNode.x = newX / coordsCounted;\r\n            newNode.y = newY / coordsCounted;\r\n            newNode.px = newNode.x;\r\n            newNode.py = newNode.y;\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.connectFakeNodes = function() {\r\n        var linkLength = 18;\r\n\r\n        // We want to be able to connect all of the fake nodes\r\n        // and create a structure consisting of just them\r\n        var filterOutNonFakeNodes = function(d) {\r\n            return d.nodeType == 'middle';\r\n        }\r\n\r\n        var nucsToNodes = {};\r\n        var fakeNodes = self.nodes.filter(filterOutNonFakeNodes);\r\n        var linked = {};\r\n\r\n        // initialize the nucleotides to nodes\r\n        for (var i = 1; i <= self.nodes.length; i++)\r\n            nucsToNodes[i] = [];\r\n\r\n        for (var i = 0; i < fakeNodes.length; i++) {\r\n            var thisNode = fakeNodes[i];\r\n\r\n            // each fake node represents a certain set of nucleotides (thisNode.nucs)\r\n            for (var j = 0; j < thisNode.nucs.length; j++) {\r\n                var thisNuc = thisNode.nucs[j];\r\n\r\n                // check to see if this nucleotide has been seen in another fake node\r\n                // if it has, then we add a link between the two nodes\r\n                for (var k = 0; k < nucsToNodes[thisNuc].length; k++) {\r\n                    if (JSON.stringify([nucsToNodes[thisNuc][k].uid, thisNode.uid].sort()) in linked)\r\n                        continue; //already linked\r\n\r\n                    var distance = nucsToNodes[thisNuc][k].radius + thisNode.radius;\r\n\r\n                    self.links.push({'source': nucsToNodes[thisNuc][k],\r\n                                      'target': thisNode,\r\n                                      'value': distance / linkLength,\r\n                                      'linkType': 'fake_fake'});\r\n\r\n                    // note that we've already seen this link\r\n                    linked[JSON.stringify([nucsToNodes[thisNuc][k].uid, thisNode.uid].sort())] = true;\r\n                }\r\n\r\n                nucsToNodes[thisNuc].push(thisNode);\r\n            }\r\n        }\r\n\r\n        return self;\r\n\r\n    };\r\n\r\n    self.addExtraLinks = function(extraLinks) {\r\n        if (typeof extraLinks == 'undefined')\r\n            return self;\r\n\r\n        for (var i = 0; i < extraLinks.length; i++) {\r\n            var source = self.getNodeFromNucleotides(extraLinks[i].from);\r\n            var target = self.getNodeFromNucleotides(extraLinks[i].to);\r\n\r\n            var newLink = {'source': source, 'target': target, 'linkType': 'extra',\r\n                'extraLinkType': extraLinks[i].linkType, 'uid': slugid.nice() };\r\n\r\n                self.links.push(newLink);\r\n        }\r\n\r\n        return self;\r\n    }\r\n\r\n\r\n    self.elementsToJson = function() {\r\n        /* Convert a set of secondary structure elements to a json\r\n         * representation of the graph that can be used with d3's\r\n         * force-directed layout to generate a visualization of\r\n         * the structure.\r\n         */\r\n        var pt = self.pairtable;\r\n        var elements = self.elements;\r\n\r\n        self.nodes = [];\r\n        self.links = [];\r\n\r\n        //create a reverse lookup so we can find out the type\r\n        //of element that a node is part of\r\n        var elemTypes = {};\r\n\r\n        //sort so that we count stems last\r\n        self.elements.sort();\r\n\r\n        for (let i = 0; i < self.elements.length; i++) {\r\n            var nucs = self.elements[i][2];\r\n            for (let j = 0; j < nucs.length; j++) {\r\n                elemTypes[nucs[j]] = self.elements[i][0];\r\n            }\r\n        }\r\n\r\n        for (let i = 1; i <= pt[0]; i++) {\r\n            var nodeName = self.seq[i-1];\r\n\r\n            if (self.dotBracketBreaks.indexOf(i-1) >= 0 ||\r\n                self.dotBracketBreaks.indexOf(i-2) >= 0) {\r\n                nodeName = '';\r\n            }\r\n\r\n            //create a node for each nucleotide\r\n            self.nodes.push({'name': nodeName,\r\n                             'num': startNumber + i - 1,\r\n                             'radius': 5,\r\n                             'rna': self,\r\n                             'nodeType': 'nucleotide',\r\n                             'structName': self.structName,\r\n                             'elemType': elemTypes[i],\r\n                             'uid': slugid.nice(),\r\n                             'linked': false});\r\n        }\r\n\r\n        for (let i = 0; i < self.nodes.length; i++) {\r\n            if (i === 0)\r\n                self.nodes[i].prevNode = null;\r\n            else {\r\n                self.nodes[i].prevNode = self.nodes[i-1];\r\n            }\r\n\r\n            if (i == self.nodes.length-1)\r\n                self.nodes[i].nextNode = null;\r\n            else {\r\n                self.nodes[i].nextNode = self.nodes[i+1];\r\n            }\r\n        }\r\n\r\n        for (let i = 1; i <= pt[0]; i++) {\r\n\r\n            if (pt[i] !== 0) {\r\n                // base-pair links\r\n                self.links.push({'source': self.nodes[i-1],\r\n                                 'target': self.nodes[pt[i]-1],\r\n                                 'linkType': 'basepair',\r\n                                 'value': 1,\r\n                                 'uid': slugid.nice() });\r\n            }\r\n\r\n            if (i > 1) {\r\n                // backbone links\r\n                if (self.dotBracketBreaks.indexOf(i-1) === -1 &&\r\n                    self.dotBracketBreaks.indexOf(i-2) == -1 &&\r\n                    self.dotBracketBreaks.indexOf(i-3) == -1) {\r\n                    // there is no break in the strands here\r\n                    // we can add a backbone link\r\n                    self.links.push({'source': self.nodes[i-2],\r\n                                    'target': self.nodes[i-1],\r\n                                    'linkType': 'backbone',\r\n                                    'value': 1,\r\n                                    'uid': slugid.nice() });\r\n                    self.nodes[i-1].linked = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        //add the pseudoknot links\r\n        for (let i = 0; i < self.pseudoknotPairs.length; i++) {\r\n            self.links.push({'source': self.nodes[self.pseudoknotPairs[i][0]-1],\r\n                            'target': self.nodes[self.pseudoknotPairs[i][1]-1],\r\n                            'linkType': 'pseudoknot',\r\n                            'value': 1,\r\n                            'uid': slugid.nice()});\r\n        }\r\n\r\n        if (self.circular) {\r\n            self.links.push({'source': self.nodes[0],\r\n                            'target': self.nodes[self.rnaLength-1],\r\n                            'linkType': 'backbone',\r\n                            'value': 1,\r\n                            'uid': slugid.nice() });\r\n\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.ptToElements = function(pt, level, i, j) {\r\n        /* Convert a pair table to a list of secondary structure\r\n         * elements:\r\n         *\r\n         * [['s',1,[2,3]]\r\n         *\r\n         * The 's' indicates that an element can be a stem. It can also be\r\n         * an interior loop ('i'), a hairpin loop ('h') or a multiloop ('m')\r\n         *\r\n         * The second number (1 in this case) indicates the depth or\r\n         * how many base pairs have to be broken to get to this element.\r\n         *\r\n         * Finally, there is the list of nucleotides which are part of\r\n         * of this element.\r\n         */\r\n        var elements = [];\r\n        var u5 = [i-1];\r\n        var u3 = [j+1];\r\n\r\n        if (i > j)\r\n            return [];\r\n\r\n            //iterate over the unpaired regions on either side\r\n            //this is either 5' and 3' unpaired if level == 0\r\n            //or an interior loop or a multiloop\r\n            for (; pt[i] === 0; i++) { u5.push(i); }\r\n            for (; pt[j] === 0; j--) { u3.push(j); }\r\n\r\n            if (i > j) {\r\n                //hairpin loop or one large unpaired molecule\r\n                u5.push(i);\r\n                if (level === 0)\r\n                    return [['e',level, u5.sort(numberSort)]];\r\n                else {\r\n                    // check to see if we have chain breaks due\r\n                    // to multiple strands in the input\r\n                    var external = false;\r\n                    var left = [];\r\n                    var right = [];\r\n                    for (var k = 0; k < u5.length; k++) {\r\n                        if (external)\r\n                            right.push(u5[k]);\r\n                        else\r\n                            left.push(u5[k]);\r\n\r\n                        if (self.dotBracketBreaks.indexOf(u5[k]) >= 0)\r\n                            external = true;\r\n                    }\r\n\r\n                    if (external) {\r\n                        return [['h',level, u5.sort(numberSort)]];\r\n                    }\r\n                    else\r\n                        // if not, this is a simple hairpin loop\r\n                        return [['h',level, u5.sort(numberSort)]];\r\n                }\r\n            }\r\n\r\n            if (pt[i] != j) {\r\n                //multiloop\r\n                var m = u5;\r\n                var k = i;\r\n\r\n                // the nucleotide before and the starting nucleotide\r\n                m.push(k);\r\n                while (k <= j) {\r\n                    // recurse into a stem\r\n                    elements = elements.concat(self.ptToElements(pt, level, k, pt[k]));\r\n\r\n                    // add the nucleotides between stems\r\n                    m.push(pt[k]);\r\n                    k = pt[k] + 1;\r\n                    for (; pt[k] === 0 && k <= j; k++) { m.push(k);}\r\n                    m.push(k);\r\n                }\r\n                m.pop();\r\n                m = m.concat(u3);\r\n\r\n                if (m.length > 0) {\r\n                    if (level === 0)\r\n                        elements.push(['e', level, m.sort(numberSort)]);\r\n                    else\r\n                        elements.push(['m', level, m.sort(numberSort)]);\r\n                }\r\n\r\n                return elements;\r\n            }\r\n\r\n            if (pt[i] === j) {\r\n                //interior loop\r\n                u5.push(i);\r\n                u3.push(j);\r\n\r\n                var combined = u5.concat(u3);\r\n                if (combined.length > 4) {\r\n                    if (level === 0)\r\n                        elements.push(['e',level, u5.concat(u3).sort(numberSort)]);\r\n                    else\r\n                        elements.push(['i',level, u5.concat(u3).sort(numberSort)]);\r\n                }\r\n            }\r\n\r\n            var s = [];\r\n            //go through the stem\r\n            while (pt[i] === j && i < j) {\r\n                //one stem\r\n                s.push(i);\r\n                s.push(j);\r\n\r\n                i += 1;\r\n                j -= 1;\r\n\r\n                level += 1;\r\n            }\r\n\r\n            u5 = [i-1];\r\n            u3 = [j+1];\r\n            elements.push(['s', level, s.sort(numberSort)]);\r\n\r\n        return elements.concat(self.ptToElements(pt, level, i, j));\r\n    };\r\n\r\n    self.addLabels = function(startNumber = 1, labelInterval = 10) {\r\n        if (labelInterval === 0)\r\n            return self;\r\n\r\n        for (let i = 1; i <= self.rnaLength; i++) {\r\n            // add labels\r\n            if (i % labelInterval === 0) {\r\n                //create a node for each label\r\n                let newX, newY;\r\n\r\n                let thisNode = self.nodes[i-1];\r\n                let prevNode, nextNode;\r\n                let prevVec, nextVec;\r\n\r\n                if (self.rnaLength == 1) {\r\n                    nextVec = [thisNode.x - 15, thisNode.y];\r\n                    prevVec = [thisNode.x - 15, thisNode.y];\r\n                } else {\r\n                    // if we're labelling the first node, then label it in relation to the last\r\n                    if (i == 1)\r\n                        prevNode = self.nodes[self.rnaLength - 1];\r\n                    else\r\n                        prevNode = self.nodes[i - 2];\r\n\r\n                    // if we're labelling the last node, then label it in relation to the first\r\n                    if (i == self.rnaLength)\r\n                        nextNode = self.nodes[0];\r\n                    else\r\n                        nextNode = self.nodes[i];\r\n\r\n                    // this nucleotide and its neighbors are paired\r\n                    if (self.pairtable[nextNode.num - startNumber+1] !== 0 &&\r\n                        self.pairtable[prevNode.num - startNumber+1] !== 0 &&\r\n                        self.pairtable[thisNode.num - startNumber+1] !== 0) {\r\n\r\n                        prevNode = nextNode = self.nodes[self.pairtable[thisNode.num - startNumber+1]-1];\r\n                    }\r\n\r\n                    // this node is paired but at least one of its neighbors is unpaired\r\n                    // place the label in the direction of the two neighbors\r\n                    if (self.pairtable[thisNode.num - startNumber+1] !== 0 && (\r\n                        self.pairtable[nextNode.num - startNumber+1] === 0 ||\r\n                        self.pairtable[prevNode.num - startNumber+1] === 0)) {\r\n                        nextVec = [thisNode.x - nextNode.x, thisNode.y - nextNode.y];\r\n                        prevVec = [thisNode.x - prevNode.x, thisNode.y - prevNode.y];\r\n\r\n                    } else {\r\n                        nextVec = [nextNode.x - thisNode.x, nextNode.y - thisNode.y];\r\n                        prevVec = [prevNode.x - thisNode.x, prevNode.y - thisNode.y];\r\n                    }\r\n                }\r\n\r\n                var combinedVec = [nextVec[0] + prevVec[0], nextVec[1] + prevVec[1]];\r\n                var vecLength = Math.sqrt(combinedVec[0] * combinedVec[0] + combinedVec[1] * combinedVec[1]);\r\n                var normedVec = [combinedVec[0] / vecLength, combinedVec[1] / vecLength];\r\n                var offsetVec = [-15 * normedVec[0], -15 * normedVec[1]];\r\n\r\n                newX = self.nodes[i-1].x + offsetVec[0];\r\n                newY = self.nodes[i-1].y + offsetVec[1];\r\n\r\n                var newNode = {'name': i + startNumber -1,\r\n                                 'num': -1,\r\n                                 'radius': 6,\r\n                                 'rna': self,\r\n                                 'nodeType': 'label',\r\n                                 'structName': self.structName,\r\n                                 'elemType': 'l',\r\n                                 'x': newX,\r\n                                 'y': newY,\r\n                                 'px': newX,\r\n                                 'py': newY,\r\n                                 'uid': slugid.nice() };\r\n                var newLink = {'source': self.nodes[i-1],\r\n                            'target': newNode,\r\n                            'value': 1,\r\n                            'linkType': 'label_link',\r\n                            'uid': slugid.nice() };\r\n\r\n                self.nodes.push(newNode);\r\n                self.links.push(newLink);\r\n            }\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.recalculateElements = function() {\r\n        self.removePseudoknots();\r\n        self.elements = self.ptToElements(self.pairtable, 0, 1, self.dotbracket.length);\r\n\r\n        if (self.circular) {\r\n            //check to see if the external loop is a hairpin or a multiloop\r\n            let externalLoop = self.elements.filter(function(d) { if (d[0] == 'e') return true; });\r\n\r\n            if (externalLoop.length > 0) {\r\n                eloop = externalLoop[0];\r\n                nucs = eloop[2].sort(numberSort);\r\n\r\n                prev = nucs[0];\r\n                hloop = true;\r\n                numGreater = 0;\r\n                for (let i = 1; i < nucs.length; i++) {\r\n                    if (nucs[i] - prev > 1) {\r\n                        numGreater += 1;\r\n                    }\r\n                    prev = nucs[i];\r\n                }\r\n\r\n                if (numGreater == 1) {\r\n                    eloop[0] = 'h';\r\n                } else if (numGreater == 2) {\r\n                    eloop[0] = 'i';\r\n                } else {\r\n                    eloop[0] = 'm';\r\n                }\r\n            }\r\n        }\r\n\r\n        return self;\r\n    };\r\n\r\n    self.reassignLinkUids = function() {\r\n        // reassign uids to the links, corresponding to the uids of the two nodes\r\n        // they connect\r\n        var i;\r\n\r\n        for (var i = 0; i < self.links.length; i++) {\r\n            self.links[i].uid = self.links[i].source.uid + self.links[i].target.uid;\r\n        }\r\n\r\n        return self;\r\n    }\r\n\r\n    self.removePseudoknots = function() {\r\n        if (self.pairtable.length > 1)\r\n            self.pseudoknotPairs = self.pseudoknotPairs.concat(rnaUtilities.removePseudoknotsFromPairtable(self.pairtable));\r\n\r\n        return self;\r\n    };\r\n\r\n    self.addPseudoknots = function() {\r\n        /* Add all of the pseudoknot pairs which are stored outside\r\n         * of the pairtable back to the pairtable\r\n         */\r\n        var pt = self.pairtable;\r\n        var pseudoknotPairs = self.pseudoknotPairs;\r\n\r\n        for (var i = 0; i < pseudoknotPairs.length; i++) {\r\n            pt[pseudoknotPairs[i][0]] = pseudoknotPairs[i][1];\r\n            pt[pseudoknotPairs[i][1]] = pseudoknotPairs[i][0];\r\n        }\r\n\r\n        self.pseudoknotPairs = [];\r\n        return self;\r\n    };\r\n\r\n    self.addName = function(name) {\r\n        if (typeof name == 'undefined') {\r\n            self.name = '';\r\n            return self;\r\n        } else {\r\n            self.name = name;\r\n            return self;\r\n        }\r\n    };\r\n\r\n\r\n    if (self.rnaLength > 0)\r\n        self.recalculateElements();\r\n\r\n    self.getNodeFromNucleotides = function(nucs) {\r\n        /* Get a node given a nucleotide number or an array of nucleotide\r\n         * numbers indicating an element node */\r\n        if (Object.prototype.toString.call(nucs) === '[object Array]') {\r\n            for (let j = 0; j < self.nodes.length; j++) {\r\n                if ('nucs' in self.nodes[j]) {\r\n                    if (self.nodes[j].nucs.equals(nucs)) {\r\n                        return self.nodes[j];\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            for (let j = 0; j < self.nodes.length; j++) {\r\n                if (self.nodes[j].num == nucs) {\r\n                    return self.nodes[j];\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log('ERROR: No node found for nucs:', nucs);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function moleculesToJson(moleculesJson) {\r\n    /* Convert a list of RNA and protein molecules to a list of RNAGraph\r\n     * ProteinGraph and extraLinks structure */\r\n\r\n    var nodes = {}; //index the nodes by uid\r\n    var graphs = [];\r\n    var extraLinks = [];\r\n\r\n\r\n    // Create the graphs for each molecule\r\n    for (var i = 0; i < moleculesJson.molecules.length; i++) {\r\n        var molecule = moleculesJson.molecules[i];\r\n        var rg;\r\n\r\n        if (molecule.type == 'rna') {\r\n            rg = new RNAGraph(molecule.seq, molecule.ss, molecule.header);\r\n            rg.circularizeExternal = true;\r\n            rg.elementsToJson()\r\n            .addPositions('nucleotide', molecule.positions)\r\n            .addLabels()\r\n            .reinforceStems()\r\n            .reinforceLoops();\r\n\r\n\r\n        } else if (molecule.type == 'protein') {\r\n            rg = new ProteinGraph(molecule.header, molecule.size);\r\n\r\n        }\r\n\r\n        rg.addUids(molecule.uids);\r\n\r\n        for (var j = 0; j < rg.nodes.length; j++) {\r\n            nodes[rg.nodes[j].uid] = rg.nodes[j];\r\n        }\r\n\r\n        graphs.push(rg);\r\n    }\r\n\r\n    //Add the extra links\r\n    for (var i = 0; i < moleculesJson.extraLinks.length; i++) {\r\n        link = moleculesJson.extraLinks[i];\r\n\r\n        link.source = nodes[link.source];\r\n        link.target = nodes[link.target];\r\n        link.uid = slugid.nice();\r\n\r\n        extraLinks.push(link);\r\n    }\r\n\r\n    return {'graphs': graphs, 'extraLinks': extraLinks};\r\n};\r\n","export function simpleXyCoordinates (pair_table) {\r\n  var INIT_ANGLE=0.;     /* initial bending angle */\r\n  var INIT_X = 100.;     /* coordinate of first digit */\r\n  var INIT_Y = 100.;     /* see above */\r\n  var RADIUS =  15.;\r\n\r\n  var x = [], y = [];\r\n\r\n  var i, len;\r\n  var  alpha;\r\n\r\n  len = pair_table[0];\r\n  var angle = Array.apply(null, new Array(len+5)).map(Number.prototype.valueOf,0); \r\n  var loop_size = Array.apply(null, new Array(16+Math.floor(len/5)))\r\n                    .map(Number.prototype.valueOf, 0); \r\n  var stack_size = Array.apply(null, new Array(16+Math.floor(len/5)))\r\n                    .map(Number.prototype.valueOf, 0); \r\n\r\n  var lp = 0;\r\n  var stk = 0;\r\n  var PIHALF = Math.PI / 2;\r\n\r\n\r\n  var loop = function(i, j, pair_table)\r\n  /* i, j are the positions AFTER the last pair of a stack; i.e\r\n     i-1 and j+1 are paired. */\r\n  {\r\n      var count = 2;   /* counts the VERTICES of a loop polygon; that's\r\n                          NOT necessarily the number of unpaired bases!\r\n                          Upon entry the loop has already 2 vertices, namely\r\n                          the pair i-1/j+1.  */\r\n\r\n  var    r = 0, bubble = 0; /* bubble counts the unpaired digits in loops */\r\n\r\n  var    i_old, partner, k, l, start_k, start_l, fill, ladder;\r\n  var    begin, v, diff;\r\n  var  polygon;\r\n\r\n  var remember = Array.apply(null, new Array((3+Math.floor((j-i)/5)*2))).map(Number.prototype.valueOf, 0);\r\n\r\n  i_old = i-1, j++;         /* j has now been set to the partner of the\r\n                               previous pair for correct while-loop\r\n                               termination.  */\r\n  while (i != j) {\r\n      partner = pair_table[i];\r\n      if ((!partner) || (i==0))\r\n          i++, count++, bubble++;\r\n      else {\r\n          count += 2;\r\n          k = i, l = partner;    /* beginning of stack */\r\n          remember[++r] = k;\r\n          remember[++r] = l;\r\n          i = partner+1;         /* next i for the current loop */\r\n\r\n          start_k = k, start_l = l;\r\n          ladder = 0;\r\n          do {\r\n              k++, l--, ladder++;        /* go along the stack region */\r\n          }\r\n          while ((pair_table[k] == l) && (pair_table[k] > k));\r\n\r\n          fill = ladder-2;\r\n          if (ladder >= 2) {\r\n              angle[start_k+1+fill] += PIHALF;   /*  Loop entries and    */\r\n              angle[start_l-1-fill] += PIHALF;   /*  exits get an        */\r\n              angle[start_k]        += PIHALF;   /*  additional PI/2.    */\r\n              angle[start_l]        += PIHALF;   /*  Why ? (exercise)    */\r\n              if (ladder > 2) {\r\n                  for (; fill >= 1; fill--) {\r\n                      angle[start_k+fill] = Math.PI;    /*  fill in the angles  */\r\n                      angle[start_l-fill] = Math.PI;    /*  for the backbone    */\r\n                  }\r\n              }\r\n          }\r\n          stack_size[++stk] = ladder;\r\n          if (k <= l)\r\n            loop(k, l, pair_table);\r\n      }\r\n  }\r\n\r\n  polygon = Math.PI*(count-2)/count; /* bending angle in loop polygon */\r\n  remember[++r] = j;\r\n  begin = i_old < 0 ? 0 : i_old;\r\n  for (v = 1; v <= r; v++) {\r\n      diff  = remember[v]-begin;\r\n      for (fill = 0; fill <= diff; fill++)\r\n      angle[begin+fill] += polygon;\r\n      if (v > r)\r\n          break;\r\n      begin = remember[++v];\r\n  }\r\n  loop_size[++lp] = bubble;\r\n  }\r\n\r\n  loop(0, len+1, pair_table);\r\n  loop_size[lp] -= 2;     /* correct for cheating with function loop */\r\n\r\n  alpha = INIT_ANGLE;\r\n  x[0]  = INIT_X;\r\n  y[0]  = INIT_Y;\r\n\r\n  var poss = [];\r\n\r\n  poss.push([x[0], y[0]]);\r\n  for (i = 1; i < len; i++) {\r\n      x[i] = x[i-1]+RADIUS*Math.cos(alpha);\r\n      y[i] = y[i-1]+RADIUS*Math.sin(alpha);\r\n\r\n      poss.push([x[i], y[i]]);\r\n      alpha += Math.PI-angle[i+1];\r\n  }\r\n\r\n  return poss;\r\n}\r\n","export function Radloop() {\r\n\tthis.radius = null;\r\n\tthis.loopnumber = null;\r\n\tthis.next = null;\r\n    this.prev = null;\r\n}\r\n\r\nRadloop.prototype.getRadius = function(){\r\n\treturn this.radius;\r\n}\r\n\r\nRadloop.prototype.setRadius = function(radius){\r\n\tthis.radius = radius;\r\n}\r\n\r\nRadloop.prototype.getLoopnumber = function(){\r\n\treturn this.loopnumber;\r\n}\r\n\r\nRadloop.prototype.setLoopnumber = function(loopnumber){\r\n\tthis.loopnumber = loopnumber;\r\n}\r\n\r\nRadloop.prototype.getNext = function(){\r\n\treturn this.next;\r\n}\r\n\r\nRadloop.prototype.setNext = function(next){\r\n\tthis.next = next;\r\n}\r\n\r\nRadloop.prototype.getPrev = function(){\r\n\treturn this.prev;\r\n}\r\n\r\nRadloop.prototype.setPrev = function(prev){\r\n\tthis.prev = prev;\r\n}\r\n","import {Connection} from './connection.js';\r\n\r\nexport function Loop() {\r\n\tthis.nconnection = null;\r\n\tthis.connections = [];\r\n\tthis._connections = [];\r\n\tthis.number = null;\r\n\tthis.depth = null;\r\n\tthis.mark = null;\r\n\tthis.x = null;\r\n    this.y = null;\r\n    this.radius = null;\r\n}\r\n\r\nLoop.prototype.getNconnection = function() {\r\n\treturn this.nconnection;\r\n}\r\n\r\nLoop.prototype.setNconnection = function(nconnection) {\r\n\tthis.nconnection = nconnection;\r\n}\r\n\r\nLoop.prototype.setConnection = function(i, c){\r\n\tif (c != null){\r\n\t\tthis._connections[i] = c;\r\n    }\r\n\telse {\r\n\t\tif (!this._connections[i]){\r\n\t\t\tthis._connections[i] = new Connection();\r\n\t\t}\r\n\t\tthis._connections[i].setNull(true);\r\n\t}\r\n}\r\n\r\nLoop.prototype.getConnection = function(i){\r\n\tif (!this._connections[i]){\r\n        this._connections[i] = new Connection();\r\n    }\r\n\tvar c = this._connections[i];\r\n\tif (c.isNull()){\r\n\t\treturn null;\r\n    }\r\n\telse {\r\n\t\treturn c;\r\n    }\r\n}\r\n\r\nLoop.prototype.addConnection = function(i, c){\r\n\tthis._connections.push(c);\r\n}\r\n\r\nLoop.prototype.getNumber = function(){\r\n\treturn this.number;\r\n}\r\n\r\nLoop.prototype.setNumber = function(number){\r\n\tthis.number = number;\r\n}\r\n\r\nLoop.prototype.getDepth = function(){\r\n\treturn this.depth;\r\n}\r\n\r\nLoop.prototype.setDepth = function(depth){\r\n\tthis.depth = depth;\r\n}\r\n\r\nLoop.prototype.isMark = function(){\r\n\treturn this.mark;\r\n}\r\n\r\nLoop.prototype.setMark = function(mark){\r\n\tthis.mark = mark;\r\n}\r\n\r\nLoop.prototype.getX = function(){\r\n\treturn this.x;\r\n}\r\n\r\nLoop.prototype.setX = function(x){\r\n\tthis.x = x;\r\n}\r\n\r\nLoop.prototype.getY = function(){\r\n\treturn this.y;\r\n}\r\n\r\nLoop.prototype.setY = function(y){\r\n\tthis.y = y;\r\n}\r\n\r\nLoop.prototype.getRadius = function(){\r\n\treturn this.radius;\r\n}\r\n\r\nLoop.prototype.setRadius = function(radius){\r\n\tthis.radius = radius;\r\n}\r\n","export function Region() {\r\n\tthis._start1 = null;\r\n    this._end1 = null;\r\n    this._start2 = null;\r\n    this._end2 = null;\r\n}\r\n\r\nRegion.prototype.getStart1 = function(){\r\n\treturn this._start1;\r\n}\r\n\r\nRegion.prototype.setStart1 = function(start1){\r\n\tthis._start1 = start1;\r\n}\r\n\r\nRegion.prototype.getEnd1 = function(){\r\n\treturn this._end1;\r\n}\r\n\r\nRegion.prototype.setEnd1 = function(end1){\r\n\tthis._end1 = end1;\r\n}\r\n\r\nRegion.prototype.getStart2 = function(){\r\n\treturn this._start2;\r\n}\r\n\r\nRegion.prototype.setStart2 = function(start2){\r\n\tthis._start2 = start2;\r\n}\r\n\r\nRegion.prototype.getEnd2 = function(){\r\n\treturn this._end2;\r\n}\r\n\r\nRegion.prototype.setEnd2 = function(end2){\r\n\tthis._end2 = end2;\r\n}\r\n","import {Loop} from './loop.js';\r\nimport {Region} from './region.js';\r\n\r\nexport function Connection() {\r\n\tthis.loop = new Loop();\r\n\tthis.region = new Region();\r\n\t// Start and end form the 1st base pair of the region.\r\n\tthis.start = null;\r\n    this.end = null;\r\n\tthis.xrad = null;\r\n    this.yrad = null;\r\n    this.angle = null;\r\n\t// True if segment between this connection and the\r\n\t// next must be extruded out of the circle\r\n\tthis.extruded = null;\r\n\t// True if the extruded segment must be drawn long.\r\n\tthis.broken = null;\r\n\r\n\tthis._isNull = false;\r\n}\r\n\r\nConnection.prototype.isNull = function(){\r\n\treturn this._isNull;\r\n}\r\n\r\nConnection.prototype.setNull = function(isNull){\r\n\tthis._isNull = isNull;\r\n}\r\n\r\nConnection.prototype.getLoop = function(){\r\n\treturn this.loop;\r\n}\r\n\r\nConnection.prototype.setLoop = function(loop) {\r\n\tthis.loop = loop;\r\n}\r\n\r\nConnection.prototype.getRegion = function(){\r\n\treturn this.region;\r\n}\r\n\r\nConnection.prototype.setRegion = function(region){\r\n\tthis.region = region;\r\n}\r\n\r\nConnection.prototype.getStart = function(){\r\n\treturn this.start;\r\n}\r\n\r\nConnection.prototype.setStart = function(start) {\r\n\tthis.start = start;\r\n}\r\n\r\nConnection.prototype.getEnd = function(){\r\n\treturn this.end;\r\n}\r\n\r\nConnection.prototype.setEnd = function(end){\r\n\tthis.end = end;\r\n}\r\n\r\nConnection.prototype.getXrad = function(){\r\n\treturn this.xrad;\r\n}\r\n\r\nConnection.prototype.setXrad = function(xrad){\r\n\tthis.xrad = xrad;\r\n}\r\n\r\nConnection.prototype.getYrad = function(){\r\n\treturn this.yrad;\r\n}\r\n\r\nConnection.prototype.setYrad = function(yrad) {\r\n\tthis.yrad = yrad;\r\n}\r\n\r\nConnection.prototype.getAngle = function(){\r\n\treturn this.angle;\r\n}\r\n\r\nConnection.prototype.setAngle = function(angle){\r\n\tthis.angle = angle;\r\n}\r\n\r\nConnection.prototype.isExtruded = function(){\r\n\treturn this.extruded;\r\n}\r\n\r\nConnection.prototype.setExtruded = function(extruded){\r\n\tthis.extruded = extruded;\r\n}\r\n\r\nConnection.prototype.isBroken = function(){\r\n\treturn this.broken;\r\n}\r\n\r\nConnection.prototype.setBroken = function(broken){\r\n\tthis.broken = broken;\r\n}\r\n","import {Region} from './region.js';\r\n\r\nexport function Base() {\r\n\tthis.mate = null;\r\n\tthis.x = null;\r\n    this.y = null;\r\n\tthis.extracted = null;\r\n\tthis.region = new Region();\r\n}\r\n\r\nBase.prototype.getMate = function(){\r\n\treturn this.mate;\r\n}\r\n\r\nBase.prototype.setMate = function(mate){\r\n\tthis.mate = mate;\r\n}\r\n\r\nBase.prototype.getX = function(){\r\n\treturn this.x;\r\n}\r\n\r\nBase.prototype.setX = function(x){\r\n\tthis.x = x;\r\n}\r\n\r\nBase.prototype.getY = function(){\r\n\treturn this.y;\r\n}\r\n\r\nBase.prototype.setY = function(y){\r\n\tthis.y = y;\r\n}\r\n\r\nBase.prototype.isExtracted = function(){\r\n\treturn this.extracted;\r\n}\r\n\r\nBase.prototype.setExtracted = function(extracted){\r\n\tthis.extracted = extracted;\r\n}\r\n\r\nBase.prototype.getRegion = function(){\r\n\treturn this.region;\r\n}\r\n\r\nBase.prototype.setRegion = function(region){\r\n\tthis.region = region;\r\n}\r\n","import {Radloop} from './radloop.js';\r\nimport {Connection} from './connection.js';\r\nimport {Region} from './region.js';\r\nimport {Base} from './base.js';\r\nimport {Loop} from './loop.js';\r\n\r\nexport function NAView(){\r\n    this.ANUM = 9999.0;\r\n\tthis.MAXITER = 500;\r\n\r\n\tthis.bases = [];\r\n\tthis.nbase = null;\r\n    this.nregion = null;\r\n    this.loop_count = null;\r\n\r\n\tthis.root = new Loop();\r\n\tthis.loops = [];\r\n\r\n\tthis.regions = [];\r\n\r\n\tthis.rlphead = new Radloop();\r\n\r\n\tthis.lencut = 0.8;\r\n\tthis.RADIUS_REDUCTION_FACTOR = 1.4;\r\n\r\n\t// show algorithm step by step\r\n\tthis.angleinc = null;\r\n\r\n\tthis._h = null;\r\n\r\n\t// private boolean noIterationFailureYet = true;\r\n\r\n\tthis.HELIX_FACTOR = 0.6;\r\n\tthis.BACKBONE_DISTANCE = 27;\r\n}\r\n\r\nNAView.prototype.naview_xy_coordinates = function(pair_table){\r\n    var x = [];\r\n\tvar y = [];\r\n    if (pair_table.length === 0 || pair_table[0] === 0){\r\n        return 0;\r\n    }\r\n    var i;\r\n    this.nbase = pair_table[0];\r\n    this.bases = [];\r\n    for (var index = 0; index < this.nbase + 1; index++){\r\n        this.bases.push(new Base());\r\n    }\r\n    this.regions = [];\r\n    for (var index = 0; index < this.nbase + 1; index++){\r\n        this.regions.push(new Region());\r\n    }\r\n    this.read_in_bases(pair_table);\r\n    this.rlphead = null;\r\n    this.find_regions();\r\n    this.loop_count = 0;\r\n    this.loops = [];\r\n    for (var index = 0; index < this.nbase + 1; index++){\r\n        this.loops.push(new Loop());\r\n    }\r\n    this.construct_loop(0);\r\n    this.find_central_loop();\r\n    this.traverse_loop(this.root, null);\r\n\r\n    for (i = 0; i < this.nbase; i++){\r\n        x.push(100 + this.BACKBONE_DISTANCE * this.bases[i + 1].getX());\r\n        y.push(100 + this.BACKBONE_DISTANCE * this.bases[i + 1].getY());\r\n    }\r\n\r\n    return {\r\n        nbase: this.nbase,\r\n        x: x,\r\n        y: y\r\n    }\r\n}\r\n\r\nNAView.prototype.read_in_bases = function read_in_bases(pair_table){\r\n    var i = null;\r\n    var npairs = null;\r\n\r\n    // Set up an origin.\r\n    this.bases.push(new Base());\r\n    this.bases[0].setMate(0);\r\n    this.bases[0].setExtracted(false);\r\n    this.bases[0].setX(this.ANUM);\r\n    this.bases[0].setY(this.ANUM);\r\n\r\n    for (npairs = 0, i = 1; i <= this.nbase; i++){\r\n        this.bases.push(new Base());\r\n        this.bases[i].setExtracted(false);\r\n        this.bases[i].setX(this.ANUM);\r\n        this.bases[i].setY(this.ANUM);\r\n        this.bases[i].setMate(pair_table[i]);\r\n        if (pair_table[i] > i)\r\n            npairs++;\r\n    }\r\n    // must have at least 1 pair to avoid segfault\r\n    if (npairs == 0){\r\n        this.bases[1].setMate(this.nbase);\r\n        this.bases[this.nbase].setMate(1);\r\n    }\r\n}\r\n\r\nNAView.prototype.find_regions = function find_regions(){\r\n    var i = null;\r\n    var mate = null;\r\n    var nb1 = null;\r\n\r\n    nb1 = this.nbase + 1;\r\n    var mark = [];\r\n    for (i = 0; i < nb1; i++){\r\n        mark.push(false);\r\n    }\r\n    this.nregion = 0;\r\n    for (i = 0; i <= this.nbase; i++) {\r\n        if ((mate = this.bases[i].getMate()) != 0 && !mark[i]) {\r\n            this.regions[this.nregion].setStart1(i);\r\n            this.regions[this.nregion].setEnd2(mate);\r\n            mark[i] = true;\r\n            mark[mate] = true;\r\n            this.bases[i].setRegion(this.regions[this.nregion]);\r\n            this.bases[mate].setRegion(this.regions[this.nregion]);\r\n            for (i++, mate--; i < mate && this.bases[i].getMate() == mate; i++, mate--) {\r\n                mark[mate] = true;\r\n                mark[i]= true;\r\n                this.bases[i].setRegion(this.regions[this.nregion]);\r\n                this.bases[mate].setRegion(this.regions[this.nregion]);\r\n            }\r\n            this.regions[this.nregion].setEnd1(--i);\r\n            this.regions[this.nregion].setStart2(mate + 1);\r\n\r\n            this.nregion++;\r\n        }\r\n    }\r\n}\r\n\r\nNAView.prototype.construct_loop = function construct_loop(ibase){\r\n    var i = null;\r\n    var mate = null;\r\n    var retloop = new Loop();\r\n    var lp = new Loop();\r\n    var cp = new Connection();\r\n    var rp = new Region();\r\n    var rlp = new Radloop();\r\n    retloop = this.loops[this.loop_count++];\r\n    retloop.setNconnection(0);\r\n    retloop.setDepth(0);\r\n    retloop.setNumber(this.loop_count);\r\n    retloop.setRadius(0.0);\r\n\r\n    for (rlp = this.rlphead; rlp != null; rlp = rlp.getNext())\r\n        if (rlp.getLoopnumber() == this.loop_count)\r\n            retloop.setRadius(rlp.getRadius());\r\n    i = ibase;\r\n    do {\r\n        if ((mate = this.bases[i].getMate()) != 0) {\r\n            rp = this.bases[i].getRegion();\r\n            if (!this.bases[rp.getStart1()].isExtracted()) {\r\n                if (i == rp.getStart1()) {\r\n                    this.bases[rp.getStart1()].setExtracted(true);\r\n                    this.bases[rp.getEnd1()].setExtracted(true);\r\n                    this.bases[rp.getStart2()].setExtracted(true);\r\n                    this.bases[rp.getEnd2()].setExtracted(true);\r\n                    lp = this.construct_loop(rp.getEnd1() < this.nbase ? rp.getEnd1() + 1\r\n                            : 0);\r\n                } else if (i == rp.getStart2()) {\r\n                    this.bases[rp.getStart2()].setExtracted(true);\r\n                    this.bases[rp.getEnd2()].setExtracted(true);\r\n                    this.bases[rp.getStart1()].setExtracted(true);\r\n                    this.bases[rp.getEnd1()].setExtracted(true);\r\n                    lp = this.construct_loop(rp.getEnd2() < this.nbase ? rp.getEnd2() + 1\r\n                            : 0);\r\n                } else {\r\n                    console.log(\"Something went terribly wrong ....\");\r\n                }\r\n                retloop.setNconnection(retloop.getNconnection() + 1);\r\n                cp = new Connection();\r\n                retloop.setConnection(retloop.getNconnection() - 1,\tcp);\r\n                retloop.setConnection(retloop.getNconnection(), null);\r\n                cp.setLoop(lp);\r\n                cp.setRegion(rp);\r\n                if(i == rp.getStart1()) {\r\n                    cp.setStart(rp.getStart1());\r\n                    cp.setEnd(rp.getEnd2());\r\n                } else {\r\n                    cp.setStart(rp.getStart2());\r\n                    cp.setEnd(rp.getEnd1());\r\n                }\r\n                cp.setExtruded(false);\r\n                cp.setBroken(false);\r\n                lp.setNconnection(lp.getNconnection() + 1);\r\n                cp = new Connection();\r\n                lp.setConnection(lp.getNconnection() - 1, cp);\r\n                lp.setConnection(lp.getNconnection(), null);\r\n                cp.setLoop(retloop);\r\n                cp.setRegion(rp);\r\n                if (i == rp.getStart1()) {\r\n                    cp.setStart(rp.getStart2());\r\n                    cp.setEnd(rp.getEnd1());\r\n                } else {\r\n                    cp.setStart(rp.getStart1());\r\n                    cp.setEnd(rp.getEnd2());\r\n                }\r\n                cp.setExtruded(false);\r\n                cp.setBroken(false);\r\n            }\r\n            i = mate;\r\n        }\r\n        if (++i > this.nbase)\r\n            i = 0;\r\n    } while (i != ibase);\r\n    return retloop;\r\n}\r\n\r\nNAView.prototype.find_central_loop = function find_central_loop(){\r\n    var lp = new Loop();\r\n    var maxconn = null;\r\n    var maxdepth = null;\r\n    var i = null;\r\n\r\n    determine_depths.bind(this)();\r\n    maxconn = 0;\r\n    maxdepth = -1;\r\n    for (i = 0; i < this.loop_count; i++) {\r\n        lp = this.loops[i];\r\n        if (lp.getNconnection() > maxconn) {\r\n            maxdepth = lp.getDepth();\r\n            maxconn = lp.getNconnection();\r\n            this.root = lp;\r\n        } else if (lp.getDepth() > maxdepth\r\n                && lp.getNconnection() == maxconn) {\r\n            maxdepth = lp.getDepth();\r\n            this.root = lp;\r\n        }\r\n    }\r\n}\r\n\r\nfunction determine_depths() {\r\n    var lp = new Loop();\r\n    var i = null;\r\n    var j = null;\r\n\r\n    for (i = 0; i < this.loop_count; i++) {\r\n        lp = this.loops[i];\r\n        for (j = 0; j < this.loop_count; j++){\r\n            this.loops[j].setMark(false);\r\n        }\r\n        lp.setDepth(depth(lp));\r\n    }\r\n}\r\n\r\nfunction depth(lp){\r\n    var count = null;\r\n    var ret = null;\r\n    var d = null;\r\n\r\n    if (lp.getNconnection() <= 1){\r\n        return 0;\r\n    }\r\n    if (lp.isMark()){\r\n        return -1;\r\n    }\r\n    lp.setMark(true);\r\n    count = 0;\r\n    ret = 0;\r\n    for (var i = 0; lp.getConnection(i) != null; i++) {\r\n        d = depth(lp.getConnection(i).getLoop());\r\n        if (d >= 0) {\r\n            if (++count == 1){\r\n                ret = d;\r\n            }\r\n            else if (ret > d){\r\n                ret = d;\r\n            }\r\n        }\r\n    }\r\n    lp.setMark(false);\r\n    return ret + 1;\r\n}\r\n\r\nNAView.prototype.traverse_loop = function traverse_loop(lp, anchor_connection){\r\n    var xs, ys, xe, ye, xn, yn, angleinc, r;\r\n    var radius, xc, yc, xo, yo, astart, aend, a;\r\n    var cp, cpnext, acp, cpprev;\r\n    var i, j, n, ic;\r\n    var da, maxang;\r\n    var count, icstart, icend, icmiddle, icroot;\r\n    var done, done_all_connections, rooted;\r\n    var sign;\r\n    var midx, midy, nrx, nry, mx, my, vx, vy, dotmv, nmidx, nmidy;\r\n    var icstart1, icup, icdown, icnext, direction;\r\n    var dan, dx, dy, rr;\r\n    var cpx, cpy, cpnextx, cpnexty, cnx, cny, rcn, rc, lnx, lny, rl, ac, acn, sx, sy, dcp;\r\n    var imaxloop = 0;\r\n\r\n    angleinc = 2 * Math.PI / (this.nbase + 1);\r\n    acp = null;\r\n    icroot = -1;\r\n    var indice = 0;\r\n\r\n    for (ic = 0; (cp = lp.getConnection(indice)) != null; indice++, ic++) {\r\n        xs = -Math.sin(angleinc * cp.getStart());\r\n        ys = Math.cos(angleinc * cp.getStart());\r\n        xe = -Math.sin(angleinc * cp.getEnd());\r\n        ye = Math.cos(angleinc * cp.getEnd());\r\n        xn = ye - ys;\r\n        yn = xs - xe;\r\n        r = Math.sqrt(xn * xn + yn * yn);\r\n        cp.setXrad(xn / r);\r\n        cp.setYrad(yn / r);\r\n        cp.setAngle(Math.atan2(yn, xn));\r\n        if (cp.getAngle() < 0.0){\r\n            cp.setAngle(cp.getAngle() + 2 * Math.PI);\r\n        }\r\n        if (anchor_connection != null\r\n                && anchor_connection.getRegion() == cp.getRegion()) {\r\n            acp = cp;\r\n            icroot = ic;\r\n        }\r\n    }\r\n    set_radius: while (true) {\r\n        this.determine_radius(lp, this.lencut);\r\n        radius = lp.getRadius()/this.RADIUS_REDUCTION_FACTOR;\r\n        if (anchor_connection == null){\r\n            xc = yc = 0.0;\r\n        }\r\n        else {\r\n            xo = (this.bases[acp.getStart()].getX() + this.bases\r\n                    [acp.getEnd()].getX()) / 2.0;\r\n            yo = (this.bases[acp.getStart()].getY() + this.bases\r\n                    [acp.getEnd()].getY()) / 2.0;\r\n            xc = xo - radius * acp.getXrad();\r\n            yc = yo - radius * acp.getYrad();\r\n        }\r\n\r\n        // The construction of the connectors will proceed in blocks of\r\n        // connected connectors, where a connected connector pairs means two\r\n        // connectors that are forced out of the drawn circle because they\r\n        // are too close together in angle.\r\n\r\n        // First, find the start of a block of connected connectors\r\n\r\n        if (icroot == -1){\r\n            icstart = 0;\r\n        }\r\n        else {\r\n            icstart = icroot;\r\n        }\r\n        cp = lp.getConnection(icstart);\r\n        count = 0;\r\n        done = false;\r\n        do {\r\n            j = icstart - 1;\r\n            if (j < 0){\r\n                j = lp.getNconnection() - 1;\r\n            }\r\n            cpprev = lp.getConnection(j);\r\n            if (!this.connected_connection(cpprev, cp)) {\r\n                done = true;\r\n            }\r\n            else {\r\n                icstart = j;\r\n                cp = cpprev;\r\n            }\r\n            if (++count > lp.getNconnection()) {\r\n                // Here everything is connected. Break on maximum angular\r\n                // separation between connections.\r\n                maxang = -1.0;\r\n                for (ic = 0; ic < lp.getNconnection(); ic++) {\r\n                    j = ic + 1;\r\n                    if (j >= lp.getNconnection()){\r\n                        j = 0;\r\n                    }\r\n                    cp = lp.getConnection(ic);\r\n                    cpnext = lp.getConnection(j);\r\n                    ac = cpnext.getAngle() - cp.getAngle();\r\n                    if (ac < 0.0){\r\n                        ac += 2 * Math.PI;\r\n                    }\r\n                    if (ac > maxang) {\r\n                        maxang = ac;\r\n                        imaxloop = ic;\r\n                    }\r\n                }\r\n                icend = imaxloop;\r\n                icstart = imaxloop + 1;\r\n                if (icstart >= lp.getNconnection()){\r\n                    icstart = 0;\r\n                }\r\n                cp = lp.getConnection(icend);\r\n                cp.setBroken(true);\r\n                done = true;\r\n            }\r\n        } while (!done);\r\n        done_all_connections = false;\r\n        icstart1 = icstart;\r\n        while (!done_all_connections) {\r\n            count = 0;\r\n            done = false;\r\n            icend = icstart;\r\n            rooted = false;\r\n            while (!done) {\r\n                cp = lp.getConnection(icend);\r\n                if (icend == icroot){\r\n                    rooted = true;\r\n                }\r\n                j = icend + 1;\r\n                if (j >= lp.getNconnection()) {\r\n                    j = 0;\r\n                }\r\n                cpnext = lp.getConnection(j);\r\n                if (this.connected_connection(cp, cpnext)) {\r\n                    if (++count >= lp.getNconnection()){\r\n                        break;\r\n                    }\r\n                    icend = j;\r\n                }\r\n                else {\r\n                    done = true;\r\n                }\r\n            }\r\n            icmiddle = this.find_ic_middle(icstart, icend, anchor_connection,\r\n                    acp, lp);\r\n            ic = icup = icdown = icmiddle;\r\n            done = false;\r\n            direction = 0;\r\n            while (!done) {\r\n                if (direction < 0) {\r\n                    ic = icup;\r\n                }\r\n                else if (direction == 0) {\r\n                    ic = icmiddle;\r\n                }\r\n                else {\r\n                    ic = icdown;\r\n                }\r\n                if (ic >= 0) {\r\n                    cp = lp.getConnection(ic);\r\n                    if (anchor_connection == null || acp != cp) {\r\n                        if (direction == 0) {\r\n                            astart = cp.getAngle()\r\n                                    - Math.asin(1.0 / 2.0 / radius);\r\n                            aend = cp.getAngle()\r\n                                    + Math.asin(1.0 / 2.0 / radius);\r\n                            this.bases[cp.getStart()].setX(\r\n                                    xc + radius * Math.cos(astart));\r\n                            this.bases[cp.getStart()].setY(\r\n                                    yc + radius * Math.sin(astart));\r\n                            this.bases[cp.getEnd()].setX(\r\n                                    xc + radius * Math.cos(aend));\r\n                            this.bases[cp.getEnd()].setY(\r\n                                    yc + radius * Math.sin(aend));\r\n                        }\r\n                        else if (direction < 0) {\r\n                            j = ic + 1;\r\n                            if (j >= lp.getNconnection()){\r\n                                j = 0;\r\n                            }\r\n                            cp = lp.getConnection(ic);\r\n                            cpnext = lp.getConnection(j);\r\n                            cpx = cp.getXrad();\r\n                            cpy = cp.getYrad();\r\n                            ac = (cp.getAngle() + cpnext.getAngle()) / 2.0;\r\n                            if (cp.getAngle() > cpnext.getAngle()){\r\n                                ac -= Math.PI;\r\n                            }\r\n                            cnx = Math.cos(ac);\r\n                            cny = Math.sin(ac);\r\n                            lnx = cny;\r\n                            lny = -cnx;\r\n                            da = cpnext.getAngle() - cp.getAngle();\r\n                            if (da < 0.0){\r\n                                da += 2 * Math.PI;\r\n                            }\r\n                            if (cp.isExtruded()) {\r\n                                if (da <= Math.PI / 2){\r\n                                    rl = 2.0;\r\n                                }\r\n                                else {\r\n                                    rl = 1.5;\r\n                                }\r\n                            }\r\n                            else {\r\n                                rl = 1.0;\r\n                            }\r\n                            this.bases[cp.getEnd()].setX(\r\n                                    this.bases[cpnext.getStart()].getX()\r\n                                            + rl * lnx);\r\n                            this.bases[cp.getEnd()].setY(\r\n                                    this.bases[cpnext.getStart()].getY()\r\n                                            + rl * lny);\r\n                            this.bases[cp.getStart()].setX(\r\n                                    this.bases[cp.getEnd()].getX() + cpy);\r\n                            this.bases[cp.getStart()].setY(\r\n                                    this.bases[cp.getEnd()].getY() - cpx);\r\n                        } else {\r\n                            j = ic - 1;\r\n                            if (j < 0){\r\n                                j = lp.getNconnection() - 1;\r\n                            }\r\n                            cp = lp.getConnection(j);\r\n                            cpnext = lp.getConnection(ic);\r\n                            cpnextx = cpnext.getXrad();\r\n                            cpnexty = cpnext.getYrad();\r\n                            ac = (cp.getAngle() + cpnext.getAngle()) / 2.0;\r\n                            if (cp.getAngle() > cpnext.getAngle()){\r\n                                ac -= Math.PI;\r\n                            }\r\n                            cnx = Math.cos(ac);\r\n                            cny = Math.sin(ac);\r\n                            lnx = -cny;\r\n                            lny = cnx;\r\n                            da = cpnext.getAngle() - cp.getAngle();\r\n                            if (da < 0.0){\r\n                                da += 2 * Math.PI;\r\n                            }\r\n                            if (cp.isExtruded()) {\r\n                                if (da <= Math.PI / 2){\r\n                                    rl = 2.0;\r\n                                }\r\n                                else {\r\n                                    rl = 1.5;\r\n                                }\r\n                            }\r\n                            else {\r\n                                rl = 1.0;\r\n                            }\r\n                            this.bases[cpnext.getStart()].setX(\r\n                                    this.bases[cp.getEnd()].getX() + rl\r\n                                            * lnx);\r\n                            this.bases[cpnext.getStart()].setY(\r\n                                    this.bases[cp.getEnd()].getY() + rl\r\n                                            * lny);\r\n                            this.bases[cpnext.getEnd()].setX(\r\n                                    this.bases[cpnext.getStart()].getX()\r\n                                            - cpnexty);\r\n                            this.bases[cpnext.getEnd()].setY(\r\n                                    this.bases[cpnext.getStart()].getY()\r\n                                            + cpnextx);\r\n                        }\r\n                    }\r\n                }\r\n                if (direction < 0) {\r\n                    if (icdown == icend) {\r\n                        icdown = -1;\r\n                    }\r\n                    else if (icdown >= 0) {\r\n                        if (++icdown >= lp.getNconnection()) {\r\n                            icdown = 0;\r\n                        }\r\n                    }\r\n                    direction = 1;\r\n                }\r\n                else {\r\n                    if (icup == icstart){\r\n                        icup = -1;\r\n                    }\r\n                    else if (icup >= 0) {\r\n                        if (--icup < 0) {\r\n                            icup = lp.getNconnection() - 1;\r\n                        }\r\n                    }\r\n                    direction = -1;\r\n                }\r\n                done = icup == -1 && icdown == -1;\r\n            }\r\n            icnext = icend + 1;\r\n            if (icnext >= lp.getNconnection()){\r\n                icnext = 0;\r\n            }\r\n            if (icend != icstart\r\n                    && (!(icstart == icstart1 && icnext == icstart1))) {\r\n\r\n                // Move the bases just constructed (or the radius) so that\r\n                // the bisector of the end points is radius distance away\r\n                // from the loop center.\r\n\r\n                cp = lp.getConnection(icstart);\r\n                cpnext = lp.getConnection(icend);\r\n                dx = this.bases[cpnext.getEnd()].getX()\r\n                        - this.bases[cp.getStart()].getX();\r\n                dy = this.bases[cpnext.getEnd()].getY()\r\n                        - this.bases[cp.getStart()].getY();\r\n                midx = this.bases[cp.getStart()].getX() + dx / 2.0;\r\n                midy = this.bases[cp.getStart()].getY() + dy / 2.0;\r\n                rr = Math.sqrt(dx * dx + dy * dy);\r\n                mx = dx / rr;\r\n                my = dy / rr;\r\n                vx = xc - midx;\r\n                vy = yc - midy;\r\n                rr = Math.sqrt(dx * dx + dy * dy);\r\n                vx /= rr;\r\n                vy /= rr;\r\n                dotmv = vx * mx + vy * my;\r\n                nrx = dotmv * mx - vx;\r\n                nry = dotmv * my - vy;\r\n                rr = Math.sqrt(nrx * nrx + nry * nry);\r\n                nrx /= rr;\r\n                nry /= rr;\r\n\r\n                // Determine which side of the bisector the center should\r\n                // be.\r\n\r\n                dx = this.bases[cp.getStart()].getX() - xc;\r\n                dy = this.bases[cp.getStart()].getY() - yc;\r\n                ac = Math.atan2(dy, dx);\r\n                if (ac < 0.0){\r\n                    ac += 2 * Math.PI;\r\n                }\r\n                dx = this.bases[cpnext.getEnd()].getX() - xc;\r\n                dy = this.bases[cpnext.getEnd()].getY() - yc;\r\n                acn = Math.atan2(dy, dx);\r\n                if (acn < 0.0){\r\n                    acn += 2 * Math.PI;\r\n                }\r\n                if (acn < ac){\r\n                    acn += 2 * Math.PI;\r\n                }\r\n                if (acn - ac > Math.PI){\r\n                    sign = -1;\r\n                }\r\n                else {\r\n                    sign = 1;\r\n                }\r\n                nmidx = xc + sign * radius * nrx;\r\n                nmidy = yc + sign * radius * nry;\r\n                if (rooted) {\r\n                    xc -= nmidx - midx;\r\n                    yc -= nmidy - midy;\r\n                }\r\n                else {\r\n                    for (ic = icstart;;) {\r\n                        cp = lp.getConnection(ic);\r\n                        i = cp.getStart();\r\n                        this.bases[i].setX(\r\n                                this.bases[i].getX() + nmidx - midx);\r\n                        this.bases[i].setY(\r\n                                this.bases[i].getY() + nmidy - midy);\r\n                        i = cp.getEnd();\r\n                        this.bases[i].setX(\r\n                                this.bases[i].getX() + nmidx - midx);\r\n                        this.bases[i].setY(\r\n                                this.bases[i].getY() + nmidy - midy);\r\n                        if (ic == icend){\r\n                            break;\r\n                        }\r\n                        if (++ic >= lp.getNconnection()){\r\n                            ic = 0;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            icstart = icnext;\r\n            done_all_connections = icstart == icstart1;\r\n        }\r\n        for (ic = 0; ic < lp.getNconnection(); ic++) {\r\n            cp = lp.getConnection(ic);\r\n            j = ic + 1;\r\n            if (j >= lp.getNconnection()){\r\n                j = 0;\r\n            }\r\n            cpnext = lp.getConnection(j);\r\n            dx = this.bases[cp.getEnd()].getX() - xc;\r\n            dy = this.bases[cp.getEnd()].getY() - yc;\r\n            rc = Math.sqrt(dx * dx + dy * dy);\r\n            ac = Math.atan2(dy, dx);\r\n            if (ac < 0.0){\r\n                ac += 2 * Math.PI;\r\n            }\r\n            dx = this.bases[cpnext.getStart()].getX() - xc;\r\n            dy = this.bases[cpnext.getStart()].getY() - yc;\r\n            rcn = Math.sqrt(dx * dx + dy * dy);\r\n            acn = Math.atan2(dy, dx);\r\n            if (acn < 0.0){\r\n                acn += 2 * Math.PI;\r\n            }\r\n            if (acn < ac){\r\n                acn += 2 * Math.PI;\r\n            }\r\n            dan = acn - ac;\r\n            dcp = cpnext.getAngle() - cp.getAngle();\r\n            if (dcp <= 0.0){\r\n                dcp += 2 * Math.PI;\r\n            }\r\n            if (Math.abs(dan - dcp) > Math.PI) {\r\n                if (cp.isExtruded()) {\r\n                    console.log(\"Warning from traverse_loop. Loop \"\r\n                            + lp.getNumber() + \" has crossed regions\\n\");\r\n                }\r\n                else if ((cpnext.getStart() - cp.getEnd()) != 1) {\r\n                    cp.setExtruded(true);\r\n                    continue set_radius; // remplacement du goto\r\n                }\r\n            }\r\n            if (cp.isExtruded()) {\r\n                this.construct_extruded_segment(cp, cpnext);\r\n            }\r\n            else {\r\n                n = cpnext.getStart() - cp.getEnd();\r\n                if (n < 0){\r\n                    n += this.nbase + 1;\r\n                }\r\n                angleinc = dan / n;\r\n                for (j = 1; j < n; j++) {\r\n                    i = cp.getEnd() + j;\r\n                    if (i > this.nbase){\r\n                        i -= this.nbase + 1;\r\n                    }\r\n                    a = ac + j * angleinc;\r\n                    rr = rc + (rcn - rc) * (a - ac) / dan;\r\n                    this.bases[i].setX(xc + rr * Math.cos(a));\r\n                    this.bases[i].setY(yc + rr * Math.sin(a));\r\n                }\r\n            }\r\n        }\r\n        break;\r\n    }\r\n    for (ic = 0; ic < lp.getNconnection(); ic++) {\r\n        if (icroot != ic) {\r\n            cp = lp.getConnection(ic);\r\n            //IM HERE\r\n            this.generate_region(cp);\r\n            this.traverse_loop(cp.getLoop(), cp);\r\n        }\r\n    }\r\n    n = 0;\r\n    sx = 0.0;\r\n    sy = 0.0;\r\n    for (ic = 0; ic < lp.getNconnection(); ic++) {\r\n        j = ic + 1;\r\n        if (j >= lp.getNconnection()){\r\n            j = 0;\r\n        }\r\n        cp = lp.getConnection(ic);\r\n        cpnext = lp.getConnection(j);\r\n        n += 2;\r\n        sx += this.bases[cp.getStart()].getX()\r\n                + this.bases[cp.getEnd()].getX();\r\n        sy += this.bases[cp.getStart()].getY()\r\n                + this.bases[cp.getEnd()].getY();\r\n        if (!cp.isExtruded()) {\r\n            for (j = cp.getEnd() + 1; j != cpnext.getStart(); j++) {\r\n                if (j > this.nbase){\r\n                    j -= this.nbase + 1;\r\n                }\r\n                n++;\r\n                sx += this.bases[j].getX();\r\n                sy += this.bases[j].getY();\r\n            }\r\n        }\r\n    }\r\n    lp.setX(sx / n);\r\n    lp.setY(sy / n);\r\n}\r\n\r\nNAView.prototype.determine_radius = function determine_radius(lp, lencut){\r\n    var mindit, ci, dt, sumn, sumd, radius, dit;\r\n    var i, j, end, start, imindit = 0;\r\n    var cp = new Connection(), cpnext = new Connection();\r\n    var rt2_2 = 0.7071068;\r\n\r\n    do {\r\n        mindit = 1.0e10;\r\n        for (sumd = 0.0, sumn = 0.0, i = 0; i < lp.getNconnection(); i++) {\r\n            cp = lp.getConnection(i);\r\n            j = i + 1;\r\n            if (j >= lp.getNconnection()){\r\n                j = 0;\r\n            }\r\n            cpnext = lp.getConnection(j);\r\n            end = cp.getEnd();\r\n            start = cpnext.getStart();\r\n            if (start < end){\r\n                start += this.nbase + 1;\r\n            }\r\n            dt = cpnext.getAngle() - cp.getAngle();\r\n            if (dt <= 0.0){\r\n                dt += 2 * Math.PI;\r\n            }\r\n            if (!cp.isExtruded()){\r\n                ci = start - end;\r\n            }\r\n            else {\r\n                if (dt <= Math.PI / 2){\r\n                    ci = 2.0;\r\n                }\r\n                else {\r\n                    ci = 1.5;\r\n                }\r\n            }\r\n            sumn += dt * (1.0 / ci + 1.0);\r\n            sumd += dt * dt / ci;\r\n            dit = dt / ci;\r\n            if (dit < mindit && !cp.isExtruded() && ci > 1.0) {\r\n                mindit = dit;\r\n                imindit = i;\r\n            }\r\n        }\r\n        radius = sumn / sumd;\r\n        if (radius < rt2_2){\r\n            radius = rt2_2;\r\n        }\r\n        if (mindit * radius < lencut) {\r\n            lp.getConnection(imindit).setExtruded(true);\r\n        }\r\n    } while (mindit * radius < lencut);\r\n    if (lp.getRadius() > 0.0){\r\n        radius = lp.getRadius();\r\n    }\r\n    else {\r\n        lp.setRadius(radius);\r\n    }\r\n}\r\n\r\nNAView.prototype.find_ic_middle = function find_ic_middle(icstart, icend, anchor_connection, acp, lp){\r\n    var count, ret, ic, i;\r\n    var done;\r\n\r\n    count = 0;\r\n    ret = -1;\r\n    ic = icstart;\r\n    done = false;\r\n    while (!done) {\r\n        if (count++ > lp.getNconnection() * 2) {\r\n            console.log(\"Infinite loop in 'find_ic_middle'\");\r\n        }\r\n        if (anchor_connection != null && lp.getConnection(ic) == acp) {\r\n            ret = ic;\r\n        }\r\n        done = ic == icend;\r\n        if (++ic >= lp.getNconnection()) {\r\n            ic = 0;\r\n        }\r\n    }\r\n    if (ret == -1) {\r\n        for (i = 1, ic = icstart; i < (count + 1) / 2; i++) {\r\n            if (++ic >= lp.getNconnection())\r\n                ic = 0;\r\n        }\r\n        ret = ic;\r\n    }\r\n    return ret;\r\n}\r\n\r\nNAView.prototype.construct_extruded_segment = function construct_extruded_segment(cp, cpnext){\r\n    var astart, aend1, aend2, aave, dx, dy, a1, a2, ac, rr, da, dac;\r\n    var start, end, n, nstart, nend;\r\n    var collision;\r\n\r\n    astart = cp.getAngle();\r\n    aend2 = aend1 = cpnext.getAngle();\r\n    if (aend2 < astart){\r\n        aend2 += 2 * Math.PI;\r\n    }\r\n    aave = (astart + aend2) / 2.0;\r\n    start = cp.getEnd();\r\n    end = cpnext.getStart();\r\n    n = end - start;\r\n    if (n < 0){\r\n        n += this.nbase + 1;\r\n    }\r\n    da = cpnext.getAngle() - cp.getAngle();\r\n    if (da < 0.0) {\r\n        da += 2 * Math.PI;\r\n    }\r\n    if (n == 2) {\r\n        this.construct_circle_segment(start, end);\r\n    }\r\n    else {\r\n        dx = this.bases[end].getX() - this.bases[start].getX();\r\n        dy = this.bases[end].getY() - this.bases[start].getY();\r\n        rr = Math.sqrt(dx * dx + dy * dy);\r\n        dx /= rr;\r\n        dy /= rr;\r\n        if (rr >= 1.5 && da <= Math.PI / 2) {\r\n            nstart = start + 1;\r\n            if (nstart > this.nbase){\r\n                nstart -= this.nbase + 1;\r\n            }\r\n            nend = end - 1;\r\n            if (nend < 0){\r\n                nend += this.nbase + 1;\r\n            }\r\n            this.bases[nstart].setX(this.bases[start].getX() + 0.5 * dx);\r\n            this.bases[nstart].setY(this.bases[start].getY() + 0.5 * dy);\r\n            this.bases[nend].setX(this.bases[end].getX() - 0.5 * dx);\r\n            this.bases[nend].setY(this.bases[end].getY() - 0.5 * dy);\r\n            start = nstart;\r\n            end = nend;\r\n        }\r\n        do {\r\n            collision = false;\r\n            this.construct_circle_segment(start, end);\r\n            nstart = start + 1;\r\n            if (nstart > this.nbase) {\r\n                nstart -= this.nbase + 1;\r\n            }\r\n            dx = this.bases[nstart].getX() - this.bases[start].getX();\r\n            dy = this.bases[nstart].getY() - this.bases[start].getY();\r\n            a1 = Math.atan2(dy, dx);\r\n            if (a1 < 0.0){\r\n                a1 += 2 * Math.PI;\r\n            }\r\n            dac = a1 - astart;\r\n            if (dac < 0.0){\r\n                dac += 2 * Math.PI;\r\n            }\r\n            if (dac > Math.PI){\r\n                collision = true;\r\n            }\r\n            nend = end - 1;\r\n            if (nend < 0){\r\n                nend += this.nbase + 1;\r\n            }\r\n            dx = this.bases[nend].getX() - this.bases[end].getX();\r\n            dy = this.bases[nend].getY() - this.bases[end].getY();\r\n            a2 = Math.atan2(dy, dx);\r\n            if (a2 < 0.0){\r\n                a2 += 2 * Math.PI;\r\n            }\r\n            dac = aend1 - a2;\r\n            if (dac < 0.0){\r\n                dac += 2 * Math.PI;\r\n            }\r\n            if (dac > Math.PI){\r\n                collision = true;\r\n            }\r\n            if (collision) {\r\n                ac = this.minf2(aave, astart + 0.5);\r\n                this.bases[nstart].setX(\r\n                        this.bases[start].getX() + Math.cos(ac));\r\n                this.bases[nstart].setY(\r\n                        this.bases[start].getY() + Math.sin(ac));\r\n                start = nstart;\r\n                ac = this.maxf2(aave, aend2 - 0.5);\r\n                this.bases[nend].setX(this.bases[end].getX() + Math.cos(ac));\r\n                this.bases[nend].setY(this.bases[end].getY() + Math.sin(ac));\r\n                end = nend;\r\n                n -= 2;\r\n            }\r\n        } while (collision && n > 1);\r\n    }\r\n}\r\n\r\nNAView.prototype.construct_circle_segment = function construct_circle_segment(start, end){\r\n    var dx, dy, rr, midx, midy, xn, yn, nrx, nry, mx, my, a;\r\n    var l, j, i;\r\n\r\n    dx = this.bases[end].getX() - this.bases[start].getX();\r\n    dy = this.bases[end].getY() - this.bases[start].getY();\r\n    rr = Math.sqrt(dx * dx + dy * dy);\r\n    l = end - start;\r\n    if (l < 0){\r\n        l += this.nbase + 1;\r\n    }\r\n    if (rr >= l) {\r\n        dx /= rr;\r\n        dy /= rr;\r\n        for (j = 1; j < l; j++) {\r\n            i = start + j;\r\n            if (i > this.nbase){\r\n                i -= this.nbase + 1;\r\n            }\r\n            this.bases[i].setX(\r\n                    this.bases[start].getX() + dx * j / l);\r\n            this.bases[i].setY(\r\n                    this.bases[start].getY() + dy * j / l);\r\n        }\r\n    }\r\n    else {\r\n        this.find_center_for_arc((l - 1), rr);\r\n        dx /= rr;\r\n        dy /= rr;\r\n        midx = this.bases[start].getX() + dx * rr / 2.0;\r\n        midy = this.bases[start].getY() + dy * rr / 2.0;\r\n        xn = dy;\r\n        yn = -dx;\r\n        nrx = midx + this._h * xn;\r\n        nry = midy + this._h * yn;\r\n        mx = this.bases[start].getX() - nrx;\r\n        my = this.bases[start].getY() - nry;\r\n        rr = Math.sqrt(mx * mx + my * my);\r\n        a = Math.atan2(my, mx);\r\n        for (j = 1; j < l; j++) {\r\n            i = start + j;\r\n            if (i > this.nbase){\r\n                i -= this.nbase + 1;\r\n            }\r\n            this.bases[i].setX(nrx + rr * Math.cos(a + j * this.angleinc));\r\n            this.bases[i].setY(nry + rr * Math.sin(a + j * this.angleinc));\r\n        }\r\n    }\r\n}\r\n\r\nNAView.prototype.find_center_for_arc = function find_center_for_arc(n, b){\r\n    var h, hhi, hlow, r, disc, theta, e, phi;\r\n    var iter;\r\n\r\n    hhi = (n + 1.0) / Math.PI;\r\n    // changed to prevent div by zero if (ih)\r\n    hlow = -hhi - b / (n + 1.000001 - b);\r\n    if (b < 1){\r\n        // otherwise we might fail below (ih)\r\n        hlow = 0;\r\n    }\r\n    iter = 0;\r\n    do {\r\n        h = (hhi + hlow) / 2.0;\r\n        r = Math.sqrt(h * h + b * b / 4.0);\r\n        disc = 1.0 - 0.5 / (r * r);\r\n        if (Math.abs(disc) > 1.0) {\r\n            console.log(\"Unexpected large magnitude discriminant = \" + disc\r\n                            + \" \" + r);\r\n        }\r\n        theta = Math.acos(disc);\r\n        phi = Math.acos(h / r);\r\n        e = theta * (n + 1) + 2 * phi - 2 * Math.PI;\r\n        if (e > 0.0) {\r\n            hlow = h;\r\n        }\r\n        else {\r\n            hhi = h;\r\n        }\r\n    } while (Math.abs(e) > 0.0001 && ++iter < this.MAXITER);\r\n    if (iter >= this.MAXITER) {\r\n        if (noIterationFailureYet) {\r\n            console.log(\"Iteration failed in find_center_for_arc\");\r\n            noIterationFailureYet = false;\r\n        }\r\n        h = 0.0;\r\n        theta = 0.0;\r\n    }\r\n    this._h = h;\r\n    this.angleinc = theta;\r\n}\r\n\r\nNAView.prototype.generate_region = function generate_region(cp){\r\n    var l, start, end, i, mate;\r\n    var rp;\r\n\r\n    rp = cp.getRegion();\r\n    l = 0;\r\n    if (cp.getStart() == rp.getStart1()) {\r\n        start = rp.getStart1();\r\n        end = rp.getEnd1();\r\n    }\r\n    else {\r\n        start = rp.getStart2();\r\n        end = rp.getEnd2();\r\n    }\r\n    if (this.bases[cp.getStart()].getX() > this.ANUM - 100.0\r\n            || this.bases[cp.getEnd()].getX() > this.ANUM - 100.0) {\r\n        console.log(\r\n                \"Bad region passed to generate_region. Coordinates not defined.\");\r\n    }\r\n    for (i = start + 1; i <= end; i++) {\r\n        l++;\r\n        this.bases[i].setX(\r\n                this.bases[cp.getStart()].getX() + this.HELIX_FACTOR * l\r\n                        * cp.getXrad());\r\n        this.bases[i].setY(\r\n                this.bases[cp.getStart()].getY() + this.HELIX_FACTOR * l\r\n                        * cp.getYrad());\r\n        mate = this.bases[i].getMate();\r\n        this.bases[mate].setX(\r\n                this.bases[cp.getEnd()].getX() + this.HELIX_FACTOR * l\r\n                        * cp.getXrad());\r\n        this.bases[mate].setY(\r\n                this.bases[cp.getEnd()].getY() + this.HELIX_FACTOR * l\r\n                        * cp.getYrad());\r\n\r\n    }\r\n}\r\n\r\nNAView.prototype.minf2 = function minf2(x1, x2) {\r\n    return ((x1) < (x2)) ? (x1) : (x2);\r\n}\r\n\r\nNAView.prototype.maxf2 = function maxf2(x1, x2) {\r\n    return ((x1) > (x2)) ? (x1) : (x2);\r\n}\r\n\r\nNAView.prototype.connected_connection = function connected_connection(cp, cpnext) {\r\n    if (cp.isExtruded()) {\r\n        return true;\r\n    }\r\n    else if (cp.getEnd() + 1 == cpnext.getStart()) {\r\n        return true;\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n}\r\n","/* Version: 0.2\r\n* Date: 2015-03-15\r\n*/\r\n\r\nimport fstyle from './fornac.module.css';\r\n\r\nimport d3 from 'd3';\r\nimport slugid from 'slugid';\r\nimport {contextMenu} from './d3-context-menu.js';\r\n\r\nimport {RNAGraph} from './rnagraph.js';\r\nimport {ColorScheme, rnaUtilities} from './rnautils.js';\r\n\r\nimport {simpleXyCoordinates} from './simplernaplot.js';\r\nimport {NAView} from './naview/naview.js';\r\n\r\nexport function FornaContainer(element, passedOptions = {}) {\r\n    var self = this;\r\n\r\n    let options = {\r\n        'editable': false,\r\n        'zoomable': true,\r\n        'animation': true,\r\n        'displayAllLinks': false,\r\n        'labelInterval': 10,\r\n        'chargeDistance': 110,\r\n        'friction': 0.35,\r\n        'middleCharge': -30,\r\n        'otherCharge': -30,\r\n        'linkDistanceMultiplier': 15,\r\n        'initialSize': null,\r\n        'layout': 'standard-polygonal',\r\n        'transitionDuration': 500,\r\n        'maxNodeRadius': 80    // the maximum radius of a node when the view is centered\r\n    };\r\n\r\n    self.options = Object.assign(options, passedOptions);\r\n\r\n    if (self.options.initialSize !== null) {\r\n        self.options.svgW = self.options.initialSize[0];\r\n        self.options.svgH = self.options.initialSize[1];\r\n    } else {\r\n        self.options.svgW = 300;\r\n        self.options.svgH = 300;\r\n    }\r\n\r\n    self.linkStrengths = {\r\n        'pseudoknot': 0.00,\r\n        'proteinChain': 0.00,\r\n        'chainChain': 0.00,\r\n        'intermolecule': 10.00,\r\n        'external': 0.00,\r\n        'other': 10.00\r\n    };\r\n\r\n    self.displayParameters = {\r\n        'displayNumbering': true,\r\n        'displayNodeOutline': true,\r\n        'displayNodeLabel': true,\r\n        'displayLinks': true,\r\n        'displayPseudoknotLinks': true,\r\n        'displayProteinLinks': true,\r\n        'displayDirectionArrows': true\r\n    };\r\n\r\n    self.colorScheme = 'structure';\r\n    self.customColors = {};\r\n    self.rnas = {};\r\n    self.extraLinks = []; //store links between different RNAs\r\n\r\n    // global mouse event vars\r\n    var mousedownLink = null,\r\n        mousedownNode = null,\r\n        mouseupNode = null;\r\n    let linkContextMenuShown = false;\r\n\r\n    let resetMouseVars = () => {\r\n        mousedownNode = null;\r\n        mouseupNode = null;\r\n        mousedownLink = null;\r\n    }\r\n\r\n    var graph = self.graph = {\r\n        'nodes':[],\r\n        'links':[]\r\n    };\r\n\r\n    Array.prototype.equals = function (array) {\r\n        // if the other array is a falsy value, return\r\n        if (!array)\r\n            return false;\r\n\r\n        // compare lengths - can save a lot of time\r\n        if (this.length != array.length)\r\n            return false;\r\n\r\n        for (var i = 0, l=this.length; i < l; i++) {\r\n            // Check if we have nested arrays\r\n            if (this[i] instanceof Array && array[i] instanceof Array) {\r\n                // recurse into the nested arrays\r\n                if (!this[i].equals(array[i]))\r\n                    return false;\r\n            }\r\n            else if (this[i] != array[i]) {\r\n                // Warning - two different object instances will never be equal: {x:20} != {x:20}\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /* Register global mouse and key events */\r\n    if (self.options.editable || self.options.animation) {\r\n      var shiftKeydown = false;\r\n      var ctrlKeydown = false;\r\n\r\n      let keydown = () => {\r\n          switch (d3.event.keyCode) {\r\n              case 68:    //'d' key\r\n                  console.log('dotbracket:', self.getStructuresDotBracket());\r\n                  break;\r\n              case 16:\r\n                  shiftKeydown = true;\r\n                  break;\r\n              case 17:\r\n                  ctrlKeydown = true;\r\n                  break;\r\n              case 67: //c\r\n                  self.centerView();\r\n                  break;\r\n          }\r\n\r\n          if (ctrlKeydown) {\r\n            // Ctrl key must disable panning and zooming\r\n            if (self.options.zoomable)\r\n              disableZooming()\r\n            // Ctrl Button must enable crosshair and start brusher\r\n            if (self.options.editable || self.options.animation) {\r\n              enableBrushing()\r\n            }\r\n          }\r\n      }\r\n\r\n      let keyup = () => {\r\n          shiftKeydown = false;\r\n          ctrlKeydown = false;\r\n\r\n          // enable zoomer\r\n          if (self.options.zoomable)\r\n            enableZooming()\r\n          // disable brushing events\r\n          disableBrushing()\r\n      }\r\n\r\n      d3.select('body')\r\n      .on('keydown', keydown)\r\n      .on('keyup', keyup)\r\n      .on('contextmenu', function() {\r\n          d3.event.preventDefault();\r\n      });\r\n    }\r\n\r\n    /* Register global context menu */\r\n    if (self.options.editable) {\r\n        let backgroundMenu = [\r\n            {\r\n                title: 'Add Node',\r\n                action: function(elm, d, i, mousePos) {\r\n\r\n                },\r\n                children: [{\r\n                    'title': 'A',\r\n                    action: function(elm, d, i, mousePos) {\r\n                        console.log('mousePos:', mousePos, self.options.svgW, self.options.svgH);\r\n                        let canvasMousePos = [xScale.invert(mousePos[0]),\r\n                                              yScale.invert(mousePos[1])];\r\n                        console.log('canvasMousePos', canvasMousePos);\r\n\r\n                        self.addRNA('.', {'sequence': 'A', 'centerPos': canvasMousePos});\r\n                    }\r\n                },\r\n                {\r\n                    'title': 'C',\r\n                    action: function(elm, d, i, mousePos) {\r\n                        console.log('mousePos:', mousePos, self.options.svgW, self.options.svgH);\r\n                        let canvasMousePos = [xScale.invert(mousePos[0]),\r\n                                              yScale.invert(mousePos[1])];\r\n                        console.log('canvasMousePos', canvasMousePos);\r\n\r\n                        self.addRNA('.', {'sequence': 'C', 'centerPos': canvasMousePos});\r\n                    }\r\n\r\n                    },\r\n                {\r\n                    'title': 'G',\r\n                    action: function(elm, d, i, mousePos) {\r\n                        console.log('mousePos:', mousePos, self.options.svgW, self.options.svgH);\r\n                        let canvasMousePos = [xScale.invert(mousePos[0]),\r\n                                              yScale.invert(mousePos[1])];\r\n                        console.log('canvasMousePos', canvasMousePos);\r\n\r\n                        self.addRNA('.', {'sequence': 'G', 'centerPos': canvasMousePos});\r\n                    }\r\n\r\n                    },\r\n                {\r\n                    'title': 'U',\r\n                    action: function(elm, d, i, mousePos) {\r\n                        console.log('mousePos:', mousePos, self.options.svgW, self.options.svgH);\r\n                        let canvasMousePos = [xScale.invert(mousePos[0]),\r\n                                              yScale.invert(mousePos[1])];\r\n                        console.log('canvasMousePos', canvasMousePos);\r\n\r\n                        self.addRNA('.', {'sequence': 'U', 'centerPos': canvasMousePos});\r\n\r\n                    }\r\n                }\r\n                ],\r\n                disabled: false // optional, defaults to false\r\n            }\r\n        ]\r\n\r\n        let nodeMenu = [\r\n            {\r\n                title: 'Delete Node',\r\n                action: function(elm, d, i) {\r\n                    deleteNode(d);\r\n                },\r\n                disabled: false // optional, defaults to false\r\n            },\r\n            {\r\n                title: 'Change Node',\r\n                action: function(elm, d, i) {\r\n                    console.log('You have clicked the second item!');\r\n                    console.log('The data for this circle is: ' + d);\r\n                },\r\n                children: [\r\n                    {\r\n                        title: 'A',\r\n                        action: function(elm, d, i) {\r\n                            changeNode('A', d);\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'C',\r\n                        action: function(elm, d, i) {\r\n                            changeNode('C', d);\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'G',\r\n                        action: function(elm, d, i) {\r\n                            changeNode('G', d);\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'U',\r\n                        action: function(elm, d, i) {\r\n                            changeNode('U', d);\r\n                        }\r\n                    },\r\n                ]\r\n            },\r\n            {\r\n                title: 'Insert Before',\r\n                action: function(elm, d, i) {\r\n\r\n                },\r\n                children: [\r\n                    {\r\n                        title: 'A',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('A', d, -1);\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'C',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('C', d, -1);\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'G',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('G', d, -1);\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'U',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('U', d, -1);\r\n                        }\r\n                    },\r\n                ]\r\n            },\r\n            {\r\n                title: 'Insert After',\r\n                action: function(elm, d, i) {\r\n                    console.log('d:', d);\r\n\r\n                },\r\n                children: [\r\n                    {\r\n                        title: 'A',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('A', d, 0);\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'C',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('C', d, 0);\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'G',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('G', d, 0);\r\n                        }\r\n                    },\r\n                    {\r\n                        title: 'U',\r\n                        action: function(elm, d, i) {\r\n                            insertNodeBeforeOrAfter('U', d, 0);\r\n                        }\r\n                    },\r\n                ]\r\n            }\r\n        ]\r\n\r\n        self.nodeContextMenu = contextMenu(nodeMenu);\r\n        self.backgroundContextMenu = contextMenu(backgroundMenu);\r\n\r\n    }  else {\r\n        //console.log('empty context menu');\r\n        self.nodeContextMenu = function() {};\r\n    }\r\n\r\n    /* Draw the plot here */\r\n    d3.select(element).select('svg').remove();\r\n\r\n    var svg = d3.select(element)\r\n    .attr('tabindex', 1)\r\n    .each(function() { this.focus(); })\r\n    .append('svg:svg')\r\n    .attr('preserveAspectRatio', 'xMidYMid meet')\r\n    .attr('viewBox', '0 0 ' + self.options.svgW + ' ' + self.options.svgH)\r\n\r\n    self.options.svg = svg;\r\n\r\n    if (self.options.editable || self.options.animation) {\r\n      var mouseEventHelper = svg.append('svg:g')\r\n      .on('mousemove', () => {\r\n            // only if we are dragging\r\n            if (!mousedownNode) return;\r\n\r\n            // update drag line\r\n            let mpos = d3.mouse(vis.node());\r\n            dragLine\r\n            .attr('x1', mousedownNode.x)\r\n            .attr('y1', mousedownNode.y)\r\n            .attr('x2', mpos[0])\r\n            .attr('y2', mpos[1]);\r\n          })\r\n      .on('mousedown', () => {\r\n      })\r\n      .on('mouseup', () => {\r\n            if (mousedownNode && !linkContextMenuShown) {\r\n                dragLine.classed(fstyle.transparent, true);\r\n            }\r\n            // clear mouse event vars\r\n            resetMouseVars();\r\n            //update()\r\n          })\r\n      .classed(fstyle.mouseEventHelper, true)\r\n      .style('pointer-events', 'all')\r\n\r\n      // draw a background layer for mouse events\r\n      mouseEventHelper.append('svg:rect')\r\n      .classed('background', true)\r\n      .style('visibility', 'hidden')\r\n      .attr('width', self.options.svgW)\r\n      .attr('height', self.options.svgH)\r\n      .on('mousedown', function() {\r\n        //console.log('background click');\r\n        deselectAllNodes()\r\n      })\r\n    } else {\r\n      var mouseEventHelper = svg;\r\n    }\r\n\r\n    var vis = mouseEventHelper.append('svg:g')\r\n    .classed(fstyle.plot, true)\r\n    var visLinks = vis.append('svg:g')\r\n    .classed('fornac-links', true);\r\n    var visNodes = vis.append('svg:g')\r\n    .classed('fornac-nodes', true);\r\n\r\n    // line displayed when dragging new nodes\r\n    if (self.options.editable) {\r\n      var dragLine = vis.append('line')\r\n      .attr('class', fstyle.dragLine)\r\n      .attr('x1', 0)\r\n      .attr('y1', 0)\r\n      .attr('x2', 0)\r\n      .attr('y2', 0);\r\n\r\n      svg.on('contextmenu', self.backgroundContextMenu);\r\n    }\r\n\r\n    /* Zooming related objects and functions */\r\n    var xScale = d3.scale.linear()\r\n    .domain([0,self.options.svgW]).range([0,self.options.svgW]);\r\n    var yScale = d3.scale.linear()\r\n    .domain([0,self.options.svgH]).range([0, self.options.svgH]);\r\n\r\n    self.zoomer = d3.behavior.zoom()\r\n      .scaleExtent([0.1,10])\r\n      .x(xScale)\r\n      .y(yScale)\r\n      .on('zoom', () => {\r\n          vis.attr('transform',\r\n                   'translate(' + d3.event.translate + ')' + ' scale(' + d3.event.scale + ')');\r\n      });\r\n\r\n    let enableZooming = () => {\r\n      svg.call(self.zoomer)\r\n      .on(\"dblclick.zoom\", null);\r\n    }\r\n\r\n    let disableZooming = () => {\r\n      svg.call(self.zoomer)\r\n      .on(\"dblclick.zoom\", null)\r\n      .on('mousedown.zoom', null)\r\n      .on('touchstart.zoom', null)\r\n      .on('touchmove.zoom', null)\r\n      .on('touchend.zoom', null);\r\n    }\r\n\r\n    if (self.options.zoomable)\r\n      enableZooming()\r\n\r\n    /* Node selection related objects and functions */\r\n    let toggleSelectNode = (node) => {\r\n      node.selected = !node.selected;\r\n      visNodes.selectAll('g.gnode').filter((d) => { return node.uid == d.uid; })\r\n      .classed(fstyle.selectedNode, function(p) { return p.selected; });\r\n    }\r\n\r\n    let selectNode = (node) => {\r\n      node.selected = true;\r\n      visNodes.selectAll('g.gnode').filter((d) => { return node.uid == d.uid; })\r\n      .classed(fstyle.selectedNode, function(p) { return p.selected; });\r\n    }\r\n\r\n    let deselectAllNodes = () => {\r\n      visNodes.selectAll('g.gnode')\r\n      .classed(fstyle.selectedNode, function(p) { return p.selected = false; });\r\n    }\r\n\r\n    let selectedNodes = () => {\r\n      // return all selected nodes\r\n      return visNodes.selectAll('g.gnode').filter(function(d) { return d.selected; });\r\n    }\r\n\r\n    self.brusher = d3.svg.brush()\r\n      .x(xScale)\r\n      .y(yScale)\r\n      .on('brushstart', function(d) {})\r\n      .on('brush', function() {\r\n        // during brushing invert styling of selection as preview\r\n        let extent = d3.event.target.extent();\r\n\r\n        visNodes.selectAll('g.gnode')\r\n        .classed(fstyle.selectedNode, function (d) {\r\n         return d.selected ^ (extent[0][0] <= d.x && d.x < extent[1][0]\r\n                && extent[0][1] <= d.y && d.y < extent[1][1])\r\n        })\r\n      })\r\n      .on('brushend', function() {\r\n        // after brushing finally toggle the selection\r\n        let extent = d3.event.target.extent();\r\n\r\n        visNodes.selectAll('g.gnode')\r\n        .filter(function (d) {\r\n         return extent[0][0] <= d.x && d.x < extent[1][0]\r\n                && extent[0][1] <= d.y && d.y < extent[1][1]\r\n      })\r\n      .each(toggleSelectNode)\r\n\r\n      d3.event.target.clear();\r\n      d3.select(this).call(d3.event.target);\r\n    });\r\n\r\n    let enableBrushing = () => {\r\n     // crosshair curson\r\n     mouseEventHelper.select('.background').style('cursor', 'crosshair');\r\n     // bind brusher\r\n     mouseEventHelper.call(self.brusher);\r\n    }\r\n\r\n    let disableBrushing = () => {\r\n     // normal cursor\r\n     mouseEventHelper.select('.background').style('cursor', 'auto');\r\n     // disable brushing events\r\n     mouseEventHelper.call(self.brusher)\r\n     .on('mousedown.brush', null)\r\n     .on('touchstart.brush', null)\r\n     .on('touchmove.brush', null)\r\n     .on('touchend.brush', null);\r\n    }\r\n\r\n     /* Force related objects and functions */\r\n    self.force = d3.layout.force()\r\n    .charge(function(d) {\r\n      if (d.nodeType == 'middle')\r\n        return self.options.middleCharge;\r\n      else\r\n        return self.options.otherCharge;\r\n      })\r\n    .friction(self.options.friction)\r\n    .linkDistance(function(d) { return self.options.linkDistanceMultiplier * d.value; })\r\n    .linkStrength(function(d) { if (d.linkType in self.linkStrengths) {\r\n                                  return self.linkStrengths[d.linkType];\r\n                                } else {\r\n                                  return self.linkStrengths.other; }\r\n    })\r\n    .gravity(0.000)\r\n    .nodes(self.graph.nodes)\r\n    .links(self.graph.links)\r\n    .chargeDistance(self.options.chargeDistance)\r\n    .size([self.options.svgW, self.options.svgH]);\r\n\r\n    var drag = d3.behavior.drag()\r\n    .on('dragstart', function(d) {\r\n      console.log('dragstart')\r\n      d3.event.sourceEvent.stopPropagation();\r\n\r\n      selectedNodes().each(function(d1) {\r\n        d1.fixed |= 2;\r\n      });\r\n    })\r\n    .on('drag', (d) => {\r\n      if (shiftKeydown) return\r\n      selectedNodes().each(function(d1) {\r\n        d1.x += d3.event.dx;\r\n        d1.y += d3.event.dy;\r\n\r\n        d1.px += d3.event.dx;\r\n        d1.py += d3.event.dy;\r\n      });\r\n\r\n      self.resumeForce();\r\n      d3.event.sourceEvent.preventDefault();\r\n    })\r\n    .on('dragend', (d) => {\r\n      console.log('dragend')\r\n      selectedNodes().each(function(d1) {\r\n        d1.fixed &= ~6;\r\n      });\r\n    });\r\n\r\n    /* Main plot drawing functions */\r\n    let createInitialLayout = function(structure, passedOptions = {}) {\r\n        // the default options\r\n        let options = {\r\n                        'sequence': '',\r\n                        'name': 'empty',\r\n                        'positions': [],\r\n                        'labelInterval': self.options.labelInterval,\r\n                        'avoidOthers': true,\r\n                        'uids': [],\r\n                        'circularizeExternal': true\r\n                      };\r\n\r\n        options = Object.assign(options, passedOptions);\r\n\r\n        //console.log('options.uids:', options.uids);\r\n        let rg = new RNAGraph(options.sequence, structure, options.name);\r\n        rg.circularizeExternal = options.circularizeExternal;\r\n\r\n        let rnaJson = rg.recalculateElements();\r\n\r\n        if (options.positions.length === 0) {\r\n            // no provided positions means we need to calculate an initial layout\r\n\r\n            if (self.options.layout == 'naview') {\r\n                let naview = new NAView();\r\n\r\n                let naViewPositions = naview.naview_xy_coordinates(rg.pairtable);\r\n                options.positions = []\r\n                for (let i = 0; i < naViewPositions.nbase; i++)\r\n                    options.positions.push([naViewPositions.x[i], naViewPositions.y[i]]);\r\n            } else {\r\n                options.positions = simpleXyCoordinates(rnaJson.pairtable);\r\n            }\r\n        }\r\n\r\n        rnaJson = rnaJson.elementsToJson()\r\n        .addUids(options.uids)\r\n        .addPositions('nucleotide', options.positions)\r\n        .addLabels(1, options.labelInterval)\r\n        .reinforceStems()\r\n        .reinforceLoops()\r\n        .connectFakeNodes()\r\n        .reassignLinkUids()\r\n        .breakNodesToFakeNodes();\r\n\r\n        return rnaJson;\r\n    };\r\n\r\n    let createNewNodes = function(gnodesEnter) {\r\n        gnodesEnter = gnodesEnter.append('g')\r\n        .classed('gnode', true)\r\n        .attr('struct_name', function(d) { return d.structName; })\r\n        .attr('transform', function(d) {\r\n            if (typeof d.x != 'undefined' && typeof d.y != 'undefined')\r\n                return 'translate(' + [d.x, d.y] + ')';\r\n            else\r\n                return '';\r\n        })\r\n        .each( function(d) { d.selected = d.previouslySelected = false; });\r\n\r\n        gnodesEnter\r\n        .attr('num', function(d) { return 'n' + d.num; })\r\n        .attr('rnum', function(d) {\r\n            return 'n' + (d.rna.rnaLength - d.num + 1); })\r\n        .transition()\r\n        .duration(750)\r\n        .ease('elastic');\r\n\r\n        if (self.options.editable || self.options.animation) {\r\n          gnodesEnter.on('mousedown', nodeMousedown)\r\n          //.on('mousedrag', function(d) {})\r\n          .on('mouseup', nodeMouseup)\r\n          .on('contextmenu', self.nodeContextMenu)\r\n          .call(drag)\r\n        }\r\n\r\n        let labelAndProteinNodes = gnodesEnter.filter(function(d) {\r\n            return d.nodeType == 'label' || d.nodeType == 'protein';\r\n        });\r\n\r\n        let nucleotideNodes = gnodesEnter.filter(function(d) {\r\n            return d.nodeType == 'nucleotide';\r\n        });\r\n\r\n        labelAndProteinNodes.append('svg:circle')\r\n        .classed(fstyle.node, true)\r\n        .attr('r', function(d) {\r\n            if (d.nodeType == 'middle') return 0;\r\n            else {\r\n                return d.radius;\r\n            }\r\n        })\r\n        .attr('node_type', function(d) { return d.nodeType; })\r\n        .attr('node_num', function(d) { return d.num; });\r\n\r\n        // direction arrows\r\n        nucleotideNodes.append('svg:path')\r\n        .attr('class', fstyle.directionArrow)\r\n        .attr('node_num', function(d) { return d.num; })\r\n\r\n        // nucleotide outlines\r\n        nucleotideNodes.append('svg:circle')\r\n        .attr('class', fstyle.node)\r\n        .attr('node_type', function(d) { return d.nodeType; })\r\n        .attr('node_num', function(d) { return d.num; })\r\n        .attr('r', function(d) { return d.radius; })\r\n        .append('svg:title')\r\n        .text(function(d) {\r\n            if (d.nodeType == 'nucleotide') {\r\n                return d.structName + ':' + d.num;\r\n            } else {\r\n                return '';\r\n            }\r\n        });\r\n\r\n        // nucleotide labels\r\n        var labelsEnter = gnodesEnter.append('text')\r\n        .text(function(d) { return d.name; })\r\n        .attr('class', fstyle.nodeLabel)\r\n        .attr('label_type', function(d) { return d.nodeType; })\r\n\r\n        // nucleotide label title\r\n        labelsEnter.append('svg:title')\r\n        .text(function(d) {\r\n            if (d.nodeType == 'nucleotide') {\r\n                return d.structName + ':' + d.num;\r\n            } else {\r\n                return '';\r\n            }\r\n        });\r\n\r\n        return gnodesEnter;\r\n    };\r\n\r\n    let createNewLinks = function(linksEnter) {\r\n        var linkLines = linksEnter.append('svg:line');\r\n\r\n        linkLines.append('svg:title')\r\n        .text((d) => { return d.linkType + ':' + d.source.num + '-' + d.target.num });\r\n\r\n        linkLines\r\n        .classed('link', true)\r\n        .classed(fstyle.link, true)\r\n        .attr('x1', function(d) { return d.source.x; })\r\n        .attr('y1', function(d) { return d.source.y; })\r\n        .attr('x2', function(d) { return d.target.x; })\r\n        .attr('y2', function(d) { return d.target.y; })\r\n        .attr('link_type', function(d) { return d.linkType; } )\r\n        .attr('pointer-events', function(d) { if (d.linkType == 'fake') return 'none'; else return 'all';});\r\n\r\n        if (self.options.editable)\r\n          linkLines.on('click', linkClick);\r\n\r\n        /* We don't need to update the positions of the stabilizing links */\r\n        /*\r\n        basepairLinks = visLinks.selectAll('[link_type=basepair]');\r\n        basepairLinks.classed('basepair', true);\r\n\r\n        fakeLinks = visLinks.selectAll('[link_type=fake]')\r\n        fakeLinks.classed('fake', true);\r\n\r\n        intermolecule_links = vis_links.selectAll('[link_type=intermolecule]');\r\n        intermolecule_links.classed('intermolecule', true);\r\n\r\n        plink = vis_links.selectAll('[link_type=protein_chain],[link_type=chain_chain]');\r\n        plink.classed('chain_chain', true);\r\n        */\r\n\r\n       return linkLines;\r\n    };\r\n\r\n    function drawDirectionArrow(d) {\r\n        let magnitude = (x) => {\r\n            return Math.sqrt(x[0] * x[0] + x[1] * x[1]);\r\n        }\r\n\r\n        let endPoint = d;\r\n        let startPoint = d.prevNode;\r\n        // get stroke width and arrow size values from css\r\n        let nodeStroke = parseFloat(fstyle.nodeStrokeWidth) / 2;\r\n        let lengthMult = parseFloat(fstyle.directionArrowSize);\r\n        let arrowWidth = parseFloat(fstyle.directionArrowWidth);\r\n        console.log(fstyle);\r\n\r\n        if (startPoint === null)\r\n            return;\r\n\r\n        // does this node have a link pointing to it?\r\n        if (!d.linked)\r\n            return;\r\n\r\n        // point back toward the previous node\r\n        let u = [-(endPoint.x - startPoint.x), -(endPoint.y - startPoint.y)];\r\n\r\n        if (u[0] == 0 && u[1] == 0)\r\n            return;     // will lead to a NaN error\r\n\r\n        // scale u to unit length\r\n        u = [u[0] / magnitude(u), u[1] / magnitude(u)];\r\n        // normal vector of u\r\n        let v = [-u[1], u[0]];\r\n\r\n        // calculate the tip position\r\n        let arrowTip = [(d.radius + nodeStroke) * u[0], (d.radius + nodeStroke) * u[1]];\r\n\r\n        let path = 'M' + (arrowTip[0] + lengthMult * (u[0]/2 + v[0]*arrowWidth/2)) + ',' + (arrowTip[1] + lengthMult * (u[1]/2 + v[1]*arrowWidth/2)) +\r\n                   'L' + (arrowTip[0]) + ',' + (arrowTip[1]) +\r\n                   'L' + (arrowTip[0] + lengthMult * (u[0]/2 - v[0]*arrowWidth/2)) + ',' + (arrowTip[1] + lengthMult * (u[1]/2 - v[1]*arrowWidth/2));\r\n\r\n        d3.select(this).attr('d', path);\r\n    }\r\n\r\n    let realLinkFilter = (d) => {\r\n        return d.linkType == 'basepair' ||\r\n               d.linkType == 'backbone' ||\r\n               d.linkType == 'intermolecule' ||\r\n               d.linkType == 'pseudoknot' ||\r\n               d.linkType == 'label_link' ||\r\n               d.linkType == 'external' ||\r\n               d.linkType == 'chain_chain';\r\n    }\r\n\r\n    let recalculateGraph = () => {\r\n        // Condense all of the individual RNAs into one\r\n        // collection of nodes and links\r\n        self.graph.nodes = [];\r\n        self.graph.links = [];\r\n        for (let uid in self.rnas) {\r\n            self.graph.nodes = self.graph.nodes.concat(self.rnas[uid].nodes);\r\n            self.graph.links = self.graph.links.concat(self.rnas[uid].links);\r\n        }\r\n\r\n        // Create a lookup table so that we can access each node\r\n        // based on its uid. This will be used to create the links\r\n        // between different RNAs\r\n        var uidsToNodes = {};\r\n\r\n        for (let i = 0; i < self.graph.nodes.length; i++)\r\n            uidsToNodes[self.graph.nodes[i].uid] = self.graph.nodes[i];\r\n\r\n        self.graph.links.forEach(function(link) {\r\n            link.source = uidsToNodes[link.source.uid];\r\n            link.target = uidsToNodes[link.target.uid];\r\n        });\r\n\r\n        for (let i = 0; i < self.extraLinks.length; i++) {\r\n            // the actual node objects may have changed, so we hae to recreate\r\n            // the extra links based on the uids\r\n            if (!(self.extraLinks[i].target.uid in uidsToNodes)) {\r\n                console.log('not there:', self.extraLinks[i]);\r\n                continue;\r\n            }\r\n\r\n            self.extraLinks[i].source = uidsToNodes[self.extraLinks[i].source.uid];\r\n            self.extraLinks[i].target = uidsToNodes[self.extraLinks[i].target.uid];\r\n\r\n            if (self.extraLinks[i].linkType == 'intermolecule') {\r\n                //remove links to middle nodes\r\n                let fakeLinks = self.graph.links.filter(function(d) {\r\n                    return ((d.source == self.extraLinks[i].source || d.source == self.extraLinks[i].target ||\r\n                            d.target == self.extraLinks[i].source || d.target == self.extraLinks[i].source) &&\r\n                            d.linkType == 'fake');\r\n                });\r\n\r\n                for (let j = 0; j < fakeLinks.length; j++) {\r\n                    let linkIndex = self.graph.links.indexOf(fakeLinks[j]);\r\n                    self.graph.links.splice(linkIndex, 1);\r\n                }\r\n            }\r\n\r\n            graph.links.push(self.extraLinks[i]);\r\n        }\r\n    };\r\n\r\n    self.update = function () {\r\n        self.force.nodes(self.graph.nodes)\r\n        .links(self.graph.links);\r\n\r\n        if (self.options.animation) {\r\n          self.force.start();\r\n        }\r\n\r\n        let allLinks = visLinks.selectAll('line.link')\r\n        .data(self.graph.links.filter(realLinkFilter), elementKey);\r\n\r\n        allLinks.attr('class', '')\r\n        .classed('link', true)\r\n        .classed(fstyle.link, true)\r\n        .attr('link_type', function(d) { return d.linkType; } )\r\n\r\n        let linksEnter = allLinks.enter();\r\n        createNewLinks(linksEnter);\r\n\r\n        allLinks.exit().remove();\r\n\r\n        let gnodes = visNodes.selectAll('g.gnode')\r\n        .data(self.graph.nodes, elementKey);\r\n        //.attr('pointer-events', 'all');\r\n\r\n        let gnodesEnter = gnodes.enter();\r\n        createNewNodes(gnodesEnter);\r\n        gnodes.exit().remove();\r\n\r\n\r\n        //fake_nodes = self.graph.nodes.filter(function(d) { return d.nodeType == 'middle'; });\r\n        //fakeNodes = self.graph.nodes.filter(function(d) { return true; });\r\n        let realNodes = self.graph.nodes.filter(function(d) { return d.nodeType == 'nucleotide' || d.nodeType == 'label';});\r\n\r\n        gnodes.select('.' + fstyle.directionArrow).each(drawDirectionArrow);\r\n\r\n        self.force.on('tick', function() {\r\n            let q = d3.geom.quadtree(realNodes);\r\n            let i = 0;\r\n            let n = realNodes.length;\r\n\r\n            let collide = (node) => {\r\n                let r = node.radius + 16,\r\n                nx1 = node.x - r,\r\n                nx2 = node.x + r,\r\n                ny1 = node.y - r,\r\n                ny2 = node.y + r;\r\n                return function(quad, x1, y1, x2, y2) {\r\n                    if (quad.point && (quad.point !== node)) {\r\n                        let x = node.x - quad.point.x,\r\n                        y = node.y - quad.point.y,\r\n                        l = Math.sqrt(x * x + y * y),\r\n                        r = node.radius + quad.point.radius;\r\n                        if (l < r) {\r\n                            l = (l - r) / l * 0.1;\r\n                            node.x -= x *= l;\r\n                            node.y -= y *= l;\r\n                            quad.point.x += x;\r\n                            quad.point.y += y;\r\n                        }\r\n                    }\r\n                    return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;\r\n                };\r\n            }\r\n\r\n            while (++i < n) q.visit(collide(realNodes[i]));\r\n\r\n            allLinks.attr('x1', function(d) { return d.source.x; })\r\n            .attr('y1', function(d) {  return d.source.y; })\r\n            .attr('x2', function(d) { return d.target.x; })\r\n            .attr('y2', function(d) { return d.target.y; });\r\n\r\n            // Translate the groups\r\n            gnodes.attr('transform', function(d) {\r\n                return 'translate(' + [d.x, d.y] + ')';\r\n            });\r\n\r\n            gnodes.select('.' + fstyle.directionArrow).each(drawDirectionArrow);\r\n\r\n        });\r\n\r\n        self.force.on('end', () => {\r\n            gnodes.selectAll('[node_type=nucleotide]')\r\n            .filter((d,i) => { if (i == 0) return true; else return false; })\r\n            .each((d,i) => {\r\n                //console.log(\"pos\", d.num, d.x, d.y);\r\n            });\r\n\r\n            //for (let uid in self.rnas) {\r\n            //    for (let i = 1; i < self.rnas[uid].pairtable[0]; i++) {\r\n            //        console.log('pt', i, self.rnas[uid].pairtable[i]);\r\n            //    }\r\n            //}\r\n\r\n        });\r\n\r\n        self.changeColorScheme(self.colorScheme);\r\n\r\n        if (self.options.animation) {\r\n          self.force.start();\r\n        }\r\n\r\n        updateStyle();\r\n    };\r\n\r\n    self.transitionRNA = function(newStructure, nextFunction) {\r\n        if (self.dotbracket == newStructure) {\r\n            return;\r\n        } else {\r\n            self.dotbracket = newStructure;\r\n        }\r\n        //transition from an RNA which is already displayed to a new structure\r\n        var duration = self.options.transitionDuration;\r\n\r\n        var uids = self.graph.nodes\r\n        .filter(function(d) { return d.nodeType == 'nucleotide'; })\r\n        .map(function(d) { return d.uid; });\r\n\r\n        let options = {'uids': uids};\r\n        var newRNAJson = createInitialLayout(newStructure, options);\r\n\r\n        let gnodes = visNodes.selectAll('g.gnode').data(newRNAJson.nodes, elementKey);\r\n        var links = visLinks.selectAll('line.link').data(newRNAJson.links.filter(realLinkFilter), elementKey);\r\n\r\n        if (duration === 0)\r\n            gnodes.attr('transform', function(d) {\r\n                return 'translate(' + [d.x, d.y] + ')';\r\n            });\r\n        else {\r\n            gnodes.transition()\r\n            .attr('transform', function(d) {\r\n                return 'translate(' + [d.x, d.y] + ')'; }).duration(duration);\r\n        }\r\n\r\n\r\n        var newNodes = createNewNodes(gnodes.enter())\r\n        .attr('transform', function(d) {\r\n            if (typeof d.x != 'undefined' && typeof d.y != 'undefined')\r\n                return 'translate(' + [0, 0] + ')';\r\n            else\r\n                return '';\r\n        });\r\n\r\n        if (duration === 0)\r\n            gnodes.exit().remove();\r\n        else\r\n            gnodes.exit().transition()\r\n            .attr('transform', function(d) {\r\n                if (typeof d.x != 'undefined' && typeof d.y != 'undefined')\r\n                    return 'translate(' + [0, 0] + ')';\r\n                else\r\n                    return '';\r\n            });\r\n\r\n        self.graph.nodes = gnodes.data();\r\n        gnodes.select('.' + fstyle.directionArrow).each(drawDirectionArrow);\r\n        self.changeColorScheme(self.colorScheme);\r\n        updateStyle();\r\n        self.centerView(duration);\r\n\r\n        function endall(transition, callback) {\r\n            if (transition.size() === 0) { setTimeout(callback, duration); }\r\n            var n = 0;\r\n            transition\r\n            .each(function() { ++n; })\r\n            .each('end', function() { if (!--n) callback.apply(this, arguments); });\r\n        }\r\n\r\n        function afterAnimation() {\r\n            var newLinks = createNewLinks(links.enter());\r\n            self.graph.links = links.data();\r\n            self.changeColorScheme(self.colorScheme);\r\n            updateStyle();\r\n\r\n            if (typeof nextFunction != 'undefined')\r\n                nextFunction();\r\n\r\n        }\r\n\r\n        links.exit().remove();\r\n\r\n        if (duration === 0) {\r\n            links\r\n            .attr('x1', function(d) { return d.source.x; })\r\n            .attr('y1', function(d) { return d.source.y; })\r\n            .attr('x2', function(d) { return d.target.x; })\r\n            .attr('y2', function(d) { return d.target.y; });\r\n\r\n            var newLinks = createNewLinks(links.enter());\r\n            self.graph.links = links.data();\r\n\r\n            updateStyle();\r\n        } else {\r\n            links.transition()\r\n            .attr('x1', function(d) { return d.source.x; })\r\n            .attr('y1', function(d) { return d.source.y; })\r\n            .attr('x2', function(d) { return d.target.x; })\r\n            .attr('y2', function(d) { return d.target.y; })\r\n            .duration(duration)\r\n            .call(endall, afterAnimation);\r\n        }\r\n\r\n        if (duration === 0) {\r\n            newNodes\r\n            .attr('transform', function(d) {\r\n                if (typeof d.x != 'undefined' && typeof d.y != 'undefined')\r\n                    return 'translate(' + [d.x, d.y] + ')';\r\n                else\r\n                    return '';\r\n            });\r\n        } else {\r\n            newNodes.transition()\r\n            .attr('transform', function(d) {\r\n                if (typeof d.x != 'undefined' && typeof d.y != 'undefined')\r\n                    return 'translate(' + [d.x, d.y] + ')';\r\n                else\r\n                    return '';\r\n            });\r\n        }\r\n\r\n    };\r\n\r\n    /* Plot presentation related functions */\r\n    let getBoundingBoxTransform = () => {\r\n        // Center the view on the molecule(s) and scale it so that everything\r\n        // fits in the window\r\n\r\n        //no molecules, nothing to do\r\n        if (self.graph.nodes.length === 0)\r\n            return {'translate': [0,0], 'scale': 1};\r\n\r\n        // Get the bounding box\r\n        var minX = d3.min(self.graph.nodes.map(function(d) {return d.x;}));\r\n        var minY = d3.min(self.graph.nodes.map(function(d) {return d.y;}));\r\n\r\n        var maxX = d3.max(self.graph.nodes.map(function(d) {return d.x;}));\r\n        var maxY = d3.max(self.graph.nodes.map(function(d) {return d.y;}));\r\n\r\n        var maxRadius = d3.max(self.graph.nodes.map(function(d) { return d.radius; }));\r\n\r\n        // The width and the height of the molecule\r\n        var molWidth = maxX - minX;\r\n        var molHeight = maxY - minY;\r\n\r\n        // how much larger the drawing area is than the width and the height\r\n        var widthRatio = self.options.svgW / (molWidth + 1);\r\n        var heightRatio = self.options.svgH / (molHeight + 1);\r\n\r\n        // we need to fit it in both directions, so we scale according to\r\n        // the direction in which we need to shrink the most\r\n        var minRatio = Math.min(widthRatio, heightRatio,\r\n                                self.options.maxNodeRadius / maxRadius) * 0.8;\r\n\r\n        // the new dimensions of the molecule\r\n        var newMolWidth = molWidth * minRatio;\r\n        var newMolHeight = molHeight * minRatio;\r\n\r\n        // translate so that it's in the center of the window\r\n        var xTrans = -(minX) * minRatio + (self.options.svgW - newMolWidth) / 2;\r\n        var yTrans = -(minY) * minRatio + (self.options.svgH - newMolHeight) / 2;\r\n\r\n        return {'translate': [xTrans, yTrans], 'scale': minRatio};\r\n    };\r\n\r\n    self.centerView = function(duration = 0) {\r\n        var bbTransform = getBoundingBoxTransform();\r\n\r\n        if (bbTransform === null)\r\n            return;\r\n\r\n        // do the actual moving\r\n        vis.transition().attr('transform',\r\n                 'translate(' + bbTransform.translate + ')' + ' scale(' + bbTransform.scale + ')').duration(duration);\r\n\r\n        // tell the zoomer what we did so that next we zoom, it uses the\r\n        // transformation we entered here\r\n        self.zoomer.translate(bbTransform.translate);\r\n        self.zoomer.scale(bbTransform.scale);\r\n    };\r\n\r\n    self.setSize = (\r\n      svgW = d3.select(element).node().offsetWidth,\r\n      svgH = d3.select(element).node().offsetHeight\r\n    ) => {\r\n      // save width and height\r\n      self.options.svgW = svgW;\r\n      self.options.svgH = svgH;\r\n\r\n      // set the viewBox\r\n      svg.attr('viewBox', \"0 0 \" + svgW + \" \" + svgH)\r\n\r\n      //Set the output range of the scales\r\n      xScale.range([0, svgW]).domain([0, svgW]);\r\n      yScale.range([0, svgH]).domain([0, svgH]);\r\n\r\n      //re-attach the scales to the zoom behaviour\r\n      self.zoomer.x(xScale)\r\n      .y(yScale);\r\n      self.brusher.x(xScale)\r\n      .y(yScale);\r\n\r\n      //resize the background\r\n      svg.select('.background')\r\n      .attr('width', svgW)\r\n      .attr('height', svgH);\r\n\r\n      // center the view\r\n      self.centerView();\r\n    }\r\n\r\n    /* Style and color related functions */\r\n    self.setOutlineColor = function(color) {\r\n        var nodes = visNodes.selectAll('g.gnode').select('[node_type=nucleotide]');\r\n        nodes.style('fill', color);\r\n    }\r\n\r\n    self.addCustomColors = function addCustomColors(json) {\r\n        // Add a json file containing the custom colors\r\n        self.customColors = json;\r\n        self.changeColorScheme('custom');\r\n    };\r\n\r\n    self.addCustomColorsText = function(customColorsText) {\r\n        let cs = new ColorScheme(customColorsText);\r\n        self.customColors = cs.colorsJson;\r\n        self.changeColorScheme('custom');\r\n    };\r\n\r\n    self.changeColorScheme = function(newColorScheme) {\r\n        var proteinNodes = visNodes.selectAll('[node_type=protein]');\r\n\r\n        proteinNodes.classed(fstyle.node, true)\r\n                    .attr('r', function(d) { return d.radius; });\r\n\r\n        var gnodes = visNodes.selectAll('g.gnode');\r\n        var circles = visNodes.selectAll('g.gnode').selectAll('circle');\r\n        var nodes = visNodes.selectAll('g.gnode').select('[node_type=nucleotide]');\r\n        self.colorScheme = newColorScheme;\r\n\r\n\r\n        if (newColorScheme == 'sequence') {\r\n            var scale = d3.scale.ordinal()\r\n            .range(['#dbdb8d', '#98df8a', '#ff9896', '#aec7e8', '#aec7e8'])\r\n            .domain(['A','C','G','U','T']);\r\n            nodes.style('fill', function(d) {\r\n                return scale(d.name);\r\n            });\r\n\r\n        } else if (newColorScheme == 'structure') {\r\n            var scale = d3.scale.category10()\r\n            .domain(['s','m','i','e','t','h','x'])\r\n            .range(['lightgreen', '#ff9896', '#dbdb8d', 'lightsalmon',\r\n                   'lightcyan', 'lightblue', 'transparent']);\r\n\r\n                   nodes.style('fill', function(d) {\r\n                       return scale(d.elemType);\r\n                   });\r\n\r\n        } else if (newColorScheme == 'positions') {\r\n            nodes.style('fill', function(d) {\r\n                var scale = d3.scale.linear()\r\n                .range(['#98df8a', '#dbdb8d', '#ff9896'])\r\n                .interpolate(d3.interpolateLab)\r\n                .domain([1, 1 + (d.rna.rnaLength - 1) / 2, d.rna.rnaLength]);\r\n\r\n                return scale(d.num);\r\n            });\r\n        } else if (newColorScheme == 'custom') {\r\n            // scale to be used in case the user passes scalar\r\n            // values rather than color names\r\n            if (typeof self.customColors != 'undefined' &&\r\n                'domain' in self.customColors &&\r\n               'range' in self.customColors) {\r\n                var scale = d3.scale.linear()\r\n                .interpolate(d3.interpolateLab)\r\n                .domain(self.customColors.domain)\r\n                .range(self.customColors.range);\r\n            }\r\n\r\n            let changeColors = (moleculeColors, d, scale) => {\r\n                if (moleculeColors.hasOwnProperty(d.num)) {\r\n                    let val = parseFloat(moleculeColors[d.num]);\r\n\r\n                    if (isNaN(val)) {\r\n                        // passed in color is not a scalar, so\r\n                        // treat it as a color\r\n                        return moleculeColors[d.num];\r\n                    } else {\r\n                        // the user passed in a float, let's use a colormap\r\n                        // to convert it to a color\r\n                        return scale(val);\r\n                    }\r\n                } else {\r\n                    return 'white';\r\n                }\r\n            }\r\n\r\n            nodes.style('fill', function(d) {\r\n                if (typeof self.customColors == 'undefined' ||\r\n                   !self.customColors.hasOwnProperty('colorValues')) {\r\n                    return 'white';\r\n                }\r\n\r\n                if (self.customColors.colorValues.hasOwnProperty(d.structName) &&\r\n                    self.customColors.colorValues[d.structName].hasOwnProperty(d.num)) {\r\n                    // if a molecule name is specified, it supercedes the default colors\r\n                    // (for which no molecule name has been specified)\r\n                    let moleculeColors = self.customColors.colorValues[d.structName];\r\n                    return changeColors(moleculeColors, d, scale);\r\n                } else if (self.customColors.colorValues.hasOwnProperty('')) {\r\n                    let moleculeColors = self.customColors.colorValues[''];\r\n                    return changeColors(moleculeColors, d, scale);\r\n                }\r\n\r\n                return 'white';\r\n            });\r\n        }\r\n    };\r\n\r\n    let updateStyle = () => {\r\n        // Numbering\r\n        visNodes.selectAll('[node_type=label]').classed(fstyle.transparent, !self.displayParameters.displayNumbering);\r\n        visNodes.selectAll('[label_type=label]').classed(fstyle.transparent, !self.displayParameters.displayNumbering);\r\n        visLinks.selectAll('[link_type=label_link]').classed(fstyle.transparent, !self.displayParameters.displayNumbering);\r\n        // Node Outline\r\n        svg.selectAll('[node_type=nucleotide]').classed(fstyle.transparent, !self.displayParameters.displayNodeOutline);\r\n        // Node Labels\r\n        visNodes.selectAll('[label_type=nucleotide]').classed(fstyle.transparent, !self.displayParameters.displayNodeLabel);\r\n        // Links\r\n        svg.selectAll('[link_type=real],[link_type=basepair],[link_type=backbone],[link_type=pseudoknot],[link_type=protein_chain],[link_type=chain_chain],[link_type=external]').classed(fstyle.transparent, !self.displayParameters.displayLinks);\r\n        // Pseudoknot Links\r\n        svg.selectAll('[link_type=pseudoknot]').classed(fstyle.transparent, !self.displayParameters.displayPseudoknotLinks);\r\n        // Protein Links\r\n        svg.selectAll('[link_type=protein_chain]').classed(fstyle.transparent, !self.displayParameters.displayProteinLinks);\r\n        // Fake Links\r\n        visLinks.selectAll('[link_type=fake]').classed(fstyle.transparent, !self.options.displayAllLinks);\r\n        visLinks.selectAll('[link_type=fake_fake]').classed(fstyle.transparent, !self.options.displayAllLinks);\r\n        // direction Arrows\r\n        svg.selectAll('.' + fstyle.directionArrow).classed(fstyle.transparent, !self.displayParameters.displayDirectionArrows);\r\n    };\r\n\r\n    /* RNA edditing related functions */\r\n    let changeNode = function(nodeName, referenceNode) {\r\n        // change the label of a node\r\n        let rna = referenceNode.rna;\r\n\r\n        let dotbracket = rnaUtilities.pairtableToDotbracket(rna.pairtable);\r\n        let positions = rna.getPositions('nucleotide');\r\n        let sequence = rna.seq\r\n        let uids = rna.getUids();\r\n\r\n        let newNodeNum = referenceNode.num;\r\n\r\n        let newDotbracket = dotbracket;\r\n        let newSequence = sequence.slice(0,newNodeNum-1) +  nodeName + sequence.slice(newNodeNum);\r\n\r\n        console.log('newSequence:', newSequence);\r\n\r\n        console.log('uids:', uids);\r\n        uids.splice(newNodeNum-1, 1, slugid.nice());\r\n        let newPositions = positions;\r\n\r\n        delete self.rnas[rna.uid];\r\n        let newRNA = self.addRNA(newDotbracket, {'sequence': newSequence,\r\n                                 'positions': newPositions,\r\n                                 'uids': uids,\r\n                                 'centerView': false});\r\n    }\r\n\r\n    let insertNodeBeforeOrAfter = function(nodeName, referenceNode, positionOffset) {\r\n        //insert a new node before or after another one\r\n        //positionOffset specifies who far from the original to insert the new node\r\n        let rna = referenceNode.rna;\r\n\r\n        let dotbracket = rnaUtilities.pairtableToDotbracket(rna.pairtable);\r\n        let positions = rna.getPositions('nucleotide');\r\n        let sequence = rna.seq\r\n        let uids = rna.getUids();\r\n\r\n        let newNodeNum = referenceNode.num + positionOffset;\r\n\r\n        let newDotbracket = dotbracket.slice(0,newNodeNum) + '.' + dotbracket.slice(newNodeNum);\r\n        let newSequence = sequence.slice(0,newNodeNum) +  nodeName + sequence.slice(newNodeNum);\r\n\r\n        console.log('newSequence:', newSequence);\r\n\r\n        uids.splice(newNodeNum, 0, slugid.nice());\r\n        positions.splice(newNodeNum, 0, positions[newNodeNum - positionOffset-1]);\r\n\r\n        let newUids = uids;\r\n        let newPositions = positions;\r\n\r\n        console.log('positions:', positions);\r\n        console.log('new node positions:', newPositions);\r\n\r\n        delete self.rnas[rna.uid];\r\n        let newRNA = self.addRNA(newDotbracket, {'sequence': newSequence,\r\n                                 'positions': newPositions,\r\n                                 'uids': newUids,\r\n                                 'centerView': false});\r\n    }\r\n\r\n    let deleteNode = function(node) {\r\n        console.log('deleting...', node);\r\n        // get the dotbracket string for this rna\r\n        let rna = node.rna;\r\n        let pair = rna.pairtable[node.num];\r\n\r\n        // remove basepairs for this node\r\n        if (pair != 0) {\r\n            rna.pairtable[node.num] = 0;\r\n            rna.pairtable[pair] = 0;\r\n        }\r\n\r\n        let dotbracket = rnaUtilities.pairtableToDotbracket(rna.pairtable);\r\n        let positions = rna.getPositions('nucleotide');\r\n        let sequence = rna.seq\r\n        let uids = rna.getUids();\r\n\r\n        let newDotbracket = dotbracket.slice(0, node.num-1) + dotbracket.slice(node.num)\r\n        let newPositions = positions.slice(0, node.num-1)\r\n                .concat(positions.slice(node.num));\r\n        let newSequence = sequence.slice(0, node.num-1) + sequence.slice(node.num)\r\n        let newUids = uids.slice(0, node.num-1)\r\n                .concat(uids.slice(node.num));\r\n\r\n        delete self.rnas[rna.uid];\r\n        let newRNA = self.addRNA(newDotbracket, {'sequence': newSequence,\r\n                                 'positions': newPositions,\r\n                                 'uids': newUids,\r\n                                  'centerView': false});\r\n\r\n        console.log('new dotbracket:', newDotbracket);\r\n        //recalculateGraph();\r\n\r\n        //remove backbone links associated with this node\r\n\r\n        //remove this node\r\n\r\n    }\r\n\r\n    let elementKey = (d) => {\r\n        return d.uid;\r\n    };\r\n\r\n    let updateRnaGraph = function(r) {\r\n        let nucleotidePositions = r.getPositions('nucleotide');\r\n        let labelPositions = r.getPositions('label');\r\n\r\n        let uids = r.getUids();\r\n\r\n        r.recalculateElements()\r\n        .elementsToJson()\r\n        .addPseudoknots()\r\n        .addPositions('nucleotide', nucleotidePositions)\r\n        .addUids(uids)\r\n        .addLabels(1, self.options.labelInterval)\r\n        .addPositions('label', labelPositions)\r\n        .reinforceStems()\r\n        .reinforceLoops()\r\n        .updateLinkUids();\r\n    };\r\n\r\n    let removeBackBoneLink = function(d) {\r\n        if (d.target.num - d.source.num != 1) {\r\n            console.log('ERROR: non adjacent nodes. Target:', d.target,\r\n                        'Source:', d.source, 'Link:', d);\r\n            return;\r\n        }\r\n\r\n        let rna = d.target.rna;\r\n        let toRemove = [];\r\n\r\n        for (let i = 0; i < rna.links.length; i++) {\r\n            let link = rna.links[i];\r\n\r\n            if (link.linkType != 'basepair')\r\n                continue;\r\n\r\n            if (link.source.num <= d.source.num && link.target.num >= d.target.num) {\r\n                console.log('crossing basepair', link);\r\n                toRemove.push(link);\r\n            }\r\n        }\r\n\r\n\r\n        // Remove all base pairs that are between these two nodes and add them as extra\r\n        // links\r\n        console.log('toRemove:', toRemove);\r\n\r\n        for (let i = 0; i < toRemove.length; i++) {\r\n            rna.pairtable[toRemove[i].source.num] = 0;\r\n            rna.pairtable[toRemove[i].target.num] = 0;\r\n\r\n            toRemove[i].from = toRemove[i].source.num;\r\n            toRemove[i].to = toRemove[i].target.num - d.source.num;\r\n        }\r\n\r\n        // extract the dotbracket string of the rna\r\n        // cut it at the position of this backbone bond\r\n        let sequence = rna.seq;\r\n        let sequence1 = rna.seq.slice(0, d.source.num);\r\n        let sequence2 = rna.seq.slice(d.source.num);\r\n\r\n        let rnaDotBracket = rnaUtilities.pairtableToDotbracket(rna.pairtable);\r\n        let dotBracket1 = rnaDotBracket.slice(0, d.source.num);\r\n        let dotBracket2 = rnaDotBracket.slice(d.source.num)\r\n\r\n        // get the nucleotide positions\r\n        // cut them at the positions of the backbone bond\r\n        let positions = rna.getPositions('nucleotide')\r\n        let uids = rna.getUids();\r\n\r\n        let positions1 = positions.slice(0, d.source.num);\r\n        let positions2 = positions.slice(d.source.num);\r\n\r\n        let uids1 = uids.slice(0, d.source.num);\r\n        let uids2 = uids.slice(d.source.num);\r\n\r\n        console.log('positions1:', positions1);\r\n        console.log('positions2:', positions2);\r\n\r\n        delete self.rnas[rna.uid];\r\n        let rna1 = self.addRNA(dotBracket1, { 'sequence': sequence1,\r\n                                   'positions': positions1,\r\n                                   'uids': uids1 });\r\n        let rna2 = self.addRNA(dotBracket2, { 'sequence': sequence2,\r\n                                   'positions': positions2,\r\n                                   'uids': uids2 });\r\n        for (let i = 0; i < toRemove.length; i++) {\r\n            console.log('rna1:', rna1);\r\n            console.log('rna2:', rna2);\r\n            console.log('toRemove[i]', toRemove[i]);\r\n            self.extraLinks.push(\r\n                {'source': rna1.nodes[toRemove[i].from-1],\r\n                 'target': rna2.nodes[toRemove[i].to-1],\r\n                 'value': 1,\r\n                 'uid': slugid.nice(),\r\n                 'linkType': 'intermolecule'});\r\n                recalculateGraph();\r\n                self.update();\r\n\r\n        }\r\n        console.log('self.extraLinks:', self.extraLinks);\r\n        //self.extraLinks.push({'source': rna1.nodes[\r\n\r\n        // create two new rnas\r\n        // add their positions\r\n        // add them back to the plot\r\n    }\r\n\r\n    var removeLink = function(d) {\r\n        // remove a link between two nodes\r\n        let index = self.graph.links.indexOf(d);\r\n        console.log('removing link:', index);\r\n\r\n        if (index > -1) {\r\n            //remove a link\r\n            //graph.links.splice(index, 1);\r\n\r\n            // there should be two cases\r\n            // 1. The link is within a single molecule\r\n\r\n            if (d.source.rna == d.target.rna) {\r\n                if (d.linkType == 'backbone') {\r\n                    console.log('trying to remove a backbone link', d.source.num, d.target.num);\r\n                    removeBackBoneLink(d);\r\n                    return;\r\n                } else {\r\n                    let r = d.source.rna;\r\n                    r.addPseudoknots();\r\n                    r.pairtable[d.source.num] = 0;\r\n                    r.pairtable[d.target.num] = 0;\r\n\r\n                    updateRnaGraph(r);\r\n                }\r\n            } else {\r\n                // 2. The link is between two different molecules\r\n                let extraLinkIndex = self.extraLinks.indexOf(d);\r\n\r\n                self.extraLinks.splice(extraLinkIndex, 1);\r\n            }\r\n            recalculateGraph();\r\n        }\r\n        self.update();\r\n    };\r\n\r\n    let addBackBoneLink = function(newLink) {\r\n        // opposite of deleting a link\r\n        // get the two dotbracket strings\r\n        let rna1 = newLink.target.rna;\r\n        let rna2 = newLink.source.rna;\r\n        if (newLink.target.num == 1) {\r\n          rna1 = newLink.source.rna;\r\n          rna2 = newLink.target.rna;\r\n        }\r\n\r\n        let dotbracket1 = rnaUtilities.pairtableToDotbracket(rna1.pairtable);\r\n        let dotbracket2 = rnaUtilities.pairtableToDotbracket(rna2.pairtable);\r\n\r\n        let seq1 = rna1.seq;\r\n        let seq2 = rna2.seq;\r\n\r\n        let positions1 = rna1.getPositions('nucleotide');\r\n        let positions2 = rna2.getPositions('nucleotide');\r\n\r\n        // concatenate them\r\n        let newDotbracket = dotbracket1 + dotbracket2;\r\n        let newSeq = seq1 + seq2;\r\n        let newPositions = positions1.concat(positions2);\r\n\r\n        let toAddInternal = [];\r\n        let toAddExternal = [];\r\n        let toDelete = {};\r\n\r\n        for (let i = 0; i < self.extraLinks.length; i++) {\r\n            console.log('self.extraLinks[i]', self.extraLinks[i]);\r\n            console.log('rna1:', rna1);\r\n            console.log('rna2:', rna2);\r\n            if (self.extraLinks[i].source.rna == rna1) {\r\n                if ( self.extraLinks[i].target.rna == rna2) {\r\n                    // both ends of the extra link are within what will become the new molecule\r\n                    // need to be added as base pairs afterwards\r\n                    //self.extraLinks[i].from = self.extraLinks[i].source.num;\r\n                    //self.extraLinks[i].to = dotbracket1.length + self.extraLinks[i].target.num;\r\n                    //toAddInternal.push(self.extraLinks[i]);\r\n                } else {\r\n                    // only one end of the extra link is within what will become the newly\r\n                    // created molecule, needs to remain an extra link\r\n                    // source will always be the unchanged molecule, whereas target will be\r\n                    // the newly created one\r\n                    toAddExternal.push({\r\n                        'source': self.extraLinks[i].target,\r\n                        'target': self.extraLinks[i].source.num\r\n                    });\r\n\r\n                    toDelete[self.extraLinks[i].uid] = true;\r\n                }\r\n            } else if (self.extraLinks[i].source.rna == rna2) {\r\n                if ( self.extraLinks[i].target.rna == rna1) {\r\n                    // add internal link\r\n                    // both ends of the extra link are within what will become the new molecule\r\n                    // need to be added as base pairs afterwards\r\n                    //self.extraLinks[i].from = self.extraLinks[i].target.num;\r\n                    //self.extraLinks[i].to = dotbracket1.length + self.extraLinks[i].source.num;\r\n\r\n                    //toAddInternal.push(self.extraLinks[i]);\r\n                } else {\r\n                    toAddExternal.push({\r\n                        'source': self.extraLinks[i].target,\r\n                        'target': self.extraLinks[i].source.num + dotbracket1.length\r\n                    });\r\n                    toDelete[self.extraLinks[i].uid] = true;\r\n                }\r\n            }\r\n\r\n            if (self.extraLinks[i].target.rna == rna1) {\r\n                if (self.extraLinks[i].source.rna == rna2) {\r\n                    // covered in previous if statement\r\n                } else {\r\n                    // only one end of the extra link is within what will become the newly\r\n                    // created molecule, needs to remain an extra link\r\n                    toAddExternal.push({\r\n                        'source': self.extraLinks[i].source,\r\n                        'target': self.extraLinks[i].target.num\r\n                    });\r\n\r\n                    toDelete[self.extraLinks[i].uid] = true;\r\n                }\r\n            } else if (self.extraLinks[i].target.rna == rna2) {\r\n                if (self.extraLinks[i].source.rna == rna1) {\r\n                    toAddExternal.push({\r\n                        'source': self.extraLinks[i].source,\r\n                        'target': self.extraLinks[i].target.num + dotbracket1.length\r\n                    });\r\n\r\n                    toDelete[self.extraLinks[i].uid] = true;\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        self.extraLinks = self.extraLinks.filter((e) => { return !(e.uid in toDelete) });\r\n\r\n        delete self.rnas[rna1.uid];\r\n        delete self.rnas[rna2.uid];\r\n\r\n        let newRna = null;\r\n        // create a new RNA\r\n        if (self.options.animation)\r\n            newRna = self.addRNA(newDotbracket, { 'sequence': newSeq,\r\n                                'positions': newPositions,\r\n                                'centerView': false});\r\n        else\r\n            newRna = self.addRNA(newDotbracket, { 'sequence': newSeq,\r\n                        'centerView': false });\r\n\r\n\r\n\r\n        // add new external links\r\n        for (let i = 0; i < toAddExternal.length; i++) {\r\n            self.extraLinks.push({\r\n                'source': toAddExternal[i].source,\r\n                'target': newRna.nodes[toAddExternal[i].target-1],\r\n                'value': 1,\r\n                'uid': slugid.nice(),\r\n                'linkType': 'intermolecule'\r\n            });\r\n        }\r\n\r\n        recalculateGraph();\r\n        self.update();\r\n        console.log('self.extraLinks:', self.extraLinks);\r\n    };\r\n\r\n    function nudge(dx, dy) {\r\n      // TODO currently unused\r\n        node.filter(function(d) { return d.selected; })\r\n        .attr('cx', function(d) { return d.x += dx; })\r\n        .attr('cy', function(d) { return d.y += dy; });\r\n\r\n        link.filter(function(d) { return d.source.selected; })\r\n        .attr('x1', function(d) { return d.source.x; })\r\n        .attr('y1', function(d) { return d.source.y; });\r\n\r\n        link.filter(function(d) { return d.target.selected; })\r\n        .attr('x2', function(d) { return d.target.x; })\r\n        .attr('y2', function(d) { return d.target.y; });\r\n\r\n        d3.event.preventDefault();\r\n    }\r\n\r\n    let nodeMouseup = function(d,i) {\r\n        console.log(\"nodeMouseup\")\r\n        let backbonePossible = true, basepairPossible = true;\r\n\r\n        if (mousedownNode) {\r\n            mouseupNode = d;\r\n\r\n            // if the node isn't a nucleotide, we can't create a link\r\n            if (mouseupNode.nodeType == 'middle' || mousedownNode.nodeType == 'middle' || mouseupNode.nodeType == 'label' || mousedownNode.nodeType == 'label')\r\n                return;\r\n\r\n            if (mouseupNode == mousedownNode) { resetMouseVars(); return; }\r\n            let newLink = {source: mousedownNode, target: mouseupNode, linkType: 'basepair', value: 1, uid: slugid.nice()};\r\n\r\n            for (let i = 0; i < self.graph.links.length; i++) {\r\n                if ((self.graph.links[i].source == mousedownNode)  ||\r\n                    (self.graph.links[i].target == mousedownNode) ||\r\n                    (self.graph.links[i].source == mouseupNode) ||\r\n                    (self.graph.links[i].target == mouseupNode)) {\r\n                    // either one of the nodes is already in a link\r\n\r\n                    // if any of the nodes are already involved in a basepair or a pseudoknot\r\n                    // then we can't make a basepair link\r\n                    if (self.graph.links[i].linkType == 'basepair' ||\r\n                        self.graph.links[i].linkType == 'pseudoknot' ||\r\n                        self.graph.links[i].linkType == 'intermolecule') {\r\n                        // although should be able to make a backbone link\r\n                        console.log('no basepair possible');\r\n                        basepairPossible = false;\r\n                    }\r\n                }\r\n\r\n                if (((self.graph.links[i].source == mouseupNode)  &&\r\n                     (self.graph.links[i].target == mousedownNode)) ||\r\n                         ((self.graph.links[i].source == mousedownNode)  &&\r\n                          (self.graph.links[i].target == mouseupNode))) {\r\n\r\n                    // if we're trying to make a link between two nodes which already have\r\n                    // a backbone between them, then we can't make a link\r\n                    if (self.graph.links[i].linkType == 'backbone') {\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            if (newLink.source.rna != newLink.target.rna) {\r\n                    // could be either a backbone link or an intermolecule link\r\n\r\n                if ((newLink.source.num == 1 &&\r\n                     newLink.target.num == newLink.target.rna.rnaLength) ||\r\n                     (newLink.target.num == 1 &&\r\n                      newLink.source.num == newLink.source.rna.rnaLength)) {\r\n                          //\r\n                          let linkMenu = [\r\n                              {\r\n                                  title: 'Backbone Link',\r\n                                  action: function(elm, d, i) {\r\n                                      linkContextMenuShown = false;\r\n                                      console.log('Item #1 clicked!');\r\n                                      console.log('The data for this circle is: ' + d);\r\n                                      dragLine.attr('class', fstyle.transparent);\r\n                                      addBackBoneLink(newLink);\r\n                                  },\r\n                                  disabled: false // optional, defaults to false\r\n                              },\r\n                              {\r\n                                  title: 'Basepair Link',\r\n                                  action: function(elm, d, i) {\r\n                                      linkContextMenuShown = false;\r\n                                      console.log('You have clicked the second item!');\r\n                                      console.log('The data for this circle is: ' + d);\r\n                                      dragLine.attr('class', fstyle.transparent);\r\n                                      self.addLink(newLink);\r\n                                  }\r\n                              }\r\n                          ]\r\n                          linkContextMenuShown = true;\r\n                          let linkContextMenu = contextMenu(linkMenu);\r\n                          console.log('newLinkMenu');\r\n                          linkContextMenu.apply(this, [d,i,true,\r\n                                                function() { dragLine.attr('class', fstyle.transparent) }]);\r\n                      } else {\r\n                          // between end points but can't make a backbone\r\n                          if (basepairPossible)\r\n                            self.addLink(newLink);\r\n                      }\r\n            } else {\r\n                if (basepairPossible)\r\n                    self.addLink(newLink);\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n    let nodeMousedown = function(d) {\r\n      console.log(\"nodeMousedown\")\r\n      if (!d.selected && !ctrlKeydown) {\r\n        // if this node isn't selected, then we have to unselect every other node\r\n        deselectAllNodes()\r\n      }\r\n\r\n      if (!shiftKeydown) {\r\n        // only without shift, toggle select or select\r\n        if (ctrlKeydown) {\r\n          toggleSelectNode(d)\r\n        } else {\r\n          selectNode(d)\r\n        }\r\n      }\r\n\r\n      if (shiftKeydown && self.options.editable) {\r\n        // with shift key and editable continue to draw dragline\r\n        mousedownNode = d;\r\n\r\n        dragLine\r\n        .attr('class', fstyle.dragLine)\r\n        .attr('x1', mousedownNode.x)\r\n        .attr('y1', mousedownNode.y)\r\n        .attr('x2', mousedownNode.x)\r\n        .attr('y2', mousedownNode.y);\r\n\r\n        d3.event.stopPropagation();\r\n      }\r\n    };\r\n\r\n    let linkClick = (d) => {\r\n        if (!shiftKeydown) {\r\n            return;\r\n        }\r\n\r\n        var invalidLinks = { //'backbone': true,\r\n                             'fake': true,\r\n                             'fake_fake': true,\r\n                             'label_link': true};\r\n\r\n        console.log('d.linkType:', d.linkType);\r\n        if (d.linkType in invalidLinks )\r\n            return;\r\n\r\n        removeLink(d);\r\n    };\r\n\r\n    /* I/O functions */\r\n    self.toJSON = function toJSON() {\r\n       var data = {'rnas': self.rnas, 'extraLinks': self.extraLinks};\r\n            var dataString = JSON.stringify(data, function(key, value) {\r\n            //remove circular references\r\n            if (key == 'rna') {\r\n                return;\r\n            } else {\r\n                return value;\r\n            }\r\n       }, '\\t');\r\n       return dataString;\r\n    };\r\n\r\n    self.fromJSON = function(jsonString) {\r\n        var rnas, extraLinks;\r\n\r\n        try{\r\n            var data = JSON.parse(jsonString);\r\n            rnas = data.rnas;\r\n            extraLinks = data.extraLinks;\r\n        } catch(err) {\r\n            throw err;\r\n        }\r\n\r\n        for (var uid in rnas) {\r\n            if (rnas[uid].type == 'rna') {\r\n                r = new RNAGraph();\r\n\r\n                r.seq = rnas[uid].seq;\r\n                r.dotbracket = rnas[uid].dotbracket;\r\n                r.circular = rnas[uid].circular;\r\n                r.pairtable = rnas[uid].pairtable;\r\n                r.uid = rnas[uid].uid;\r\n                r.structName = rnas[uid].structName;\r\n                r.nodes = rnas[uid].nodes;\r\n                r.links = rnas[uid].links;\r\n                r.rnaLength = rnas[uid].rnaLength;\r\n                r.elements = rnas[uid].elements;\r\n                r.nucsToNodes = rnas[uid].nucsToNodes;\r\n                r.pseudoknotPairs = rnas[uid].pseudoknotPairs;\r\n            } else {\r\n                r = new ProteinGraph();\r\n                r.size = rnas[uid].size;\r\n                r.nodes = rnas[uid].nodes;\r\n                r.uid = rnas[uid].uid;\r\n            }\r\n\r\n            self.addRNAJSON(r, false);\r\n        }\r\n\r\n        extraLinks.forEach(function(link) {\r\n            self.extraLinks.push(link);\r\n        });\r\n\r\n        recalculateGraph();\r\n        self.update();\r\n    };\r\n\r\n    self.addRNA = function(structure, passedOptions = {}) {\r\n        let rnaJson = createInitialLayout(structure, passedOptions);\r\n        let centerView = false;\r\n\r\n        /*\r\n         * Code to display the JSONs representing the structure\r\n         *\r\n        rnaJson.nodes[0].rna = null;\r\n        rnaJson.nodes[0].nextNode = null;\r\n\r\n        rnaJson.links[0].source = null;\r\n        rnaJson.links[0].target = null;\r\n\r\n        console.log(rnaJson.nodes[0]);\r\n        console.log(rnaJson.links[0]);\r\n        console.log(JSON.stringify(rnaJson.nodes[0],null,2));\r\n        console.log(JSON.stringify(rnaJson.links[0],null,2));\r\n        */\r\n\r\n        if ('extraLinks' in passedOptions) {\r\n            // presumably the passed in links are within the passed molecule\r\n            let newLinks = self.addExternalLinks(rnaJson, passedOptions.extraLinks);\r\n\r\n            self.extraLinks = self.extraLinks.concat(newLinks);\r\n        }\r\n\r\n        if ('centerPos' in passedOptions)\r\n            self.addRNAJSON(rnaJson, {centerPos: passedOptions.centerPos,\r\n                                      centerView: false})\r\n        else if ('avoidOthers' in passedOptions)\r\n            self.addRNAJSON(rnaJson, {avoidOthers: passedOptions.avoidOthers});\r\n        else\r\n            self.addRNAJSON(rnaJson, {centerView: passedOptions.centerView});\r\n\r\n        return rnaJson;\r\n    };\r\n\r\n    self.addRNAJSON = function(rnaGraph,\r\n     { avoidOthers = false,\r\n      centerPos = null,\r\n      centerView = true}\r\n    ) {\r\n        // Add an RNAGraph, which contains nodes and links as part of the\r\n        // structure\r\n        // Each RNA will have uid to identify it\r\n        // when it is modified, it is replaced in the global list of RNAs\r\n        //\r\n        var maxX, minX;\r\n        //console.log('centerView:', centerView);\r\n\r\n        if (centerPos != null) {\r\n            // center the newly created RNA at a given position\r\n            let totalX = 0;\r\n            let totalY = 0;\r\n            let nodeCount = 0;\r\n\r\n            rnaGraph.nodes.forEach(function(node) {\r\n                totalX += node.x;\r\n                totalY += node.y;\r\n                nodeCount += 1;\r\n            });\r\n\r\n            if (nodeCount > 0) {\r\n                // center the nodes at centerPos\r\n\r\n                rnaGraph.nodes.forEach(function(node) {\r\n                    node.x = node.x + centerPos[0] - totalX / nodeCount;\r\n                    node.y = node.y + centerPos[1] - totalY / nodeCount;\r\n\r\n                    node.px = node.x;\r\n                    node.py = node.y;\r\n                });\r\n            }\r\n        }\r\n\r\n        if (avoidOthers) {\r\n            if (self.graph.nodes.length > 0)\r\n                maxX = d3.max(self.graph.nodes.map(function(d) { return d.x; }));\r\n            else\r\n                maxX = 0;\r\n\r\n            minX = d3.min(rnaGraph.nodes.map(function(d) { return d.x; }));\r\n\r\n            rnaGraph.nodes.forEach(function(node) {\r\n                node.x += (maxX - minX) + 20;\r\n                node.px += (maxX - minX);\r\n            });\r\n        }\r\n\r\n        rnaGraph.nodes.forEach(function(node) {\r\n            node.rna = rnaGraph;\r\n        });\r\n\r\n        self.rnas[rnaGraph.uid] = rnaGraph;\r\n        recalculateGraph();\r\n\r\n        self.update();\r\n\r\n        if (centerView)\r\n            self.centerView();\r\n\r\n        return rnaGraph;\r\n    };\r\n\r\n    self.addNodes = function addNodes(json) {\r\n        // add a new set of nodes from a json file\r\n\r\n        // Resolve the sources and targets of the links so that they\r\n        // are not just indeces into an array\r\n        json.links.forEach(function(entry) {\r\n            if (typeof entry.source == 'number') entry.source = json.nodes[entry.source];\r\n            if (typeof entry.target == 'number') entry.target = json.nodes[entry.target];\r\n        });\r\n\r\n        // Get the maximum x and y values of the current graph\r\n        // so that we don't place a new structure on top of the\r\n        // old one\r\n        if (self.graph.nodes.length > 0) {\r\n            maxX = d3.max(self.graph.nodes.map(function(d) {return d.x;}));\r\n            maxY = d3.max(self.graph.nodes.map(function(d) {return d.y;}));\r\n        } else {\r\n            maxX = 0;\r\n            maxY = 0;\r\n        }\r\n\r\n        json.nodes.forEach(function(entry) {\r\n            if (!(entry.rna.uid in self.rnas)) {\r\n                self.rnas[entry.rna.uid] = entry.rna;\r\n            }\r\n\r\n            entry.x += maxX;\r\n            //entry.y += maxY;\r\n\r\n            entry.px += maxX;\r\n            //entry.py += maxY;\r\n        });\r\n\r\n        r = new RNAGraph('','');\r\n        r.nodes = json.nodes;\r\n        r.links = json.links;\r\n\r\n        //self.addRNA(r);\r\n        recalculateGraph();\r\n\r\n        self.update();\r\n        self.centerView();\r\n    };\r\n\r\n    self.clearNodes = () => {\r\n        self.graph.nodes = [];\r\n        self.graph.links = [];\r\n\r\n        self.rnas = {};\r\n        self.extraLinks = [];\r\n\r\n        self.update();\r\n    };\r\n\r\n    self.addLink =  function(newLink) {\r\n        // this means we have a new json, which means we have\r\n        // to recalculate the structure and change the colors\r\n        // appropriately\r\n        //\r\n        console.log('adding new link');\r\n        if (newLink.source.rna == newLink.target.rna) {\r\n            // must be a basepair\r\n            let r = newLink.source.rna;\r\n\r\n            r.pairtable[newLink.source.num] = newLink.target.num;\r\n            r.pairtable[newLink.target.num] = newLink.source.num;\r\n\r\n            updateRnaGraph(r);\r\n\r\n        } else {\r\n            //Add an extra link\r\n            console.log('intermolecule');\r\n            newLink.linkType = 'intermolecule';\r\n            self.extraLinks.push(newLink);\r\n        }\r\n        recalculateGraph();\r\n        self.update();\r\n    };\r\n\r\n    self.addExternalLinks = function(rnaJson, externalLinks) {\r\n        let newLinks = [];\r\n\r\n        for (let i = 0; i < externalLinks.length; i++) {\r\n            let newLink = {linkType: 'external', value: 1, uid: slugid.nice(),\r\n                source: null, target: null};\r\n            // check if the source node is an array\r\n            if (Object.prototype.toString.call(externalLinks[i][0]) === '[object Array]') {\r\n                for (let j = 0; j < rnaJson.nodes.length; j++) {\r\n                    if ('nucs' in rnaJson.nodes[j]) {\r\n                        if (rnaJson.nodes[j].nucs.equals(externalLinks[i][0])) {\r\n                            newLink.source = rnaJson.nodes[j];\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                for (let j = 0; j < rnaJson.nodes.length; j++) {\r\n                    if (rnaJson.nodes[j].num == externalLinks[i][0]) {\r\n                        newLink.source = rnaJson.nodes[j];\r\n                    }\r\n                }\r\n            }\r\n\r\n            // check if the target node is an array\r\n            if (Object.prototype.toString.call(externalLinks[i][1]) === '[object Array]') {\r\n                for (let j = 0; j < rnaJson.nodes.length; j++) {\r\n                    if ('nucs' in rnaJson.nodes[j]) {\r\n                        if (rnaJson.nodes[j].nucs.equals(externalLinks[i][1])) {\r\n                            newLink.target = rnaJson.nodes[j];\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                for (let j = 0; j < rnaJson.nodes.length; j++) {\r\n                    if (rnaJson.nodes[j].num == externalLinks[i][1]) {\r\n                        newLink.target = rnaJson.nodes[j];\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (newLink.source == null || newLink.target == null) {\r\n                console.log('ERROR: source or target of new link not found:', newLink, externalLinks[i]);\r\n                continue;\r\n            }\r\n\r\n            newLinks.push(newLink);\r\n        }\r\n\r\n        return newLinks;\r\n    };\r\n\r\n    self.getStructuresDotBracket = function() {\r\n        console.log('self.rnas:', self.rnas);\r\n        let sequence = [];\r\n        let currIdx = 1;\r\n        let nodeIdxs = {};\r\n        let breaks = [];\r\n        let pairtable = [];\r\n\r\n        // add the nodes\r\n        for (let uid in self.rnas) {\r\n            let rna = self.rnas[uid];\r\n\r\n            for (let j = 0; j < rna.nodes.length; j++) {\r\n                let node = rna.nodes[j];\r\n\r\n                if (node.nodeType != 'nucleotide')\r\n                    continue;\r\n\r\n                console.log('node:', node);\r\n                nodeIdxs[node.uid] = currIdx;\r\n                currIdx += 1;\r\n\r\n                sequence.push(node.name);\r\n            }\r\n\r\n            breaks.push(currIdx);\r\n        }\r\n\r\n        pairtable = [currIdx-1]\r\n        for (let i = 0; i < currIdx; i++)\r\n            pairtable.push(0)\r\n\r\n        // add the links\r\n        for (let uid in self.rnas) {\r\n            let rna = self.rnas[uid];\r\n\r\n            for (let j = 0; j < rna.links.length; j++) {\r\n                let link = rna.links[j];\r\n\r\n                if (link.linkType != 'basepair')\r\n                    continue;\r\n\r\n                let idx1 = nodeIdxs[link.source.uid];\r\n                let idx2 = nodeIdxs[link.target.uid];\r\n                pairtable[idx1] = idx2;\r\n                pairtable[idx2] = idx1;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < self.extraLinks.length; i++) {\r\n            let link = self.extraLinks[i];\r\n\r\n            let idx1 = nodeIdxs[link.source.uid];\r\n            let idx2 = nodeIdxs[link.target.uid];\r\n\r\n            pairtable[idx1] = idx2;\r\n            pairtable[idx2] = idx1;\r\n        }\r\n\r\n        let structure = rnaUtilities.pairtableToDotbracket(pairtable).split('');\r\n\r\n        for (let i = 0; i < breaks.length - 1; i++) {\r\n            console.log('breaks[i]:', breaks[i]);\r\n            sequence.splice(breaks[i] + i - 1, 0, '&');\r\n            structure.splice(breaks[i] + i - 1, 0, '&');\r\n        }\r\n\r\n        console.log('sequence:', sequence, sequence.join(''));\r\n        console.log('structure:', structure, structure.join(''));\r\n        return [sequence.join(''), structure.join('')];\r\n    };\r\n\r\n    /* APIs */\r\n    self.startAnimation = function() {\r\n      self.options.animation = true;\r\n      vis.selectAll('g.gnode')\r\n        .call(drag);\r\n      self.force.start();\r\n    };\r\n\r\n    self.stopAnimation = function() {\r\n      self.options.animation = false;\r\n      vis.selectAll('g.gnode')\r\n           .on('mousedown.drag', null);\r\n      self.force.stop();\r\n    };\r\n\r\n    self.resumeForce = function() {\r\n        if (self.options.animation)\r\n            self.force.resume();\r\n    };\r\n\r\n    self.setFriction = function(value) {\r\n      self.force.friction(value);\r\n      self.resumeForce();\r\n    };\r\n\r\n    self.setCharge = function(value) {\r\n      self.force.charge(value);\r\n      self.resumeForce();\r\n    };\r\n\r\n    self.setGravity = function(value) {\r\n      self.force.gravity(value);\r\n      self.resumeForce();\r\n    };\r\n\r\n    self.setPseudoknotStrength = function(value) {\r\n      self.linkStrengths.pseudoknot = value;\r\n      self.update();\r\n    };\r\n\r\n    self.displayNumbering = function(value) {\r\n      self.displayParameters.displayNumbering = value;\r\n      updateStyle();\r\n    };\r\n\r\n    self.displayNodeOutline = function(value) {\r\n      self.displayParameters.displayNodeOutline = value;\r\n      updateStyle();\r\n    };\r\n\r\n    self.displayNodeLabel = function(value) {\r\n      self.displayParameters.displayNodeLabel = value;\r\n      updateStyle();\r\n    };\r\n\r\n    self.displayLinks = function(value) {\r\n      self.displayParameters.displayLinks = value;\r\n      updateStyle();\r\n    };\r\n\r\n    self.displayPseudoknotLinks = function(value) {\r\n      self.displayParameters.displayPseudoknotLinks = value;\r\n      updateStyle();\r\n    };\r\n\r\n    self.displayProteinLinks = function(value) {\r\n      self.displayParameters.displayProteinLinks = value;\r\n      updateStyle();\r\n    };\r\n\r\n    self.displayDirectionArrows = function(value) {\r\n      self.displayParameters.displayDirectionArrows = value;\r\n      updateStyle();\r\n    };\r\n}\r\n","import {RNAGraph} from './rnagraph.js';\r\n\r\nimport {simpleXyCoordinates} from './simplernaplot.js';\r\nimport {NAView} from './naview/naview.js'\r\n\r\nimport fstyle from './fornac.module.css';\r\n\r\nexport function rnaPlot(passedOptions = {}) {\r\n    var options = {\r\n        'width': 300,\r\n        'height': 300,\r\n        'nucleotideRadius': 5,\r\n        'rnaEdgePadding': 1,     // how far the leftmost, rightmost, topmost and bottomost\r\n                                // nucleotides are from the edge of the plot\r\n        'labelInterval': 10,\r\n        'showNucleotideLabels': true,\r\n        'startNucleotideNumber': 1,\r\n        'bundleExternalLinks': false,\r\n\r\n        'rnaLayout': 'simple', // simple or naview\r\n        'namePosition': '0 0' // for x and y either 0, 0.5 or 1\r\n    };\r\n    var options = Object.assign(options, passedOptions);\r\n\r\n    var xScale, yScale;\r\n\r\n    function createTransformToFillViewport(xValues, yValues) {\r\n        // create transform that will scale the x and y values so that\r\n        // they fill the available viewport\r\n        let xExtent = d3.extent(xValues);\r\n        let yExtent = d3.extent(yValues);\r\n\r\n        // add the radius of the nucleotides\r\n        xExtent[0] -= options.nucleotideRadius + options.rnaEdgePadding;\r\n        yExtent[0] -= options.nucleotideRadius + options.rnaEdgePadding;\r\n\r\n        xExtent[1] += options.nucleotideRadius + options.rnaEdgePadding;\r\n        yExtent[1] += options.nucleotideRadius + options.rnaEdgePadding;\r\n\r\n        // find out how wide and height the molecule\r\n        var xRange = xExtent[1] - xExtent[0];\r\n        var yRange = yExtent[1] - yExtent[0];\r\n\r\n        // how much wider / taller is it than the available viewport\r\n        var xExtra = xRange - options.width;\r\n        var yExtra = yRange - options.height;\r\n\r\n        // once we have a scale for one dimension, we can create the scale for the other\r\n        // keeping the same expansion / shrinking ratio\r\n        function createOtherScale(firstScale, newDomain, newRange) {\r\n            var scaleFactor = (firstScale.range()[1] - firstScale.range()[0]) /\r\n                              (firstScale.domain()[1] - firstScale.domain()[0]);\r\n            var newWidth = (newDomain[1] - newDomain[0]) * scaleFactor\r\n            var newMargin = ((newRange[1] - newRange[0]) - newWidth) / 2;\r\n\r\n            return {'scaleFactor': scaleFactor,\r\n                    'scale': d3.scale.linear()\r\n                                     .domain(newDomain)\r\n                                     .range([newRange[0] + newMargin, newRange[1] - newMargin])};\r\n        }\r\n\r\n        var ret;\r\n\r\n        if (xExtra > yExtra) {\r\n            // we have to shrink more in the x-dimension than the y\r\n            xScale = d3.scale.linear()\r\n            .domain(xExtent)\r\n            .range([0, options.width])\r\n\r\n            ret = createOtherScale(xScale, yExtent, [0, options.height]);\r\n            yScale = ret.scale;\r\n        } else {\r\n            // we have to shrink more in the x-dimension than the y\r\n            yScale = d3.scale.linear()\r\n            .domain(yExtent)\r\n            .range([0, options.height])\r\n\r\n            ret = createOtherScale(yScale, xExtent, [0, options.width]);\r\n            xScale = ret.scale;\r\n        }\r\n\r\n        var xOffset = xScale.range()[0] - xScale.domain()[0];\r\n        var yOffset = yScale.range()[0] - yScale.domain()[0];\r\n\r\n        return 'translate(' + -(xScale.domain()[0] * ret.scaleFactor - xScale.range()[0]) +\r\n                  ',' + -(yScale.domain()[0] * ret.scaleFactor - yScale.range()[0]) + ')' +\r\n            'scale(' + ret.scaleFactor + ')';\r\n    }\r\n\r\n    function createNucleotides(selection, nucleotideNodes) {\r\n        // create groupings for each nucleotide and label\r\n        var gs = selection\r\n        .selectAll('.gnode')\r\n        .data(nucleotideNodes)\r\n        .enter()\r\n        .append('svg:g')\r\n        .classed('gnode', true)\r\n        .attr('transform', function(d) {\r\n            return 'translate(' + d.x + ',' + d.y + ')';\r\n        });\r\n\r\n        var circles = gs.append('svg:circle')\r\n        .classed(fstyle.node, true)\r\n        .attr('node_type', 'nucleotide')\r\n        .attr('base_type', (d) => { if (d.name) { return d.name.toLowerCase(); }})\r\n        .attr('r', options.nucleotideRadius)\r\n\r\n\r\n        if (options.showNucleotideLabels) {\r\n            var nucleotideLabels = gs.append('svg:text')\r\n            .text(function(d) { return d.name; })\r\n            .classed(fstyle.nodeLabel, true)\r\n            .append('svg:title')\r\n            .text(function(d) { return d.struct_name + ':' + d.num; });\r\n        }\r\n    }\r\n\r\n    function createLabels(selection, labelNodes) {\r\n        // create groupings for each nucleotide and label\r\n\r\n        var gs = selection\r\n        .selectAll()\r\n        .data(labelNodes)\r\n        .enter()\r\n        .append('svg:g')\r\n        .classed('gnode', true)\r\n        .attr('transform', function(d) {\r\n            return 'translate(' + d.x + ',' + d.y + ')';\r\n        });\r\n\r\n        var circles = gs.append('svg:circle')\r\n        .classed(fstyle.node, true)\r\n        .attr('node_type', 'label')\r\n        .attr('r', options.nucleotideRadius)\r\n\r\n        var numberLabels = gs.append('svg:text')\r\n        .classed(fstyle.nodeLabel, true)\r\n        .text(function(d) { return d.name; })\r\n    }\r\n\r\n    function createName(selection, name) {\r\n        let nameLabel = selection.append('svg:text')\r\n        //.attr('dy', -10)\r\n        .classed(fstyle.plotLabel, true)\r\n        .text(name);\r\n\r\n        let xyPos = options.namePosition.split(\" \", 2) // 0 0.5 1\r\n        let xy = []\r\n        let textBBox = nameLabel.node().getBBox()\r\n        let textSize = [textBBox.width, textBBox.height]\r\n        let plotSize = [options.width, options.height]\r\n\r\n        for (let p in [0, 1]) {\r\n            switch (xyPos[p]) {\r\n                case '0':\r\n                    xy[p] = textSize[p] / 2\r\n                    break;\r\n                case '1':\r\n                    xy[p] = plotSize[p] - textSize[p] / 2\r\n                    break;\r\n                case '0.5':\r\n                    xy[p] = plotSize[p] / 2\r\n                    break;\r\n            }\r\n        }\r\n        nameLabel.attr('x', xy[0]).attr('y', xy[1])\r\n    }\r\n\r\n    function makeExternalLinksBundle(selection, links) {\r\n        var nodesDict = {};\r\n        var linksList = [];\r\n        links = links.filter(function(d) { return d.linkType == 'correct' || d.linkType == 'incorrect' || d.linkType == 'extra'; });\r\n\r\n        selection.selectAll('[link-type=extra]')\r\n        .remove();\r\n\r\n\r\n        for (var i = 0; i < links.length; i++) {\r\n            if (links[i].source === null || links[i].target === null)\r\n                continue;\r\n\r\n            nodesDict[links[i].source.uid] = links[i].source;\r\n            nodesDict[links[i].target.uid] = links[i].target;\r\n\r\n            linksList.push({'source': links[i].source.uid, 'target': links[i].target.uid, 'linkType': links[i].linkType, 'extraLinkType': links[i].extraLinkType}) ;\r\n        }\r\n\r\n        var fbundling = d3.ForceEdgeBundling().nodes(nodesDict).edges(linksList)\r\n        .compatibility_threshold(0.8).step_size(0.2);\r\n        var results   = fbundling();\r\n\r\n        var d3line = d3.svg.line()\r\n            .x(function(d){return d.x;})\r\n            .y(function(d){return d.y;})\r\n            .interpolate('linear');\r\n\r\n        for (var i = 0; i < results.length; i++) {\r\n            var edge_subpoint_data = results[i];\r\n            // for each of the arrays in the results\r\n            // draw a line between the subdivions points for that edge\r\n\r\n            selection.append('path').attr('d', d3line(edge_subpoint_data))\r\n            .style('fill', 'none')\r\n            .attr('link-type', function(d) { return linksList[i].linkType; })\r\n            .attr('extra-link-type', function(d) { return linksList[i].extraLinkType; })\r\n            .style('stroke-opacity',0.4); //use opacity as blending\r\n        }\r\n\r\n    }\r\n\r\n    function createLinks(selection, links) {\r\n        links = links.filter(function(d) { return d.source !== null && d.target !== null; });\r\n        var gs = selection.selectAll('.link')\r\n        .data(links)\r\n        .enter()\r\n        .append('svg:line')\r\n        .attr('x1', function(d) { return d.source.x; })\r\n        .attr('x2', function(d) { return d.target.x; })\r\n        .attr('y1', function(d) { return d.source.y; })\r\n        .attr('y2', function(d) { return d.target.y; })\r\n        .attr('link-type', function(d) { return d.linkType; })\r\n        .attr('extra-link-type', function(d) { return d.extraLinkType; })\r\n        .classed('link', true)\r\n        .classed(fstyle.link, true)\r\n    }\r\n\r\n    function chart(selection) {\r\n        selection.each(function(data) {\r\n            let plot = d3.select(this).append('g')\r\n            .classed(fstyle.plot, true)\r\n\r\n            // data should be a dictionary containing at least a structure\r\n            // and possibly a sequence\r\n            let rg = new RNAGraph(data.sequence, data.structure, data.name, options.startNucleotideNumber)\r\n                    .recalculateElements()\r\n                    .elementsToJson()\r\n                    .addName(data.name);\r\n\r\n            data.rnaGraph = rg;\r\n            // calculate the position of each nucleotide\r\n            // the positions of the labels will be calculated in\r\n            // the addLabels function\r\n            let positions = [];\r\n\r\n            if (options.rnaLayout === 'naview') {\r\n                var naview = new NAView();\r\n                var naViewPositions = naview.naview_xy_coordinates(rg.pairtable);\r\n\r\n                for (var i = 0; i < naViewPositions.nbase; i++) {\r\n                    positions.push([naViewPositions.x[i], naViewPositions.y[i]]);\r\n                }\r\n            } else {\r\n                positions = simpleXyCoordinates(rg.pairtable);\r\n            }\r\n\r\n            rg.addPositions('nucleotide', positions)\r\n            //.reinforceStems()\r\n            //.reinforceLoops()\r\n            //.addExtraLinks(data.extraLinks)\r\n            .addLabels(options.startNucleotideNumber, options.labelInterval);\r\n\r\n            // create a transform that will fit the molecule to the\r\n            // size of the viewport (canvas, svg, whatever)\r\n            let fillViewportTransform = createTransformToFillViewport(\r\n                rg.nodes.map(function(d) { return d.x; }),\r\n                rg.nodes.map(function(d) { return d.y; })\r\n            );\r\n            plot.attr('transform', fillViewportTransform);\r\n\r\n            let nucleotideNodes = rg.nodes.filter(function(d) {\r\n                return d.nodeType == 'nucleotide';\r\n            });\r\n\r\n            let labelNodes = rg.nodes.filter(function(d) {\r\n                return d.nodeType == 'label';\r\n            });\r\n\r\n            let links = rg.links;\r\n\r\n            createLinks(plot, links);\r\n            createNucleotides(plot, nucleotideNodes);\r\n            createLabels(plot, labelNodes);\r\n            createName(d3.select(this), data.name);\r\n\r\n            if (options.bundleExternalLinks) {\r\n                makeExternalLinksBundle(plot, links);\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    chart.width = function(_) {\r\n        if (!arguments.length) return options.width;\r\n        options.width = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.height = function(_) {\r\n        if (!arguments.length) return options.height;\r\n        options.height = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.showNucleotideLabels = function(_) {\r\n        if (!arguments.length) return options.showNucleotideLabels;\r\n        options.showNucleotideLabels = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.rnaEdgePadding = function(_) {\r\n        if (!arguments.length) return options.rnaEdgePadding;\r\n        options.rnaEdgePadding = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.nucleotideRadius = function(_) {\r\n        if (!arguments.length) return options.nucleotideRadius;\r\n        options.nucleotideRadius = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.labelInterval = function(_) {\r\n        if (!arguments.length) return options.labelInterval;\r\n        options.labelInterval = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.showNucleotideLabels = function(_) {\r\n        if (!arguments.length) return options.showNucleotideLabels;\r\n        options.showNucleotideLabels = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.startNucleotideNumber = function(_) {\r\n        if (!arguments.length) return options.startNucleotideNumber;\r\n        options.startNucleotideNumber = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.bundleExternalLinks = function(_) {\r\n        if (!arguments.length) return options.bundleExternalLinks;\r\n        options.bundleExternalLinks = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.rnaLayout = function(_) {\r\n        if (!arguments.length) return options.rnaLayout;\r\n        options.rnaLayout = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.namePosition = function(_) {\r\n        if (!arguments.length) return options.namePosition;\r\n        options.namePosition = _;\r\n        return chart;\r\n    };\r\n\r\n    return chart;\r\n}\r\n","import {rnaPlot} from './rnaplot.js';\r\n\r\nexport function rnaTreemap(passedOptions = {}) {\r\n    var options = {\r\n        'width': 300,\r\n        'height': 300,\r\n        'nucleotideRadius': 5,\r\n        'rnaEdgePadding': 1,     // how far the leftmost, rightmost, topmost and bottomost\r\n                                // nucleotides are from the edge of the plot\r\n        'labelInterval': 10,\r\n        'showNucleotideLabels': true,\r\n        'startNucleotideNumber': 1,\r\n        'bundleExternalLinks': false,\r\n\r\n        'rnaLayout': 'simple', // simple or naview\r\n        'namePosition': '0 0', // for x and y either 0, 0.5 or 1\r\n    };\r\n\r\n    var options = Object.assign(options, passedOptions);\r\n\r\n    function rnaTreemapNode(selection) {\r\n        // create a background rectangle for each RNA structure\r\n        selection.each(function(d) {\r\n            d3.select(this)\r\n            .attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')' })\r\n            .append('rect')\r\n            .attr('fill', 'transparent')\r\n            .attr('width', function(d) { return Math.max(0, d.dx); })\r\n            .attr('height', function(d) { return Math.max(0, d.dy); })\r\n\r\n            // draw the actual RNA structure\r\n            var chart = rnaPlot(options)\r\n            .width( Math.max(0, d.dx))\r\n            .height( Math.max(0, d.dy))\r\n\r\n            if ('structure' in d) d3.select(this).call(chart)\r\n        });\r\n    }\r\n\r\n    var chart = function(selection) {\r\n        selection.each(function(data) {\r\n            console.log('data:', data)\r\n            // initialize the treemap structure\r\n            // sample input\r\n            // { 'name': 'blah',\r\n            // 'children: [{'structure': '..((..))',\r\n            //               'sequence': 'ACCGGCC',\r\n            //               'size': 50}]\r\n            // }\r\n            var treemap = d3.layout.treemap()\r\n            .size([options.width, options.height])\r\n            .sticky(false)\r\n            .value(function(d) { return d.size; });\r\n\r\n            // create a new <g> for each node in the treemap\r\n            // this may be a little redundant, since we expect the calling\r\n            // selection to contain their own g elements\r\n            var gEnter = d3.select(this)\r\n                .append('g')\r\n                .classed('rnatreemap', true)\r\n            var treemapGnodes = gEnter.datum(data).selectAll('.treemapnode')\r\n                .data(treemap.nodes)\r\n                .enter()\r\n                .append('g')\r\n                .classed('treemapnode', true)\r\n                .call(rnaTreemapNode);\r\n        });\r\n    };\r\n\r\n    chart.width = function(_) {\r\n        if (!arguments.length) return options.width;\r\n        options.width = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.height = function(_) {\r\n        if (!arguments.length) return options.height;\r\n        options.height = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.showNucleotideLabels = function(_) {\r\n        if (!arguments.length) return options.showNucleotideLabels;\r\n        options.showNucleotideLabels = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.rnaEdgePadding = function(_) {\r\n        if (!arguments.length) return options.rnaEdgePadding;\r\n        options.rnaEdgePadding = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.nucleotideRadius = function(_) {\r\n        if (!arguments.length) return options.nucleotideRadius;\r\n        options.nucleotideRadius = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.labelInterval = function(_) {\r\n        if (!arguments.length) return options.labelInterval;\r\n        options.labelInterval = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.showNucleotideLabels = function(_) {\r\n        if (!arguments.length) return options.showNucleotideLabels;\r\n        options.showNucleotideLabels = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.startNucleotideNumber = function(_) {\r\n        if (!arguments.length) return options.startNucleotideNumber;\r\n        options.startNucleotideNumber = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.bundleExternalLinks = function(_) {\r\n        if (!arguments.length) return options.bundleExternalLinks;\r\n        options.bundleExternalLinks = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.rnaLayout = function(_) {\r\n        if (!arguments.length) return options.rnaLayout;\r\n        options.rnaLayout = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.namePosition = function(_) {\r\n        if (!arguments.length) return options.namePosition;\r\n        options.namePosition = _;\r\n        return chart;\r\n    };\r\n\r\n    chart.zoom = function(_) {\r\n        if (!arguments.length) return options.zoom;\r\n        options.zoom = _;\r\n        return chart;\r\n    };\r\n\r\n    return chart;\r\n}\r\n"],"names":["getRandomValues","rnds8","rng","REGEX","validate","uuid","byteToHex","i","stringify","arr","offset","_nodeId","_clockseq","_lastMSecs","_lastNSecs","v1","options","buf","b","node","clockseq","seedBytes","msecs","nsecs","dt","tl","tmh","n","parse","v","stringToBytes","str","bytes","DNS","URL","v35","name","version","hashfunc","generateUUID","value","namespace","md5","msg","md5ToHexEncodedArray","wordsToMd5","bytesToWords","input","output","length32","hexTab","x","hex","getOutputLength","inputLength8","len","a","c","d","olda","oldb","oldc","oldd","md5ff","md5gg","md5hh","md5ii","safeAdd","length8","y","lsw","msw","bitRotateLeft","num","cnt","md5cmn","q","s","t","v3","v4","rnds","f","z","ROTL","sha1","K","H","l","N","M","_i","j","_i2","W","_t","e","_t2","T","v5","nil","require$$0","toBase64","fromBase64","base64","slugid","uuid_","slug","ArrowIcon","contextMenu","menu","opts","previouslyMouseUp","uid","rootElement","orientation","initialPos","parentStart","openCallback","closeCallback","d3","data","index","pMouseUp","clickAwayFunc","elm","mousePos","currentThis","openChildMenuUid","list","ret","boundingRect","childrenContextMenu","contextMenuSelection","numberSort","arraysEqual","RNAUtilities","self","bracket","res","pt","TURN","mm","maximum","oldPt","leftPart","enclosedPart","dotbracket","stack","inverseBracketLeft","inverseBracketRight","ni","key","k","seen","from","to","toRemove","unmatched","origFrom","origTo","newPt","removed","level","dotBracketBreaks","elements","u5","u3","external","left","right","m","combined","rnaUtilities","ColorScheme","colorsText","rangeText","parts","nums","parts1","colorText","lines","currMolecule","counter","colorsJson","domainValues","words","partsRight","color","moleculeName","minNum","maxNum","resnum","RNAGraph","seq","structName","startNumber","uids","nucleotideNodes","targetString","breaks","breakIndex","nodeType","positions","labelNodes","broken","relevantElements","allNucs","nucs","filterNucs","newNode1","newNode2","linkLength","angle","radius","fakeNodeUid","newNode","newX","newY","coordsCounted","ia","fromNode","filterOutNonFakeNodes","nucsToNodes","fakeNodes","linked","thisNode","thisNuc","distance","extraLinks","source","target","newLink","elemTypes","nodeName","labelInterval","prevNode","nextNode","prevVec","nextVec","combinedVec","vecLength","normedVec","offsetVec","externalLoop","pseudoknotPairs","simpleXyCoordinates","pair_table","INIT_ANGLE","INIT_X","INIT_Y","RADIUS","alpha","loop_size","stack_size","lp","stk","PIHALF","loop","count","r","bubble","i_old","partner","start_k","start_l","fill","ladder","begin","diff","polygon","remember","poss","Radloop","loopnumber","next","prev","Loop","nconnection","Connection","number","depth","mark","Region","start1","end1","start2","end2","isNull","region","start","end","xrad","yrad","extruded","Base","mate","extracted","NAView","npairs","nb1","ibase","retloop","cp","rp","rlp","maxconn","maxdepth","determine_depths","anchor_connection","xs","ys","xe","ye","xn","yn","angleinc","xc","yc","xo","yo","astart","aend","cpnext","acp","cpprev","ic","da","maxang","icstart","icend","icmiddle","icroot","done","done_all_connections","rooted","sign","midx","midy","nrx","nry","mx","my","vx","vy","dotmv","nmidx","nmidy","icstart1","icup","icdown","icnext","direction","dan","dx","dy","rr","cpx","cpy","cpnextx","cpnexty","cnx","cny","rcn","rc","lnx","lny","rl","ac","acn","sx","sy","dcp","imaxloop","indice","set_radius","lencut","mindit","ci","sumn","sumd","dit","imindit","rt2_2","aend1","aend2","aave","a1","a2","dac","nstart","nend","collision","h","hhi","hlow","disc","theta","phi","iter","x1","x2","FornaContainer","element","passedOptions","mousedownNode","mouseupNode","linkContextMenuShown","resetMouseVars","graph","array","shiftKeydown","ctrlKeydown","keydown","disableZooming","enableBrushing","keyup","enableZooming","disableBrushing","backgroundMenu","canvasMousePos","xScale","yScale","nodeMenu","deleteNode","changeNode","insertNodeBeforeOrAfter","svg","mouseEventHelper","mpos","vis","dragLine","fstyle","deselectAllNodes","visLinks","visNodes","toggleSelectNode","p","selectNode","selectedNodes","extent","drag","d1","createInitialLayout","structure","rg","rnaJson","naViewPositions","createNewNodes","gnodesEnter","nodeMousedown","nodeMouseup","labelAndProteinNodes","labelsEnter","createNewLinks","linksEnter","linkLines","linkClick","drawDirectionArrow","magnitude","endPoint","startPoint","nodeStroke","lengthMult","arrowWidth","u","arrowTip","path","realLinkFilter","recalculateGraph","uidsToNodes","link","fakeLinks","linkIndex","allLinks","elementKey","gnodes","realNodes","collide","nx1","nx2","ny1","ny2","quad","y1","y2","updateStyle","newStructure","nextFunction","duration","newRNAJson","links","newNodes","endall","transition","callback","afterAnimation","getBoundingBoxTransform","minX","minY","maxX","maxY","maxRadius","molWidth","molHeight","widthRatio","heightRatio","minRatio","newMolWidth","newMolHeight","xTrans","yTrans","bbTransform","svgW","svgH","nodes","json","customColorsText","cs","newColorScheme","proteinNodes","scale","changeColors","moleculeColors","val","referenceNode","rna","sequence","newNodeNum","newDotbracket","newSequence","newPositions","positionOffset","newUids","pair","updateRnaGraph","nucleotidePositions","labelPositions","removeBackBoneLink","sequence1","sequence2","rnaDotBracket","dotBracket1","dotBracket2","positions1","positions2","uids1","uids2","rna1","rna2","removeLink","extraLinkIndex","addBackBoneLink","dotbracket1","dotbracket2","seq1","seq2","newSeq","toAddExternal","toDelete","newRna","basepairPossible","linkMenu","linkContextMenu","invalidLinks","dataString","jsonString","rnas","err","newLinks","rnaGraph","avoidOthers","centerPos","centerView","totalX","totalY","nodeCount","entry","externalLinks","currIdx","nodeIdxs","pairtable","idx1","idx2","rnaPlot","createTransformToFillViewport","xValues","yValues","xExtent","yExtent","xRange","yRange","xExtra","yExtra","createOtherScale","firstScale","newDomain","newRange","scaleFactor","newWidth","newMargin","createNucleotides","selection","gs","createLabels","createName","nameLabel","xyPos","xy","textBBox","textSize","plotSize","makeExternalLinksBundle","nodesDict","linksList","fbundling","results","d3line","edge_subpoint_data","createLinks","chart","plot","naview","fillViewportTransform","_","rnaTreemap","rnaTreemapNode","treemap","gEnter"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]}